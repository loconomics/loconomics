@using WebMatrix.WebData;
@using WebMatrix.Security;
@using System.Web.Routing;
@using System.Configuration;
@{
    WebSecurity.InitializeDatabaseConnection("sqlloco", "userprofile", "UserId", "Email", false);

    // To let users of this site log in using their accounts from other sites such as Facebook, Twitter, 
    // and Windows Live, you must update this site. For more information visit 
    // http://go.microsoft.com/fwlink/?LinkID=226949
    //OAuthWebSecurity.RegisterOpenIDClient(BuiltInOpenIDClient.Google);
    //OAuthWebSecurity.RegisterOpenIDClient(BuiltInOpenIDClient.Yahoo);
    /*OAuthWebSecurity.RegisterOAuthClient( 
        BuiltInOAuthClient.Facebook, 
        consumerKey: "a",   // for Facebook, consumerKey is called AppID in the SDK 
        consumerSecret: "b");*/


    // Facebook connection options to the Developer App Version 'Loconomics', SiteUrl: http://loconomics.com/
    // Facebook App Link: https://developers.facebook.com/apps/180579422039773
    Facebook.Initialize("180579422039773", "fab30a2288ce64be2b3b1e0f1113fb25", "sqlloco");

    /* Routing rules
    */
    // REST API, locale in URL for locale independent files:
    // NOTE: Any folder added to the API folder need to be registered, and before the catch-all pages route
    RouteTable.Routes.MapWebPageRoute("api/v1/{locale}/me/{page}/{*urldata}", "~/api/v1/me/{page}.cshtml");
    RouteTable.Routes.MapWebPageRoute("api/v1/{locale}/users/{userID}", "~/api/v1/users/index.cshtml");
    RouteTable.Routes.MapWebPageRoute("api/v1/{locale}/users/{userID}/{page}/{*urldata}", "~/api/v1/users/{page}.cshtml");
    RouteTable.Routes.MapWebPageRoute("api/v1/{locale}/auth/{page}/{*urldata}", "~/api/v1/auth/{page}.cshtml");
    // DEPRECATED: Auth alias for previously used REST URLs (originally in the root of the REST URL)
    // TODO This URLs are deprecated, so at some point next 4 alias must be removed
    RouteTable.Routes.MapWebPageRoute("api/v1/{locale}/facebook-user", "~/api/v1/auth/facebook-user.cshtml");
    RouteTable.Routes.MapWebPageRoute("api/v1/{locale}/login/{*urldata}", "~/api/v1/auth/login.cshtml");
    RouteTable.Routes.MapWebPageRoute("api/v1/{locale}/logout", "~/api/v1/auth/logout.cshtml");
    RouteTable.Routes.MapWebPageRoute("api/v1/{locale}/signup/{*urldata}", "~/api/v1/auth/signup.cshtml");
    // Disabled experimental icalendar route
    //RouteTable.Routes.MapWebPageRoute("api/v1/{locale}/icalendar/{page}", "~/api/v1/icalendar/{page}.cshtml");
    // Catch-all pages route, will route to any page inmediately in the API folder, or Not Found
    RouteTable.Routes.MapWebPageRoute("api/v1/{locale}/{page}/{*urldata}", "~/api/v1/{page}.cshtml");

    // ScheduledTask
    RouteTable.Routes.MapWebPageRoute("scheduledtask", "~/_specialRoutes/ScheduledTask.cshtml");
    // PaymentGatewayWebhook: hook URL to allow Braintree to contact us about transactions/merchant account information
    RouteTable.Routes.MapWebPageRoute("PaymentGatewayWebhook", "~/_specialRoutes/PaymentGatewayWebhook.cshtml");
    // iCalendar URL
    RouteTable.Routes.MapWebPageRoute("calendar/{userID}/{token}/{file}", "~/_specialRoutes/Calendar.cshtml");

    // Public User profile photo, KEEPING URL AS IN Release-6.3 FOR RELEASE-7+
    RouteTable.Routes.MapWebPageRoute("{locale}/profile/photo", "~/_specialRoutes/UserProfilePhoto.cshtml");
    RouteTable.Routes.MapWebPageRoute("{locale}/profile/photo/{userID}", "~/_specialRoutes/UserProfilePhoto.cshtml");
    RouteTable.Routes.MapWebPageRoute("{locale}/profile/photo/{userID}/{type}", "~/_specialRoutes/UserProfilePhoto.cshtml");    
    
    // Auth
    RouteTable.Routes.MapWebPageRoute("{locale}/auth/login", "~/_specialRoutes/Login.cshtml");
    RouteTable.Routes.MapWebPageRoute("{locale}/auth/confirm", "~/_specialRoutes/Confirm.cshtml");
    
    // App/Webapp explicit rules
    // TODO: some day this list needs to be automatic, from the activity list, right now has some explicit rules to avoid conflicts with
    // more generic rules after this (the problematic is the customURL rule, basically)
    RouteTable.Routes.MapWebPageRoute("login/{*urldata}", "~/Default.cshtml");

    // Special Server ROUTES
    // Booking with service professional bookcode URL
    RouteTable.Routes.MapWebPageRoute("book/{bookcode}", "~/_specialRoutes/Book.cshtml");
    RouteTable.Routes.MapWebPageRoute("book/{bookcode}/{jobTitleID}", "~/_specialRoutes/Book.cshtml");
    // Public Profile URL optimized for SEO:
    RouteTable.Routes.MapWebPageRoute("{city}/{jobTitle}/{user}", "~/_specialRoutes/PublicProfileURL.cshtml");
    // CustomURL:
    RouteTable.Routes.MapWebPageRoute(LcRest.MarketplaceProfile.CustomUrlPrefix + "{customurl}/", "~/_specialRoutes/CustomURL.cshtml");

    // MANAGE SPA ROUTES REDIRECTING TO INDEX
    // CATCH-ALL:
    RouteTable.Routes.MapWebPageRoute("{*any}", "~/Default.cshtml");

    // IMPORTANT: because of the previous CATCH-ALL, this will never being displayed.
    // BUT is important to know how to do it, since is expected we can replace the catch-all by specific SPA page URLs
    // ANY NOT FOUND URL
    RouteTable.Routes.MapWebPageRoute("{*urldata}", "~/Errors/Error404.cshtml");
}
