require=function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";function ViewModel(app){this.redirect=function(){var url="/",onboardingUrl=app.model.onboarding.stepUrl();url=onboardingUrl?"/#!"+onboardingUrl:"/#!/dashboard";window.location.href=url};this.profile=SignupVM.profileType.serviceProfessional}var Activity=require("../components/Activity"),SignupVM=require("../viewmodels/Signup"),A=Activity.extend(function LandingPageActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app)});exports.init=A.init},{"../components/Activity":42,"../viewmodels/Signup":155}],2:[function(require,module,exports){"use strict";var ko=require("knockout"),$=require("jquery"),propTools=require("./utils/jsPropertiesTools"),getObservable=require("./utils/getObservable");exports.registerAll=function(app){ko.components.register("app-navbar-action",{template:{element:"navbar-action-template"},viewModel:function(params){propTools.defineGetter(this,"action",function(){return params.action&&params.navBar()?params.navBar()[params.action]():null})}});ko.components.register("app-unlabeled-input",{template:{element:"unlabeled-input-template"},viewModel:function(params){this.value=getObservable(params.value);this.placeholder=getObservable(params.placeholder);this.disable=getObservable(params.disable);var userAttr=getObservable(params.attr);this.attr=ko.pureComputed(function(){var attr=userAttr()||{};return $.extend({},attr,{"aria-label":this.placeholder(),placeholder:this.placeholder(),type:this.type()})},this);var type=getObservable(params.type);this.type=ko.computed(function(){return type()||"text"},this)}});ko.components.register("app-inline-user-menu",{template:{element:"inline-user-menu-template"},viewModel:{instance:app.navBarBinding}});ko.components.register("app-onboarding-menu",{template:{element:"onboarding-menu-template"},viewModel:{instance:{}}});ko.components.register("app-inline-side-menu",{template:{element:"inline-side-menu-template"},viewModel:function(params){var vm=this;Object.keys(app.navBarBinding).forEach(function(prop){vm[prop]=app.navBarBinding[prop]});vm.vocElement=getObservable(params.vocElement||"general");vm.feedbackLink=ko.pureComputed(function(){return"feedbackForm/"+this.vocElement()},vm);vm.contactLink=ko.pureComputed(function(){return"contactForm/"+this.vocElement()},vm);vm.helpLink=getObservable(params.helpLink||"");vm.items=ko.observableArray();var category2Item=function(a){return{label:a&&a.name(),link:a&&a.urlPath()}},section2Item=category2Item,article2Item=function(a){return{label:a&&a.title(),link:a&&a.urlPath()}},idFromLink=function(link){var result=/\/(\d+)/i.exec(link);return result&&0|result[1]},types={categories:function(link){var id=idFromLink(link);return id?app.model.help.getSectionsByCategory(id).then(function(d){return d.map(section2Item)}):app.model.help.getCategories().then(function(d){return d.map(category2Item)})},sections:function(link){var id=idFromLink(link);return id?app.model.help.getArticlesBySection(id).then(function(d){return d.map(article2Item)}):app.model.help.getSections().then(function(d){return d.map(section2Item)})},articles:function(link){var id=idFromLink(link);return id?app.model.help.getArticle(id).then(article2Item):app.model.help.getArticles().then(function(d){return d.map(article2Item)})}};types.relatedArticles=types.sections;ko.computed(function(){var link=this.helpLink();if(link){var type;Object.keys(types).some(function(t){if(link.indexOf(t)>-1){type=t;return!0}});if(!type){console.warn("Help Link not recognized",link);vm.items([]);return}types[type](link).then(function(list){vm.items(list?Array.isArray(list)?list:[list]:[])})}else vm.items([])},vm)}});ko.components.register("app-feedback-entry",{template:{element:"feedback-entry-template"},viewModel:function(params){this.section=getObservable(params.section||"");this.url=ko.pureComputed(function(){return"/feedbackForm/"+this.section()},this)}});ko.components.register("app-time-slot-tile",{template:{element:"time-slot-tile-template"},viewModel:require("./viewmodels/TimeSlot")});ko.components.register("app-loading-spinner",{template:{element:"loading-spinner-template"},viewModel:function(params){var base="loadingSpinner";this.mod=getObservable(params.mod||"");this.cssClass=ko.pureComputed(function(){var c=base,mods=(this.mod()||"").split(" ");mods.length&&(c+=" "+base+"--"+mods.join(" "+base+"--"));return c},this)}});ko.components.register("app-appointment-card",{template:{element:"appointment-card-template"},viewModel:require("./viewmodels/AppointmentCard")});ko.components.register("app-job-titles-list",{template:{element:"job-titles-list-template"},viewModel:function(params){this.allJobTitles=getObservable(params.jobTitles||[]);this.jobTitles=ko.pureComputed(function(){return this().filter(function(j){return!j.isBeingDeleted()})},this.allJobTitles);this.selectJobTitle=params.selectJobTitle||function(){};this.showMarketplaceInfo=getObservable(params.showMarketplaceInfo||!1)}});ko.components.register("app-stars-rating",{template:{element:"stars-rating-template"},viewModel:function(params){function computeStarValue(rating,starPosition){var x=rating/starPosition|0,z=rating%1;return x>0?1:(0|rating)===starPosition-1&&0!==z&&z>=.5?.5:0}this.rating=getObservable(params.rating||0);this.total=getObservable(params.total||0);this.size=getObservable(params.size||"");this.stars=ko.pureComputed(function(){for(var r=this.rating(),list=[],i=1;5>=i;i++)list.push(computeStarValue(r,i));return list},this);this.totalText=ko.pureComputed(function(){return"("+this.total()+")"},this);this.classes=ko.pureComputed(function(){return this.size()?"StarsRating--"+this.size():""},this)}});var PublicUser=require("./models/PublicUser");ko.components.register("app-service-professional-info",{synchronous:!0,template:{element:"service-professional-info-template"},viewModel:{createViewModel:function(params){var view=new PublicUser;params&&params.api&&params.api(view);return view}}});var DateTimePickerVM=require("./viewmodels/DatetimePicker");ko.components.register("app-datetime-picker",{synchronous:!0,template:{element:"datetime-picker-template"},viewModel:{createViewModel:function(params,componentInfo){var view=new DateTimePickerVM(app,componentInfo.element);params&&params.api&&params.api(view);params&&Object.keys(params).forEach(function(key){if(ko.isObservable(view[key])){view[key](ko.unwrap(params[key]));ko.isObservable(params[key])&&view[key].subscribe(params[key])}});return view}}});var googleMapReady=require("./utils/googleMapReady"),i18n=require("./utils/i18n");ko.components.register("app-address-map",{synchronous:!0,template:"<div></div>",viewModel:{createViewModel:function(params,componentInfo){var v={lat:ko.unwrap(params.lat),lng:ko.unwrap(params.lng),zoom:ko.unwrap(params.zoom)||11,radius:0|ko.unwrap(params.radius),isServiceLocation:ko.unwrap(params.isServiceLocation)||!1,radiusMeters:0,refreshTs:getObservable(params.refreshTs),map:null,circle:null};v.circleColor=v.isServiceLocation?"#5F2393":"#00989A";var c=i18n.getCurrentCulture(),unit=i18n.distanceUnits[c.country];if(v.isServiceLocation||!v.radius){v.radius=.5;unit="miles"}v.radiusMeters=1e3*i18n.convertMilesKm(v.radius,unit);googleMapReady(function(google){var mapLimits=[70,-168,14,-63];v.lat>mapLimits[0]?v.lat=mapLimits[0]:v.lat<mapLimits[2]&&(v.lat=mapLimits[0]);v.lng<mapLimits[1]?v.lng=mapLimits[1]:v.lng>mapLimits[3]&&(v.lng=mapLimits[3]);var myLatlng=new google.maps.LatLng(v.lat,v.lng),mapOptions={zoom:v.zoom,center:myLatlng,mapTypeId:google.maps.MapTypeId.ROADMAP};v.map=new google.maps.Map(componentInfo.element.children[0],mapOptions);v.circle=new google.maps.Circle({center:myLatlng,map:v.map,clickable:!1,radius:v.radiusMeters,fillColor:v.circleColor,fillOpacity:.3,strokeWeight:0});var refresh=googleMapReady.refreshMap.bind(null,v.map);v.refreshTs.subscribe(refresh)});return v}}});var OnboardingProgressMarkVM=require("./viewmodels/OnboardingProgressMarkVM");ko.components.register("app-onboarding-progress-mark",{template:{element:"onboarding-progress-mark-template"},viewModel:{createViewModel:function(){return new OnboardingProgressMarkVM(app)}}});var OnboardingProgressBarVM=require("./viewmodels/OnboardingProgressBarVM");ko.components.register("app-onboarding-progress-bar",{template:{element:"onboarding-progress-bar-template"},viewModel:{createViewModel:function(){return new OnboardingProgressBarVM(app)}}});var SearchJobTitlesVM=require("./viewmodels/SearchJobTitlesVM");ko.components.register("app-search-job-titles",{template:{element:"search-job-titles-template"},viewModel:{createViewModel:function(params){var view=new SearchJobTitlesVM(app);params&&params.api&&params.api(view);params&&Object.keys(params).forEach(function(key){if(ko.isObservable(view[key])){view[key](ko.unwrap(params[key]));ko.isObservable(params[key])&&view[key].subscribe(params[key])}});return view}}});ko.components.register("app-select-job-title",{template:{element:"select-job-title-template"},synchronous:!0,viewModel:{createViewModel:function(params,componentInfo){var vm={selected:ko.observable(null),list:ko.observableArray([]),caption:getObservable(params.caption)};if(params&&ko.isWritableObservable(params.selected)){vm.selected.subscribe(params.selected);params.selected.subscribe(vm.selected)}if(params&&params.jobTitles){var l=Object.keys(params.jobTitles).map(function(key){return{id:params.jobTitles[key],name:key}});vm.list(l)}else componentInfo.templateNodes.forEach(function(node){if(node.tagName&&"item"===node.tagName.toLowerCase()){var id=0|node.getAttribute("id"),name=node.textContent;vm.list.push({id:id,name:name})}});return vm}}});var SignupVM=require("./viewmodels/Signup");ko.components.register("app-signup",{template:{element:"signup-template"},synchronous:!0,viewModel:{createViewModel:function(params,componentInfo){var vm=new SignupVM(app);ko.isWritableObservable(params.api)&&params.api(vm);Object.keys(params).forEach(function(key){if(ko.isWritableObservable(vm[key])){vm[key](ko.unwrap(params[key]));ko.isObservable(params[key])&&vm[key].subscribe(params[key])}});"function"==typeof params.onSignedUp&&vm.on("signedup",function(signedupData){params.onSignedUp.call(vm,signedupData)});"function"==typeof params.onSignUpError&&vm.on("signuperror",function(error){params.onSignUpError.call(vm,error)});vm.isThenLabelDisplayed=ko.observable(!1);componentInfo.templateNodes.length&&vm.isThenLabelDisplayed(!0);return vm}}})}},{"./models/PublicUser":81,"./utils/getObservable":132,"./utils/googleMapReady":134,"./utils/i18n":135,"./utils/jsPropertiesTools":137,"./viewmodels/AppointmentCard":144,"./viewmodels/DatetimePicker":147,"./viewmodels/OnboardingProgressBarVM":152,"./viewmodels/OnboardingProgressMarkVM":153,"./viewmodels/SearchJobTitlesVM":154,"./viewmodels/Signup":155,"./viewmodels/TimeSlot":156,knockout:!1}],3:[function(require,module,exports){"use strict";var $=require("jquery");exports.getErrorMessageFrom=function getErrorMessageFrom(err,defaultText){defaultText=defaultText||"Unknow error";if(!err)return defaultText;!err.error||"object"!=typeof err.error&&"string"!=typeof err.error||(err=err.error);if("string"==typeof err)return err||defaultText;err=err.responseJSON||err;var msg=err.name&&err.name+": "||"";msg+=err.errorMessage||err.message||"";if(err.errors)msg+="\n"+exports.stringifyErrorsList(err.errors);else try{var jserr=JSON.stringify(err),hasMoreInfo=jserr&&"{}"!==jserr;if(hasMoreInfo){hasMoreInfo=!1;var messagePropertiesList=["name","errorMessage","message","errors"];Object.keys(err).forEach(function(key){-1===messagePropertiesList.indexOf(key)&&(hasMoreInfo=!0)})}hasMoreInfo&&(msg+="\n\nTechnical details: "+jserr)}catch(ex){console.log("Impossible to stringify JSON error",err,ex)}return msg||defaultText};exports.stringifyErrorsList=function(errors){var msg="";msg=Array.isArray(errors)?errors.join("\n"):Object.keys(errors).map(function(key){var m=errors[key];return m&&m.join?m.join("\n"):m}).join("\n");return msg};exports.showError=function showErrorModal(options){var modal=$("#errorModal"),header=modal.find("#errorModal-label"),body=modal.find("#errorModal-body");options=options||{};var msg=body.data("default-text");msg=exports.getErrorMessageFrom(options.error||options.message,msg);body.multiline(msg);header.text(options.title||header.data("default-text"));return new Promise(function(resolve){modal.modal("show");modal.on("hide.bs.modal",function(){resolve()})})};exports.confirm=function confirm(options){var modal=$("#confirmModal"),header=modal.find("#confirmModal-label"),body=modal.find("#confirmModal-body"),yesBtn=modal.find("#confirmModal-yesBtn"),noBtn=modal.find("#confirmModal-noBtn");options=options||{};var title=header.data("default-text"),msg=body.data("default-text"),yes=yesBtn.data("default-text"),no=noBtn.data("default-text");body.multiline(options.message||msg);header.text(options.title||title);yesBtn.text(options.yes||yes);noBtn.text(options.no||no);return new Promise(function(resolve,reject){modal.modal("show");yesBtn.on("click",function(){resolve()});noBtn.on("click",function(){reject()});modal.on("hide.bs.modal",function(){reject()})})};exports.showNotification=function showNotification(options){var modal=$("#notificationModal"),header=modal.find("#notificationModal-label"),button=modal.find("#notificationModal-button"),body=modal.find("#notificationModal-body");options=options||{};var msg=options.message||body.data("default-text");body.multiline(msg);header.text(options.title||header.data("default-text"));button.text(options.buttonText||button.data("default-text"));return new Promise(function(resolve){modal.modal("show");modal.on("hide.bs.modal",function(){resolve()})})};exports.showTimePicker=require("./modals/timePicker").show;exports.showTextEditor=require("./modals/textEditor").show;exports.showAnnouncement=require("./modals/announcementModal").show},{"./modals/announcementModal":46,"./modals/textEditor":47,"./modals/timePicker":48}],4:[function(require,module,exports){"use strict";function performLocalLogin(thisAppModel,username){return function(logged){return thisAppModel.clearLocalData().then(function(){thisAppModel.rest.extraHeaders={Authorization:"LC alu="+logged.userID+",alk="+logged.authKey};localforage.setItem("credentials",{userID:logged.userID,username:username,authKey:logged.authKey});thisAppModel.user().model.updateWith(logged.profile);thisAppModel.userProfile.saveLocal();window.ga&&(window.cordova?window.ga.setUserId(logged.userID):window.ga("set","userId",logged.userID));return logged})}}var localforage=require("localforage"),getUrlQuery=require("../utils/getUrlQuery"),$=require("jquery");exports.plugIn=function(AppModel){AppModel.prototype.login=function login(username,password){this.rest.extraHeaders=null;return this.rest.post("login",{username:username,password:password,returnProfile:!0}).then(performLocalLogin(this,username,password))};AppModel.prototype.facebookLogin=function facebookLogin(accessToken){this.rest.extraHeaders=null;return this.rest.post("login/facebook",{accessToken:accessToken,returnProfile:!0}).then(function(logged){return performLocalLogin(this,logged.profile.email,null)(logged)}.bind(this))};AppModel.prototype.logout=function logout(){this.rest.extraHeaders=null;localforage.removeItem("credentials");localforage.removeItem("profile");this.clearLocalData();this.rest.post("logout");return Promise.resolve()};AppModel.prototype.signup=function signup(data){this.rest.extraHeaders=null;data.returnProfile=!0;var query=getUrlQuery(),utm={utm_source:window.cordova?"app":"web"};query.forEach(function(name){/^utm_/.test(name)&&(utm[name]=query[name])});return this.rest.post("signup?"+$.param(utm),data).then(performLocalLogin(this,data.email,data.password))};AppModel.prototype.resetPassword=function resetPassword(data){var username=data.username||data.email;return this.rest.post("auth/reset-password",{username:username})};AppModel.prototype.confirmResetPassword=function confirmResetPassword(data){return this.rest.post("auth/reset-password/confirm",data)}}},{"../utils/getUrlQuery":133,localforage:!1}],5:[function(require,module,exports){"use strict";var CacheControl=require("../utils/CacheControl"),moment=require("moment"),EventEmitter=require("events").EventEmitter;exports.create=function create(appModel){function Api(){EventEmitter.call(this);this.setMaxListeners(30)}function saveTimesInCache(userID,queryKey,data){var userC=cache.times[userID],c=userC&&userC[queryKey];if(c){c.times=data.times;c.incrementsSizeInMinutes=data.incrementsSizeInMinutes;c.control.touch()}else{userC||(userC=cache.times[userID]={});c=userC[queryKey]={times:data.times,incrementsSizeInMinutes:data.incrementsSizeInMinutes,control:new CacheControl({ttl:{minutes:1}}),getFreeTimeSlots:function(duration,slotSizeMinutes,includeEndTime){var size=slotSizeMinutes||this.incrementsSizeInMinutes;duration=duration||size;return createTimeSlots.forList(this.times,size,duration,!0,includeEndTime)}}}return c}function getTimesFromCache(userID,queryKey){var userC=cache.times[userID],c=userC&&userC[queryKey];return c&&!c.control.mustRevalidate()?c:void 0}Api._inherits(EventEmitter);var api=new Api,cache={times:{}};api.clearCache=function clearCache(){cache.times={};this.emit("clearCache")};api.clearUserCache=function clearUserCache(userID){delete cache.times[userID];this.emit("clearCache",{userID:userID})};appModel.on("clearLocalData",function(){api.clearCache()});var createTimeSlots=require("../utils/createTimeSlots");api.times=function times(userID,start,end){end||(end=moment(start).add(1,"day").toDate());var queryKey=start.toISOString()+"-"+end.toISOString(),cached=getTimesFromCache(userID,queryKey);return cached?Promise.resolve(cached):appModel.rest.get("users/"+userID+"/availability/times",{start:start,end:end}).then(function(data){data.times=createTimeSlots.filterListBy(data.times,start,end);return saveTimesInCache(userID,queryKey,data)})};return api}},{"../utils/CacheControl":109,"../utils/createTimeSlots":127,events:!1,moment:!1}],6:[function(require,module,exports){"use strict";var Booking=require("../models/Booking"),moment=require("moment"),ko=require("knockout");exports.create=function create(appModel){var api={remote:{rest:appModel.rest,getBookings:function(filters){return appModel.rest.get("me/bookings",filters).then(function(rawItems){return rawItems&&rawItems.map(function(rawItem){return new Booking(rawItem)})})}}};api.getBookingsByDates=function getBookingsByDates(date,end){end=end||moment(date).clone().add(1,"days").toDate();return api.remote.getBookings({start:date,end:end}).then(function(bookings){var arr=ko.observableArray(bookings);return arr})};api.getUpcomingBookings=function getUpcomingBookings(){return appModel.rest.get("me/upcoming-bookings")};api.getUpcomingAppointments=function getUpcomingAppointments(){return appModel.rest.get("me/upcoming-appointments")};api.getBooking=function getBooking(id){return id?appModel.rest.get("me/bookings/"+id).then(function(booking){return new Booking(booking)}):Promise.reject("The bookingID is required to get a booking")};api.appointmentToSimplifiedBooking=function(apt){return{bookingID:apt.sourceBooking().bookingID(),jobTitleID:apt.jobTitleID(),clientUserID:apt.clientUserID(),serviceAddress:apt.address()?apt.address().model.toPlainObject():null,startTime:apt.startTime(),services:apt.pricing().map(function(pricing){return pricing.serviceProfessionalServiceID()}),preNotesToClient:apt.preNotesToClient(),preNotesToSelf:apt.preNotesToSelf(),postNotesToClient:apt.postNotesToClient(),postNotesToSelf:apt.postNotesToSelf()}};api.bookingToSimplifiedBooking=function(booking){return{bookingID:booking().bookingID(),clientUserID:booking.clientUserID(),serviceAddress:booking.serviceAddress().model.toPlainObject(),startTime:booking.startTime(),services:booking.pricingSummary()&&booking.pricingSummary().details().pricing.map(function(pricing){return pricing.serviceProfessionalServiceID()}),preNotesToClient:booking.preNotesToClient(),preNotesToSelf:booking.preNotesToSelf(),postNotesToClient:booking.postNotesToClient(),postNotesToSelf:booking.postNotesToSelf()}};api.setServiceProfessionalBooking=function setServiceProfessionalBooking(booking,allowBookUnavailableTime){booking=booking.bookingID?api.bookingToSimplifiedBooking(booking):booking.sourceBooking?api.appointmentToSimplifiedBooking(booking):booking;var id=booking.bookingID||"",method=id?"put":"post";booking.allowBookUnavailableTime=allowBookUnavailableTime||!1;return appModel.rest[method]("me/service-professional-booking/"+id,booking).then(function(serverBooking){if(!booking.serviceAddress.addressID)if(booking.serviceAddress.userID==booking.clientUserID){appModel.clientAddresses.clearCache();appModel.clientAddresses.removeGroupFromLocalCache(booking.clientUserID)}else{appModel.serviceAddresses.clearCache();appModel.serviceAddresses.removeGroupFromLocalCache(booking.jobTitleID)}return new Booking(serverBooking)})};api.declineBookingByServiceProfessional=function declineBookingByServiceProfessional(bookingID){return appModel.rest.post("me/service-professional-booking/"+bookingID+"/deny").then(function(serverBooking){appModel.calendar.clearCache();return new Booking(serverBooking)})};api.cancelBookingByServiceProfessional=function cancelBookingByServiceProfessional(bookingID){return appModel.rest.post("me/service-professional-booking/"+bookingID+"/cancel").then(function(serverBooking){appModel.calendar.clearCache();return new Booking(serverBooking)})};api.cancelBookingByClient=function cancelBookingByClient(bookingID){return appModel.rest.post("me/client-booking/"+bookingID+"/cancel").then(function(serverBooking){return new Booking(serverBooking)})};api.declineBookingByClient=function declineBookingByClient(bookingID){return appModel.rest.post("me/client-booking/"+bookingID+"/deny").then(function(serverBooking){return new Booking(serverBooking)})};api.confirmBookingRequest=function confirmBookingRequest(bookingID,dateType){return appModel.rest.post("me/service-professional-booking/"+bookingID+"/confirm",{dateType:dateType}).then(function(serverBooking){appModel.calendar.clearCache();return new Booking(serverBooking)})};var createClientBookingRequest=function(booking,requestOptions,paymentMethod){var billingAddress=paymentMethod&&paymentMethod.billingAddress();paymentMethod=paymentMethod&&paymentMethod.model.toPlainObject();if(billingAddress){billingAddress=billingAddress.model.toPlainObject();delete paymentMethod.billingAddress}return{serviceProfessionalUserID:booking.serviceProfessionalUserID(),jobTitleID:booking.jobTitleID(),serviceStartTime:booking.serviceDate()&&booking.serviceDate().startTime(),alternative1StartTime:booking.alternativeDate1()&&booking.alternativeDate1().startTime(),alternative2StartTime:booking.alternativeDate2()&&booking.alternativeDate2().startTime(),serviceAddress:booking.serviceAddress()&&booking.serviceAddress().model.toPlainObject(),services:booking.pricingSummary()&&booking.pricingSummary().details().map(function(pricing){return pricing.serviceProfessionalServiceID()}),bookCode:ko.unwrap(requestOptions.bookCode),promotionalCode:ko.unwrap(requestOptions.promotionalCode),billingAddress:billingAddress&&{addressLine1:billingAddress.addressLine1,addressLine2:billingAddress.addressLine2,postalCode:billingAddress.postalCode},paymentMethod:paymentMethod,specialRequests:booking.specialRequests()}};api.requestClientBooking=function requestClientBooking(booking,requestOptions,billingAddress,paymentMethod){var data=createClientBookingRequest(booking,requestOptions,billingAddress,paymentMethod);return appModel.rest.post("me/client-booking",data)};api.getNewClientBooking=function getNewClientBooking(options){return appModel.rest.get("me/client-booking",options)};var createClientBookingUpdateObject=function(booking){return{serviceStartTime:booking.serviceDate()&&booking.serviceDate().startTime(),serviceAddress:booking.serviceAddress()&&booking.serviceAddress().model.toPlainObject(),services:booking.pricingSummary()&&booking.pricingSummary().details().map(function(pricing){return pricing.serviceProfessionalServiceID()}),specialRequests:booking.specialRequests()}};api.setClientBooking=function setClientBooking(booking){return appModel.rest.put("me/client-booking/"+booking.bookingID(),createClientBookingUpdateObject(booking))};return api}},{"../models/Booking":51,knockout:!1,moment:!1}],7:[function(require,module,exports){"use strict";var Appointment=require("../models/Appointment"),DateAvailability=require("../models/DateAvailability"),DateCache=require("../utils/DateCache"),EventEmitter=require("events").EventEmitter;exports.create=function create(appModel){function Api(){EventEmitter.call(this);this.setMaxListeners(30)}Api._inherits(EventEmitter);var api=new Api,cache=new DateCache({Model:DateAvailability,ttl:{minutes:10}});api.clearCache=function clearCache(){cache.clear();this.emit("clearCache")};appModel.on("clearLocalData",function(){api.clearCache()});api.getAppointment=function getAppointment(ids){return ids.calendarEventID?appModel.calendarEvents.getEvent(ids.calendarEventID).then(Appointment.fromCalendarEvent):ids.bookingID?appModel.bookings.getBooking(ids.bookingID).then(function(booking){return appModel.calendarEvents.getEvent(booking.serviceDateID()).then(function(event){return Appointment.fromBooking(booking,event)})}):Promise.reject("Unrecognized ID")};api.setAppointment=function setAppointment(apt,allowBookUnavailableTime){return apt.sourceBooking()?appModel.bookings.setServiceProfessionalBooking(apt,allowBookUnavailableTime).then(function(booking){api.clearCache();return appModel.calendarEvents.getEvent(booking.serviceDateID()).then(function(event){return Appointment.fromBooking(booking,event)})}):apt.sourceEvent()?appModel.calendarEvents.setEvent(apt).then(function(event){return Appointment.fromCalendarEvent(event)}):Promise.reject(new Error("Unrecognized appointment object"))};var getRemoteAppointmentsByDate=function getRemoteAppointmentsByDate(date){return Promise.all([appModel.bookings.getBookingsByDates(date),appModel.calendarEvents.getEventsByDates(date)]).then(function(group){var events=group[1],bookings=group[0],apts=[];events&&events().length&&(apts=Appointment.listFromCalendarEventsBookings(events(),bookings()));return apts})},getRemoteDateAvailability=function getRemoteDateAvailability(date){return Promise.all([getRemoteAppointmentsByDate(date),appModel.weeklySchedule.load(),appModel.schedulingPreferences.load()]).then(function(result){var apts=result[0],settings=result[1],prefs=result[2],dateInfo={date:date,appointmentsList:apts||[],weeklySchedule:settings,schedulingPreferences:prefs};return dateInfo})};api.getDateAvailability=function getDateAvailability(date){var cached=cache.getSingle(date);return cached?Promise.resolve(cached):getRemoteDateAvailability(date).then(function(dateInfo){return cache.set(date,dateInfo).data})};return api}},{"../models/Appointment":50,"../models/DateAvailability":57,"../utils/DateCache":110,events:!1}],8:[function(require,module,exports){"use strict";var CalendarEvent=require("../models/CalendarEvent"),moment=require("moment"),ko=require("knockout");exports.create=function create(appModel){var api={remote:{rest:appModel.rest,getCalendarEvents:function(filters){return appModel.rest.get("me/events",filters).then(function(rawItems){return rawItems&&rawItems.map(function(rawItem){return new CalendarEvent(rawItem)})})}}};api.getEventsByDates=function getEventsByDates(date,end){end=end||moment(date).clone().add(1,"days").toDate();return api.remote.getCalendarEvents({start:date,end:end}).then(function(events){var arr=ko.observableArray(events);return arr})};api.getEvent=function getEvent(id){return id?appModel.rest.get("me/events/"+id).then(function(event){return new CalendarEvent(event)}):Promise.reject("The calendarEventID is required to get an event")};api.appointmentToSimplifiedEvent=function(apt){var rrule=apt.sourceEvent().recurrenceRule();rrule&&(rrule=apt.sourceEvent().recurrenceRule().model.toPlainObject());var occs=apt.sourceEvent().recurrenceOccurrences();occs&&(occs=occs.map(function(occ){return occ&&occ.model.toPlainObject()||null}).filter(function(occ){return null!==occ}));return{calendarEventID:apt.id()<0?0:apt.id(),eventTypeID:apt.sourceEvent().eventTypeID(),summary:apt.summary(),description:apt.description(),availabilityTypeID:apt.sourceEvent().availabilityTypeID(),location:apt.addressSummary(),startTime:apt.startTime(),endTime:apt.endTime(),isAllDay:apt.sourceEvent().isAllDay(),recurrenceRule:rrule,recurrenceOccurrences:occs}};api.setEvent=function setEvent(event){event=event.calendarEventID?event.model.toPlainObject():event.sourceEvent?api.appointmentToSimplifiedEvent(event):event;var id=event.calendarEventID||"",method=id?"put":"post";return appModel.rest[method]("me/events"+(id?"/":"")+id,event).then(function(serverEvent){return new CalendarEvent(serverEvent)})};return api}},{"../models/CalendarEvent":52,knockout:!1,moment:!1}],9:[function(require,module,exports){"use strict";var ko=require("knockout"),CalendarSyncing=require("../models/CalendarSyncing"),RemoteModel=require("../utils/RemoteModel");exports.create=function create(appModel){var rem=new RemoteModel({data:new CalendarSyncing,ttl:{minutes:1},localStorageName:"calendarSyncing",fetch:function fetch(){return appModel.rest.get("me/calendar-syncing")},push:function push(){return appModel.rest.put("me/calendar-syncing",this.data.model.toPlainObject())}});rem.isReseting=ko.observable(!1);rem.resetExportUrl=function resetExportUrl(){rem.isReseting(!0);return appModel.rest.post("me/calendar-syncing/reset-export-url").then(function(updatedSyncSettings){rem.data.model.updateWith(updatedSyncSettings);rem.isReseting(!1);return updatedSyncSettings})};appModel.on("clearLocalData",function(){rem.clearCache()});return rem}},{"../models/CalendarSyncing":53,"../utils/RemoteModel":122,knockout:!1}],10:[function(require,module,exports){"use strict";var CancellationPolicy=require("../models/CancellationPolicy"),ListRemoteModel=require("../utils/ListRemoteModel"),data=[new CancellationPolicy({cancellationPolicyID:3,name:"Flexible",description:"No cancellation fees if changed or cancelled at least 24 hours in advance, otherwise a cancellation fee of 50% the price of booked services apply (including no-shows).",hoursRequired:24,cancellationFeeBefore:0,cancellationFeeAfter:.5}),new CancellationPolicy({cancellationPolicyID:2,name:"Moderate",description:"No cancellation fees if changed or cancelled at least 24 hours in advance, otherwise a cancellation fee of 100% the price of booked services apply (including no-shows).",hoursRequired:24,cancellationFeeBefore:0,cancellationFeeAfter:1}),new CancellationPolicy({cancellationPolicyID:1,name:"Strict",description:"Cancellation fees of 50% of the price of booked services up to 5 days before the booking start time and 100% after.",hoursRequired:120,cancellationFeeBefore:.5,cancellationFeeAfter:1})];exports.create=function create(appModel){var api=new ListRemoteModel({listTtl:{days:1},itemIdField:"cancellationPolicyID",Model:CancellationPolicy});appModel.on("clearLocalData",function(){});api.list(data);api.getList=function(){return Promise.resolve(data)};return api}},{"../models/CancellationPolicy":54,"../utils/ListRemoteModel":119}],11:[function(require,module,exports){"use strict";var Address=require("../models/Address"),GroupListRemoteModel=require("../utils/GroupListRemoteModel");exports.create=function create(appModel){var api=new GroupListRemoteModel({listTtl:{minutes:1},groupIdField:"userID",
itemIdField:"addressID",Model:Address});api.addLocalforageSupport("addresses/clients/");api.addRestSupport(appModel.rest,"me/addresses/clients/");appModel.on("clearLocalData",function(){api.clearCache()});return api}},{"../models/Address":49,"../utils/GroupListRemoteModel":115}],12:[function(require,module,exports){"use strict";var Booking=require("../models/Booking"),ko=require("knockout"),CacheControl=require("../utils/CacheControl"),localforage=require("localforage"),moment=require("moment");exports.create=function create(appModel){function loadLocalCopy(){return localforage.getItem("clientAppointments").then(function(data){if(data){data.latest&&(cache.latest=new Date(data.latest));data.data&&cache.data(data.data.map(function(b){return new Booking(b)}));if(data.range){cache.range.startTime=data.range.startTime?new Date(data.range.startTime):null;cache.range.endTime=data.range.endTime?new Date(data.range.endTime):null}}})}function saveLocalCopy(){return localforage.setItem("clientAppointments",{latest:cache.latest,data:cache.data().map(function(b){return b.model.toPlainObject(!0)})})}function isClientBooking(booking){return appModel.userProfile.data.userID()===booking.clientUserID()}function sortBookingByDateComparator(a,b){var c=a.serviceDate().startTime()>b.serviceDate().startTime();return c?1:-1}function getFromRemote(options){if(remoteRequest)return remoteRequest;options=options||{};var start=new Date,end=moment().add(3,"month").toDate();remoteRequest=appModel.bookings.getBookingsByDates(start,end).then(function(remoteData){remoteRequest=null;var d=remoteData().filter(isClientBooking).sort(sortBookingByDateComparator);if(d&&d.length){cache.range.startTime=d[0].serviceDate().startTime();cache.range.endTime=d[d.length-1].serviceDate().endTime();cache.touch();cache.data(d);saveLocalCopy()}else cache.data([])})["catch"](function(er){remoteRequest=null;throw er});return remoteRequest}function syncData(){var p=Promise.resolve();cache.localLoaded||(p=loadLocalCopy());cache.mustRevalidate()&&(p=p.then(getFromRemote));return p}var cache=new CacheControl({ttl:{minutes:10},data:ko.observableArray([])});cache.localLoaded=!1;cache.range={startTime:null,endTime:null};var remoteRequest=null,api={};api.sync=syncData;api.list=cache.data;api.clearCache=function(){cache.data([]);cache.reset()};appModel.on("clearLocalData",function(){api.clearCache()});return api}},{"../models/Booking":51,"../utils/CacheControl":109,knockout:!1,localforage:!1,moment:!1}],13:[function(require,module,exports){"use strict";var Client=require("../models/Client"),ListRemoteModel=require("../utils/ListRemoteModel");exports.create=function create(appModel){var api=new ListRemoteModel({listTtl:{minutes:1},itemIdField:"clientUserID",Model:Client});api.addLocalforageSupport("clients");api.addRestSupport(appModel.rest,"me/clients");appModel.on("clearLocalData",function(){api.clearCache()});var publicSearchRequest=null;api.publicSearch=function publicSearch(search){if(publicSearchRequest&&publicSearchRequest.abort)try{publicSearchRequest.abort()}catch(abortErr){console.error("Error aborting request",abortErr)}var request=appModel.rest.get("me/clients/public-search",search);publicSearchRequest=request.xhr;request=request["catch"](function(err){if(err&&"abort"===err.statusText)return[];throw err});request.xhr=publicSearchRequest;return request};return api}},{"../models/Client":56,"../utils/ListRemoteModel":119}],14:[function(require,module,exports){"use strict";var UserEducation=require("../models/UserEducation"),ListRemoteModel=require("../utils/ListRemoteModel");exports.create=function create(appModel){var api=new ListRemoteModel({listTtl:{minutes:1},itemIdField:"educationID",Model:UserEducation});api.addLocalforageSupport("education");api.addRestSupport(appModel.rest,"me/education");appModel.on("clearLocalData",function(){api.clearCache()});return api}},{"../models/UserEducation":100,"../utils/ListRemoteModel":119}],15:[function(require,module,exports){"use strict";exports.create=function create(appModel){var getUserDeviceInfo=function getUserDeviceInfo(){var dev=window.device||{platform:"web",model:"unknow",cordova:"",version:""};return{userAgent:navigator.userAgent,platform:dev.platform,version:dev.version,model:dev.model,cordova:dev.cordova}};return{postIdea:function postIdea(values){values.userDevice=JSON.stringify(getUserDeviceInfo());return appModel.rest.post("feedback/ideas",values)},postSupport:function postSupport(values){values.userDevice=JSON.stringify(getUserDeviceInfo());return appModel.rest.post("feedback/support",values)}}}},{}],16:[function(require,module,exports){"use strict";function getArticlesUrl(labels){return articlesUrl+encodeURIComponent(labels)}function getRemoteArticles(labels){var result=[];return Promise.resolve($.get(getArticlesUrl(labels))).then(function next(data){data.articles&&(result=result.concat(data.articles));return data.next_page?$.get(data.next_page).then(next):result})}function getRemoteCategories(){var result=[];return Promise.resolve($.get(categoriesUrl)).then(function next(data){data.categories&&(result=result.concat(data.categories));return data.next_page?$.get(data.next_page).then(next):result})}function getRemoteSections(){var result=[];return Promise.resolve($.get(sectionsUrl)).then(function next(data){data.sections&&(result=result.concat(data.sections));return data.next_page?$.get(data.next_page).then(next):result})}var ko=require("knockout"),articlesUrl="https://loconomics.zendesk.com/api/v2/help_center/en-us/articles.json?label_names=",categoriesUrl="https://loconomics.zendesk.com/api/v2/help_center/en-us/categories.json",sectionsUrl="https://loconomics.zendesk.com/api/v2/help_center/en-us/sections.json",$=require("jquery"),CacheControl=require("../utils/CacheControl");exports.create=function create(appModel){var ttl={days:1},cache={categories:new CacheControl({ttl:ttl}),sections:new CacheControl({ttl:ttl}),articles:{},clear:function(){this.categories.reset();this.categories.data=null;this.sections.reset();this.sections.data=null;this.articles={}},getArticlesCache:function(labels){var cacheItem=this.articles[labels];cacheItem||(cacheItem=this.articles[labels]=new CacheControl({ttl:ttl}));return cacheItem},setArticles:function(labels,data){var cacheItem=this.getArticlesCache(labels);cacheItem.data=data;cacheItem.latest=new Date;return cacheItem}},api={};api.clearCache=function(){cache.clear()};appModel.on("clearLocalData",function(){api.clearCache()});var HelpCategory=require("../models/HelpCategory");api.isLoadingCategories=ko.observable(!1);api.getCategories=function(){if(cache.categories.mustRevalidate()){api.isLoadingCategories(!0);return getRemoteCategories().then(function(data){cache.categories.data=data.map(function(a){return new HelpCategory(a)});cache.categories.latest=new Date;api.isLoadingCategories(!1);return cache.categories.data},function(err){api.isLoadingCategories(!1);throw err})}return Promise.resolve(cache.categories.data)};var HelpSection=require("../models/HelpSection");api.isLoadingSections=ko.observable(!1);api.getSections=function(){if(cache.sections.mustRevalidate()){api.isLoadingSections(!0);return getRemoteSections().then(function(data){cache.sections.data=data.map(function(a){return new HelpSection(a)});cache.sections.latest=new Date;api.isLoadingSections(!1);return cache.sections.data},function(err){api.isLoadingSections(!1);throw err})}return Promise.resolve(cache.sections.data)};var HelpArticle=require("../models/HelpArticle");api.isLoadingArticles=ko.observable(!1);api.getArticles=function(labels){labels=labels||"";var cached=cache.getArticlesCache(labels);if(cached.mustRevalidate()){api.isLoadingArticles(!0);return getRemoteArticles(labels).then(function(data){cache.setArticles(labels,data.map(function(a){return new HelpArticle(a)}));api.isLoadingArticles(!1);return cached.data},function(err){api.isLoadingArticles(!1);throw err})}return Promise.resolve(cached.data)};api.findByIdAt=function(id,atList){var found;atList.some(function(item){if(item.id()==id){found=item;return!0}});return found};api.getCategory=function(id){return api.getCategories().then(function(list){return api.findByIdAt(id,list)})};api.getSection=function(id){return api.getSections().then(function(list){return api.findByIdAt(id,list)})};api.getArticle=function(id){return api.getArticles().then(function(list){return api.findByIdAt(id,list)})};api.getArticlesBySection=function(sectionID){return api.getArticles().then(function(list){return list.filter(function(item){return item.section_id()==sectionID})})};api.getSectionsByCategory=function(categoryID){return api.getSections().then(function(list){return list.filter(function(item){return item.category_id()==categoryID})})};return api}},{"../models/HelpArticle":60,"../models/HelpCategory":61,"../models/HelpSection":62,"../utils/CacheControl":109,knockout:!1}],17:[function(require,module,exports){"use strict";var Address=require("../models/Address"),RemoteModel=require("../utils/RemoteModel");exports.create=function create(appModel){var rem=new RemoteModel({data:new Address,ttl:{minutes:1},localStorageName:"homeAddress",fetch:function fetch(){return appModel.rest.get("me/addresses/home")},push:function push(){return appModel.rest.put("me/addresses/home",this.data.model.toPlainObject())}});appModel.on("clearLocalData",function(){rem.clearCache()});return rem}},{"../models/Address":49,"../utils/RemoteModel":122}],18:[function(require,module,exports){"use strict";var JobTitleLicense=require("../models/JobTitleLicense"),GroupRemoteModel=require("../utils/GroupRemoteModel");exports.create=function create(appModel){var api=new GroupRemoteModel({ttl:{minutes:1},itemIdField:"jobTitleID",Model:JobTitleLicense});api.addLocalforageSupport("job-title-licenses/");api.addRestSupport(appModel.rest,"me/job-title-licenses/");appModel.on("clearLocalData",function(){api.clearCache()});return api}},{"../models/JobTitleLicense":66,"../utils/GroupRemoteModel":116}],19:[function(require,module,exports){"use strict";var JobTitleServiceAttributes=require("../models/JobTitleServiceAttributes"),GroupRemoteModel=require("../utils/GroupRemoteModel");exports.create=function create(appModel){var api=new GroupRemoteModel({ttl:{hours:1},itemIdField:"jobTitleID",Model:JobTitleServiceAttributes});api.addLocalforageSupport("job-title-service-attributes/");api.addRestSupport(appModel.rest,"job-title-service-attributes/");appModel.on("clearLocalData",function(){api.clearCache()});return api}},{"../models/JobTitleServiceAttributes":70,"../utils/GroupRemoteModel":116}],20:[function(require,module,exports){"use strict";var localforage=require("localforage"),JobTitle=require("../models/JobTitle"),ko=require("knockout"),CacheControl=require("../utils/CacheControl");exports.create=function create(appModel){var api={state:{isLoading:ko.observable(!1)}},cache={jobTitles:{}},getCacheItem=function(id){var c=cache.jobTitles[id];c||(c=cache.jobTitles[id]=new CacheControl({ttl:{minutes:60}}));return c},setCacheItem=function(id,rawData){var c=getCacheItem(id);c.data?c.data.model.updateWith(rawData,!0):c.data=new JobTitle(rawData);c.touch();return c};api.clearCache=function clearCache(){cache.jobTitles={}};appModel.on("clearLocalData",function(){api.clearCache()});api.getJobTitle=function getJobTitle(id){if(!id)return Promise.reject("Needs an ID to get a Job Title");var c=getCacheItem(id);if(c.request)return c.request;if(c.mustRevalidate()){api.state.isLoading(!0);c.request=localforage.getItem("jobTitles/"+id).then(function(jobTitle){jobTitle&&(c.latest=new Date(jobTitle.updatedDate));if(c.mustRevalidate())return appModel.rest.get("job-titles/"+id).then(function(raw){localforage.setItem("jobTitles/"+id,raw);api.state.isLoading(!1);c.request=null;return setCacheItem(id,raw).data});api.state.isLoading(!1);c.request=null;return setCacheItem(id,jobTitle).data})["catch"](function(err){api.state.isLoading(!1);c.request=null;throw err});return c.request}return Promise.resolve(c.data)};return api}},{"../models/JobTitle":63,"../utils/CacheControl":109,knockout:!1,localforage:!1}],21:[function(require,module,exports){function AppModel(){EventEmitter.call(this);this.setMaxListeners(50)}var ko=require("knockout"),$=require("jquery"),Rest=require("../utils/Rest"),localforage=require("localforage"),EventEmitter=require("events").EventEmitter;AppModel._inherits(EventEmitter);module.exports=AppModel;require("./AppModel-account").plugIn(AppModel);AppModel.prototype.loadLocalCredentials=function loadLocalCredentials(){return new Promise(function(resolve){var resolveAnyway=function(doesnMatter){console.warning("App Model Init err",doesnMatter);resolve()};localforage.getItem("credentials").then(function(credentials){if(credentials&&credentials.userID&&credentials.username&&credentials.authKey){this.rest.extraHeaders={Authorization:"LC alu="+credentials.userID+",alk="+credentials.authKey};this.userProfile.load().then(resolve,resolveAnyway);window.ga&&(window.cordova?window.ga.setUserId(credentials.userID):window.ga("set","userId",credentials.userID))}else resolve()}.bind(this),resolveAnyway)}.bind(this))};AppModel.prototype.init=function init(){localforage.config({name:"LoconomicsApp",version:.1,size:4980736,storeName:"keyvaluepairs",description:"Loconomics App",driver:localforage.LOCALSTORAGE});return localforage.getItem("config").then(function(config){config=config||{};config.siteUrl?$("html").attr("data-site-url",config.siteUrl):config.siteUrl=$("html").attr("data-site-url")||"";this.config=config;this.rest=new Rest(config.siteUrl+"/api/v1/en-US/");this.loadModules();return this.loadLocalCredentials()}.bind(this))};AppModel.prototype.loadModules=function loadModules(){this.userProfile=require("./AppModel.userProfile").create(this);this.user=ko.computed(function(){return this.userProfile.data},this);this.onboarding=require("./AppModel.onboarding").create(this);this.schedulingPreferences=require("./AppModel.schedulingPreferences").create(this);this.calendarSyncing=require("./AppModel.calendarSyncing").create(this);this.weeklySchedule=require("./AppModel.weeklySchedule").create(this);this.marketplaceProfile=require("./AppModel.marketplaceProfile").create(this);this.homeAddress=require("./AppModel.homeAddress").create(this);this.privacySettings=require("./AppModel.privacySettings").create(this);this.bookings=require("./AppModel.bookings").create(this);this.calendarEvents=require("./AppModel.calendarEvents").create(this);this.jobTitles=require("./AppModel.jobTitles").create(this);this.userJobProfile=require("./AppModel.userJobProfile").create(this);this.calendar=require("./AppModel.calendar").create(this);this.serviceAddresses=require("./AppModel.serviceAddresses").create(this);this.serviceProfessionalServices=require("./AppModel.serviceProfessionalServices").create(this);this.pricingTypes=require("./AppModel.pricingTypes").create(this);this.messaging=require("./AppModel.messaging").create(this);this.clients=require("./AppModel.clients").create(this);this.postalCodes=require("./AppModel.postalCodes").create(this);this.feedback=require("./AppModel.feedback").create(this);this.education=require("./AppModel.education").create(this);this.users=require("./AppModel.users").create(this);this.availability=require("./AppModel.availability").create(this);this.serviceAttributes=require("./AppModel.serviceAttributes").create(this);this.jobTitleServiceAttributes=require("./AppModel.jobTitleServiceAttributes").create(this);this.userVerifications=require("./AppModel.userVerifications").create(this);this.workPhotos=require("./AppModel.workPhotos").create(this);this.userLicensesCertifications=require("./AppModel.userLicensesCertifications").create(this);this.statesProvinces=require("./AppModel.statesProvinces").create(this);this.paymentAccount=require("./AppModel.paymentAccount").create(this);this.clientAppointments=require("./AppModel.clientAppointments").create(this);this.jobTitleLicenses=require("./AppModel.jobTitleLicenses").create(this);this.licenseCertification=require("./AppModel.licenseCertification").create(this);this.clientAddresses=require("./AppModel.clientAddresses").create(this);this.cancellationPolicies=require("./AppModel.cancellationPolicies").create(this);this.help=require("./AppModel.help").create(this);this.emit("modulesLoaded")};AppModel.prototype.clearLocalData=function clearLocalData(){return localforage.getItem("config").then(function(config){localforage.clear();config&&localforage.setItem("config",config);this.emit("clearLocalData")}.bind(this))}},{"../utils/Rest":123,"./AppModel-account":4,"./AppModel.availability":5,"./AppModel.bookings":6,"./AppModel.calendar":7,"./AppModel.calendarEvents":8,"./AppModel.calendarSyncing":9,"./AppModel.cancellationPolicies":10,"./AppModel.clientAddresses":11,"./AppModel.clientAppointments":12,"./AppModel.clients":13,"./AppModel.education":14,"./AppModel.feedback":15,"./AppModel.help":16,"./AppModel.homeAddress":17,"./AppModel.jobTitleLicenses":18,"./AppModel.jobTitleServiceAttributes":19,"./AppModel.jobTitles":20,"./AppModel.licenseCertification":22,"./AppModel.marketplaceProfile":23,"./AppModel.messaging":24,"./AppModel.onboarding":25,"./AppModel.paymentAccount":26,"./AppModel.postalCodes":27,"./AppModel.pricingTypes":28,"./AppModel.privacySettings":29,"./AppModel.schedulingPreferences":30,"./AppModel.serviceAddresses":31,"./AppModel.serviceAttributes":32,"./AppModel.serviceProfessionalServices":33,"./AppModel.statesProvinces":34,"./AppModel.userJobProfile":35,"./AppModel.userLicensesCertifications":36,"./AppModel.userProfile":37,"./AppModel.userVerifications":38,"./AppModel.users":39,"./AppModel.weeklySchedule":40,"./AppModel.workPhotos":41,events:!1,knockout:!1,localforage:!1}],22:[function(require,module,exports){"use strict";var LicenseCertification=require("../models/LicenseCertification"),GroupRemoteModel=require("../utils/GroupRemoteModel");exports.create=function create(appModel){var api=new GroupRemoteModel({ttl:{month:1},itemIdField:"licenseCertificationID",Model:LicenseCertification});api.addLocalforageSupport("license-certification/");api.addRestSupport(appModel.rest,"license-certification/");appModel.on("clearLocalData",function(){api.clearCache()});return api}},{"../models/LicenseCertification":72,"../utils/GroupRemoteModel":116}],23:[function(require,module,exports){"use strict";var MarketplaceProfile=require("../models/MarketplaceProfile"),RemoteModel=require("../utils/RemoteModel");exports.create=function create(appModel){var rem=new RemoteModel({data:new MarketplaceProfile,ttl:{minutes:1},localStorageName:"marketplaceProfile",fetch:function fetch(){return appModel.rest.get("me/marketplace-profile")},push:function push(){return appModel.rest.put("me/marketplace-profile",this.data.model.toPlainObject())}});appModel.on("clearLocalData",function(){rem.clearCache()});return rem}},{"../models/MarketplaceProfile":73,"../utils/RemoteModel":122}],24:[function(require,module,exports){"use strict";var Thread=require("../models/Thread"),CacheControl=require("../utils/CacheControl"),ListRemoteModel=require("../utils/ListRemoteModel");exports.create=function create(appModel){var api=new ListRemoteModel({listTtl:{minutes:1},itemIdField:"threadID",Model:Thread});api.addLocalforageSupport("messaging");api.addRestSupport(appModel.rest,"me/messaging");appModel.on("clearLocalData",function(){api.clearCache()});var fullThreadsCache={},fetchThreadRemote=function(threadID){return appModel.rest.get("me/messaging/"+threadID,{limit:1e3}).then(function(thread){if(thread){thread=new Thread(thread);var cached=fullThreadsCache[threadID];if(cached){cached.control.latest=new Date;cached.thread=thread}else{fullThreadsCache[threadID]={control:new CacheControl({ttl:{minutes:1}}),thread:thread};fullThreadsCache[threadID].control.latest=new Date}return thread}throw new Error("Not Found")})},markAsEndedAndFollowUp=function(any){api.state.isSyncing(!1);api.state.isLoading(!1);return any};api.getItem=function getItem(threadID){var cached=fullThreadsCache[threadID];if(cached&&cached.thread){if(cached.control.mustRevalidate()){api.state.isSyncing(!0);return fetchThreadRemote(threadID).then(markAsEndedAndFollowUp,markAsEndedAndFollowUp)}return Promise.resolve(cached.thread)}api.state.isLoading(!0);return fetchThreadRemote(threadID).then(markAsEndedAndFollowUp,markAsEndedAndFollowUp)};return api}},{"../models/Thread":97,"../utils/CacheControl":109,"../utils/ListRemoteModel":119}],25:[function(require,module,exports){"use strict";var OnboardingProgress=require("../viewmodels/OnboardingProgress"),NavAction=require("../viewmodels/NavAction"),ko=require("knockout"),localforage=require("localforage");exports.create=function create(appModel){var NAVBAR_TITLE="Create your first listing",api=new OnboardingProgress;api.navbarTitle=function(){return NAVBAR_TITLE};api.currentActivity=ko.observable("");api.init=function init(app){api.app=app;api.currentActivity(app.shell.currentRoute.name);app.shell.on(app.shell.events.itemReady,function(){api.currentActivity(app.shell.currentRoute.name)})};api.setStep=function(stepName){if(this.setStepByName(stepName))return!0;this.model.reset();return!1};api.skipToAddJobTitles=function(){this.setStep(OnboardingProgress.steps.names[1])};api.updateNavBar=function(navBar){var yep=this.inProgress();if(yep){navBar.leftAction(NavAction.menuIn);navBar.title(api.navbarTitle())}return yep};api.goCurrentStep=function(){var url=this.inProgress()?this.stepUrl():"dashboard";this.app.shell.go(url)};api.goNext=function goNext(){var url;if(this.isAtCurrentStep()){this.incrementStep();appModel.userProfile.saveOnboardingStep(this.stepName());url=this.isFinished()?"/onboardingSuccess":this.stepUrl()}else url=this.stepAfter(api.currentActivity()).stepUrl();this.app.shell.go(url,null,!0)};api.isAtCurrentStep=ko.computed(function(){return api.currentActivity()===api.stepName()});api.goIfEnabled=function(){this.inProgress()&&!api.isAtCurrentStep()&&api.app.shell.go(api.stepUrl());return this.inProgress()};var LOCAL_JOBTITLEID_KEY="onboardingJobTitleID",persistLocalJobTitleID=function(jobTitleID){return localforage.setItem(LOCAL_JOBTITLEID_KEY,jobTitleID)},getLocalJobTitleID=function(){return localforage.getItem(LOCAL_JOBTITLEID_KEY)};api.selectedJobTitleID.subscribe(persistLocalJobTitleID);api.recoverLocalJobTitleID=function(){return getLocalJobTitleID().then(function(id){api.selectedJobTitleID(id);return id})};return api}},{"../viewmodels/NavAction":149,"../viewmodels/OnboardingProgress":151,knockout:!1,localforage:!1}],26:[function(require,module,exports){"use strict";var PaymentAccount=require("../models/PaymentAccount"),RemoteModel=require("../utils/RemoteModel");exports.create=function create(appModel){var rem=new RemoteModel({data:new PaymentAccount,ttl:{minutes:1},localStorageName:"paymentAccount",fetch:function fetch(){return appModel.rest.get("me/payment-account")},push:function push(){return appModel.rest.put("me/payment-account",this.data.model.toPlainObject())}});appModel.on("clearLocalData",function(){rem.clearCache()});return rem}},{"../models/PaymentAccount":76,"../utils/RemoteModel":122}],27:[function(require,module,exports){"use strict";exports.create=function create(appModel){var api={},cache={};api.getItem=function getItem(postalCode){postalCode=postalCode||"";return/^\s*$/.test(postalCode)?Promise.reject("Postal Code Not Valid"):cache.hasOwnProperty(postalCode)?Promise.resolve(cache[postalCode]):appModel.rest.get("postal-codes/"+postalCode).then(function(info){info&&(cache[postalCode]=info);return info})};appModel.on("clearLocalData",function(){cache={}});return api}},{}],28:[function(require,module,exports){"use strict";var PricingType=require("../models/PricingType"),ListRemoteModel=require("../utils/ListRemoteModel");exports.create=function create(appModel){var api=new ListRemoteModel({listTtl:{days:1},itemIdField:"pricingTypeID",Model:PricingType});api.addLocalforageSupport("pricing-types");api.addRestSupport(appModel.rest,"pricing-types");appModel.on("clearLocalData",function(){api.clearCache()});api.getListByIDs=function(pricingTypeIDs){return api.getList().then(function(pricingTypes){return pricingTypes().filter(function(pricingType){return pricingTypeIDs.indexOf(pricingType.pricingTypeID())>-1})})};return api}},{"../models/PricingType":79,"../utils/ListRemoteModel":119}],29:[function(require,module,exports){"use strict";var PrivacySettings=require("../models/PrivacySettings"),RemoteModel=require("../utils/RemoteModel");exports.create=function create(appModel){var rem=new RemoteModel({data:new PrivacySettings,ttl:{minutes:1},localStorageName:"privacySettings",fetch:function fetch(){return appModel.rest.get("me/privacy-settings")},push:function push(){return appModel.rest.put("me/privacy-settings",this.data.model.toPlainObject())}});appModel.on("clearLocalData",function(){rem.clearCache()});return rem}},{"../models/PrivacySettings":80,"../utils/RemoteModel":122}],30:[function(require,module,exports){"use strict";var SchedulingPreferences=require("../models/SchedulingPreferences"),RemoteModel=require("../utils/RemoteModel");exports.create=function create(appModel){var rem=new RemoteModel({data:new SchedulingPreferences,ttl:{minutes:1},localStorageName:"schedulingPreferences",fetch:function fetch(){return appModel.rest.get("me/scheduling-preferences")},push:function push(){return appModel.rest.put("me/scheduling-preferences",this.data.model.toPlainObject()).then(function(result){appModel.calendar.clearCache();return result})}});appModel.on("clearLocalData",function(){rem.clearCache()});return rem}},{"../models/SchedulingPreferences":90,"../utils/RemoteModel":122}],31:[function(require,module,exports){"use strict";var Address=require("../models/Address"),GroupListRemoteModel=require("../utils/GroupListRemoteModel");exports.create=function create(appModel){var api=new GroupListRemoteModel({listTtl:{minutes:1},groupIdField:"jobTitleID",itemIdField:"addressID",Model:Address});api.addLocalforageSupport("addresses/service/");api.addRestSupport(appModel.rest,"me/addresses/service/");appModel.on("clearLocalData",function(){api.clearCache()});return api}},{"../models/Address":49,"../utils/GroupListRemoteModel":115}],32:[function(require,module,exports){"use strict";var UserJobTitleServiceAttributes=require("../models/UserJobTitleServiceAttributes"),GroupRemoteModel=require("../utils/GroupRemoteModel");exports.create=function create(appModel){var api=new GroupRemoteModel({ttl:{minutes:1},itemIdField:"jobTitleID",Model:UserJobTitleServiceAttributes});api.addLocalforageSupport("service-attributes/");api.addRestSupport(appModel.rest,"me/service-attributes/");appModel.on("clearLocalData",function(){api.clearCache()});return api}},{"../models/UserJobTitleServiceAttributes":102,"../utils/GroupRemoteModel":116}],33:[function(require,module,exports){"use strict";var ServiceProfessionalService=require("../models/ServiceProfessionalService"),GroupListRemoteModel=require("../utils/GroupListRemoteModel");exports.create=function create(appModel){var api=new GroupListRemoteModel({listTtl:{minutes:1},groupIdField:"jobTitleID",itemIdField:"serviceProfessionalServiceID",Model:ServiceProfessionalService}),restUrlPrefix="me/service-professional-services/";api.addLocalforageSupport("service-professional-services/");api.addRestSupport(appModel.rest,restUrlPrefix);appModel.on("clearLocalData",function(){api.clearCache()});api.getItem=function(jobTitleID,serviceID){api.state.isLoading(!0);return appModel.rest.get(restUrlPrefix+jobTitleID+"/"+serviceID).then(function(data){api.state.isLoading(!1);return data})["catch"](function(err){api.state.isLoading(!1);throw err})};var baseSetItem=api.setItem.bind(api);api.setItem=function(item){return baseSetItem(item).then(function(serverObject){api.clearCache();return serverObject})};api.getClientSpecificServices=function(clientID){return appModel.rest.get(restUrlPrefix+"client/"+clientID)};api.getClientSpecificServicesForJobTitle=function(clientID,jobTitleID){return api.getClientSpecificServices(clientID).then(function(services){return services.filter(function(service){return service.jobTitleID==jobTitleID})})};api.getServicesBookableByProvider=function(clientID,jobTitleID){return appModel.rest.get(restUrlPrefix+jobTitleID+"/client/"+clientID)};return api}},{"../models/ServiceProfessionalService":95,"../utils/GroupListRemoteModel":115}],34:[function(require,module,exports){"use strict";var StateProvince=require("../models/StateProvince"),ListRemoteModel=require("../utils/ListRemoteModel");exports.create=function create(appModel){var api=new ListRemoteModel({listTtl:{years:1},itemIdField:"code",Model:StateProvince});api.addLocalforageSupport("states-provinces");api.addRestSupport(appModel.rest,"states-provinces");appModel.on("clearLocalData",function(){api.clearCache()});return api}},{"../models/StateProvince":96,"../utils/ListRemoteModel":119}],35:[function(require,module,exports){"use strict";var UserJobTitle=require("../models/UserJobTitle"),CacheControl=require("../utils/CacheControl"),localforage=require("localforage"),ko=require("knockout"),$=require("jquery");exports.create=function create(appModel){function mapToUserJobProfile(rawItems){cache.userJobProfile.list=[];cache.userJobTitles={};rawItems&&rawItems.forEach(function(rawItem){var m=new UserJobTitle(rawItem);m.isBeingDeleted=ko.observable(!1);cache.userJobProfile.list.push(m);setGetUserJobTitleToCache(rawItem)});api.list(cache.userJobProfile.list);cache.userJobProfile.cache.latest=new Date;return cache.userJobProfile.list}function getUserJobProfileFromLocal(){return localforage.getItem("userJobProfile").then(function(userJobProfile){return userJobProfile?mapToUserJobProfile(userJobProfile):null})}function deleteUserJobTitleFromCache(jobTitleID){delete cache.userJobTitles[jobTitleID];api.list.remove(function(j){return j.jobTitleID()===jobTitleID});cache.userJobProfile.cache.touch()}function setGetUserJobTitleToCache(rawItem){var c=cache.userJobTitles[rawItem.jobTitleID]||{};if(c.model)c.model.model.updateWith(rawItem);else{c.model=new UserJobTitle(rawItem);c.model.isBeingDeleted=ko.observable(!1)}c.cache?c.cache.latest=new Date:c.cache=new CacheControl({ttl:defaultTtl});var fullList=cache.userJobProfile.list;if(fullList){var found=null;fullList.some(function(it){if(it.jobTitleID()===rawItem.jobTitleID){found=it;return!0}});found?found.model.updateWith(rawItem):fullList.push(c.model)}return c.model}var api={},defaultTtl={minutes:1},cache={userJobProfile:{cache:new CacheControl({ttl:defaultTtl}),list:null},userJobTitles:{}};api.list=ko.observableArray([]);api.syncList=function syncList(){return api.getUserJobProfile().then(function(list){api.list(list);return list})};api.clearCache=function clearCache(){cache.userJobProfile.cache.latest=null;cache.userJobProfile.list=[];cache.userJobTitles={}};appModel.on("clearLocalData",function(){api.clearCache()});var fetchUserJobProfile=function(){return appModel.rest.get("me/user-job-profile").then(function(raw){localforage.setItem("userJobProfile",raw);return mapToUserJobProfile(raw)})},saveCacheToLocal=function(){var raw=cache.userJobProfile.list.map(function(j){return j.model.toPlainObject(!0)});localforage.setItem("userJobProfile",raw)};api.getUserJobProfile=function(){return cache.userJobProfile.cache.mustRevalidate()?cache.userJobProfile.list?fetchUserJobProfile():getUserJobProfileFromLocal().then(function(data){var remotePromise=fetchUserJobProfile();return data?data:remotePromise}):Promise.resolve(cache.userJobProfile.list)};var fetchUserJobTitle=function(jobTitleID){return appModel.rest.get("me/user-job-profile/"+jobTitleID).then(function(raw){var m=setGetUserJobTitleToCache(raw);return m})},pushNewUserJobTitle=function(values){return appModel.rest.post("me/user-job-profile",$.extend({jobTitleID:0,jobTitleName:"",intro:"",cancellationPolicyID:null,instantBooking:!1},values)).then(function(raw){var m=setGetUserJobTitleToCache(raw);return m})};api.getUserJobTitle=function(jobTitleID){
return jobTitleID?!cache.userJobTitles[jobTitleID]||cache.userJobTitles[jobTitleID].cache.mustRevalidate()?fetchUserJobTitle(jobTitleID):cache.userJobTitles[jobTitleID]&&cache.userJobTitles[jobTitleID].model?Promise.resolve(cache.userJobTitles[jobTitleID].model):getUserJobProfileFromLocal().then(function(){return cache.userJobTitles[jobTitleID].model})["catch"](fetchUserJobTitle.bind(null,jobTitleID)):Promise.reject("Job Title ID required")};api.setUserJobTitle=function(values){return appModel.rest.put("me/user-job-profile/"+values.jobTitleID,values).then(function(raw){var m=setGetUserJobTitleToCache(raw);return m})};api.createUserJobTitle=function(values){return pushNewUserJobTitle(values)};api.deactivateUserJobTitle=function(jobTitleID){return appModel.rest.post("me/user-job-profile/"+(0|jobTitleID)+"/deactivate").then(function(raw){var m=setGetUserJobTitleToCache(raw);return m})};api.reactivateUserJobTitle=function(jobTitleID){return appModel.rest.post("me/user-job-profile/"+(0|jobTitleID)+"/reactivate").then(function(raw){var m=setGetUserJobTitleToCache(raw);return m})};api.deleteUserJobTitle=function(jobTitleID){var found=api.list().filter(function(j){j.jobTitleID()===jobTitleID&&j.isBeingDeleted(!0)});return appModel.rest["delete"]("me/user-job-profile/"+(0|jobTitleID)).then(function(){deleteUserJobTitleFromCache(jobTitleID);saveCacheToLocal();return null})["catch"](function(err){found.forEach(function(j){j.isBeingDeleted(!1)});throw err})};api.getUserJobTitleAndJobTitle=function getUserJobTitleAndJobTitle(jobTitleID){return api.getUserJobTitle(jobTitleID).then(function(userJobTitle){if(!userJobTitle)throw{name:"Not Found",message:"We don't have a record of this job titleIt may have been recently deleted."};return Promise.all([userJobTitle,appModel.jobTitles.getJobTitle(jobTitleID)])}).then(function(all){var jobTitle=all[1];if(!jobTitle)throw{name:"Not Found",message:"The job title does not exist."};return{jobTitleID:jobTitleID,userJobTitle:all[0],jobTitle:jobTitle}})};api.getJobTitles=function(){return api.getUserJobProfile().then(function(list){return Promise.all(list.map(function(userJobTitle){return appModel.jobTitles.getJobTitle(userJobTitle.jobTitleID())}))})};return api}},{"../models/UserJobTitle":101,"../utils/CacheControl":109,knockout:!1,localforage:!1}],36:[function(require,module,exports){"use strict";var UserLicenseCertification=require("../models/UserLicenseCertification"),GroupListRemoteModel=require("../utils/GroupListRemoteModel"),photoTools=require("../utils/photoTools"),extend=require("jquery").extend,$=require("jquery");exports.create=function create(appModel){var baseUrl="me/licenses-certifications/",api=new GroupListRemoteModel({listTtl:{minutes:1},groupIdField:"jobTitleID",itemIdField:"userLicenseCertificationID",Model:UserLicenseCertification});api.addLocalforageSupport("userLicensesCertifications/");api.addRestSupport(appModel.rest,baseUrl);appModel.on("clearLocalData",function(){api.clearCache()});var pushJustBasicDataToRemote=api.pushItemToRemote.bind(api),photoUploadFieldName="photo",pushWithoutFile=function(data){return 0===data.userLicenseCertificationID?Promise.reject("An image of the license/certification is required"):pushJustBasicDataToRemote(data)},nativeUploadFile=function pushToRemote(data,options){if(data.localTempFilePath){var uploadSettings={fileKey:photoUploadFieldName,httpMethod:options.method,params:data,headers:extend(!0,{},appModel.rest.extraHeaders)};return photoTools.uploadLocalFileJson(data.localTempFilePath,options.url,uploadSettings)}return pushWithoutFile(data)}.bind(api),webUploadFile=function(data,options){if(data.localTempFileData){var fd=data.localTempFileData;if(!fd)return Promise.resolve(null);fd.url=options.url;fd.type=options.method;fd.paramName=photoUploadFieldName;fd.formData=Object.keys(data).filter(function(k){return!/^local/.test(k)}).map(function(k){return{name:k,value:data[k]}});fd.headers=$.extend(!0,{},appModel.rest.extraHeaders);return Promise.resolve(fd.submit())}return pushWithoutFile(data)};api.pushItemToRemote=function pushToRemote(data){var groupID=data[this.settings.groupIdField],itemID=data[this.settings.itemIdField],options={method:itemID?"put":"post",url:appModel.rest.baseUrl+baseUrl+groupID+(itemID?"/"+itemID:"")},after=function(serverData){api._pushItemToCache(serverData);return serverData};return photoTools.takePhotoSupported()?nativeUploadFile(data,options).then(after):webUploadFile(data,options).then(after)}.bind(api);return api}},{"../models/UserLicenseCertification":103,"../utils/GroupListRemoteModel":115,"../utils/photoTools":139}],37:[function(require,module,exports){"use strict";var User=require("../models/User"),RemoteModel=require("../utils/RemoteModel"),localforage=require("localforage");exports.create=function create(appModel){var rem=new RemoteModel({data:User.newAnonymous(),ttl:{minutes:1},localStorageName:"profile",fetch:function fetch(){return appModel.rest.get("me/profile")},push:function push(){return appModel.rest.put("me/profile",this.data.model.toPlainObject())}});appModel.on("clearLocalData",function(){rem.clearCache()});rem.saveOnboardingStep=function saveOnboardingStep(stepReference){"undefined"==typeof stepReference?stepReference=rem.data.onboardingStep():rem.data.onboardingStep(stepReference);return appModel.rest.put("me/profile/tracking",{onboardingStep:stepReference}).then(function(){localforage.setItem(rem.localStorageName,rem.data.model.toPlainObject())})};return rem}},{"../models/User":99,"../utils/RemoteModel":122,localforage:!1}],38:[function(require,module,exports){"use strict";var UserVerification=require("../models/UserVerification"),ListRemoteModel=require("../utils/ListRemoteModel");exports.create=function create(appModel){var api=new ListRemoteModel({listTtl:{minutes:10},itemIdField:"verificationID",Model:UserVerification});api.addLocalforageSupport("user-verifications");api.addRestSupport(appModel.rest,"me/verifications");appModel.on("clearLocalData",function(){api.clearCache()});return api}},{"../models/UserVerification":104,"../utils/ListRemoteModel":119}],39:[function(require,module,exports){"use strict";var GroupRemoteModel=require("../utils/GroupRemoteModel"),PublicUserProfile=require("../models/PublicUserProfile");exports.create=function create(appModel){var api={};api.getUser=function(userID,options){return appModel.rest.get("users/"+(0|userID),options)};var profile=new GroupRemoteModel({ttl:{minutes:10},Model:PublicUserProfile,itemIdField:"userID"});profile.addRestSupport(appModel.rest,"users/","/profile");profile.addLocalforageSupport("userProfiles/");api.getProfile=function(userID){return profile.getItem(userID)};api.getJobProfile=function(userID){return appModel.rest.get("users/"+(0|userID)+"/job-profile")};api.getJobTitle=function(userID,jobTitleID){return appModel.rest.get("users/"+(0|userID)+"/job-profile/"+(0|jobTitleID))};var getRatings=function getRatings(modifier,userID){return appModel.rest.get("users/"+(0|userID)+"/ratings"+(modifier?"/"+modifier:""))};api.getUserRatings=getRatings.bind(api,null);api.getClientRatings=getRatings.bind(api,"client");api.getServiceProfessionalRatings=getRatings.bind(api,"service-professional");api.getJobTitleRatings=function(userID,jobTitleID){return getRatings(0|jobTitleID,userID)};api.getServiceAddresses=function(userID,jobTitleID){return appModel.rest.get("users/"+(0|userID)+"/service-addresses/"+(0|jobTitleID))};api.getServiceProfessionalServices=function(serviceProfessionalUserID,jobTitleID){return appModel.rest.get("users/"+(0|serviceProfessionalUserID)+"/service-professional-services/"+(0|jobTitleID))};var getVerificationsSummary=function getVerificationsSummary(modifier,userID){return appModel.rest.get("users/"+(0|userID)+"/verifications-summary"+(modifier?"/"+modifier:""))};api.getUserVerificationsSummary=getVerificationsSummary.bind(api,null);api.getClientVerificationsSummary=getVerificationsSummary.bind(api,"client");api.getServiceProfessionalVerificationsSummary=getVerificationsSummary.bind(api,"service-professional");api.getJobTitleVerificationsSummary=function(userID,jobTitleID){return getVerificationsSummary(0|jobTitleID,userID)};api.getServiceAttributes=function getServiceAttributes(userID,jobTitleID){return appModel.rest.get("users/"+(0|userID)+"/service-attributes/"+(0|jobTitleID))};api.getReviews=function getReviews(userID,jobTitleID,options){return appModel.rest.get("users/"+(0|userID)+"/reviews"+(jobTitleID?"/"+(0|jobTitleID):""),options)};return api}},{"../models/PublicUserProfile":85,"../utils/GroupRemoteModel":116}],40:[function(require,module,exports){"use strict";var WeeklySchedule=require("../models/WeeklySchedule"),RemoteModel=require("../utils/RemoteModel");exports.create=function create(appModel){var rem=new RemoteModel({data:new WeeklySchedule,ttl:{minutes:1},localStorageName:"weeklySchedule",fetch:function fetch(){return appModel.rest.get("me/weekly-schedule")},push:function push(){return appModel.rest.put("me/weekly-schedule",this.data.model.toPlainObject(!0)).then(function(result){appModel.calendar.clearCache();return result})}});appModel.on("clearLocalData",function(){rem.clearCache()});return rem}},{"../models/WeeklySchedule":107,"../utils/RemoteModel":122}],41:[function(require,module,exports){"use strict";var WorkPhoto=require("../models/WorkPhoto"),GroupListRemoteModel=require("../utils/GroupListRemoteModel"),photoTools=require("../utils/photoTools"),extend=require("jquery").extend,$=require("jquery");exports.create=function create(appModel){var baseUrl="me/work-photos/",api=new GroupListRemoteModel({listTtl:{minutes:1},groupIdField:"jobTitleID",itemIdField:"workPhotoID",Model:WorkPhoto});api.addLocalforageSupport("workPhotos");api.addRestSupport(appModel.rest,baseUrl);appModel.on("clearLocalData",function(){api.clearCache()});var pushJustBasicDataToRemote=api.pushItemToRemote.bind(api),photoUploadFieldName="photo",pushWithoutFile=function(data){return 0===data.workPhotoID?Promise.resolve(null):pushJustBasicDataToRemote(data)},nativeUploadFile=function pushToRemote(data,options){if(data.localTempFilePath){var uploadSettings={fileKey:photoUploadFieldName,mimeType:"image/jpeg",httpMethod:options.method,params:data,headers:extend(!0,{},appModel.rest.extraHeaders)};return photoTools.uploadLocalFileJson(data.localTempFilePath,options.url,uploadSettings)}return pushWithoutFile(data)}.bind(api),webUploadFile=function(data,options){if(data.localTempFileData){var fd=data.localTempFileData;if(!fd)return Promise.resolve(null);fd.url=options.url;fd.type=options.method;fd.paramName=photoUploadFieldName;fd.formData=Object.keys(data).filter(function(k){return"localTempFileData"!==k&&"localTempPhotoPreview"!==k}).map(function(k){return{name:k,value:data[k]}});fd.headers=$.extend(!0,{},appModel.rest.extraHeaders);return Promise.resolve(fd.submit())}return pushWithoutFile(data)};api.pushItemToRemote=function(data){var groupID=data[this.settings.groupIdField],itemID=data[this.settings.itemIdField],options={method:itemID?"put":"post",url:appModel.rest.baseUrl+baseUrl+groupID+(itemID?"/"+itemID:"")};return photoTools.takePhotoSupported()?nativeUploadFile(data,options):webUploadFile(data,options)}.bind(api);return api}},{"../models/WorkPhoto":108,"../utils/GroupListRemoteModel":115,"../utils/photoTools":139}],42:[function(require,module,exports){"use strict";function Activity($activity,app){this.$activity=$activity;this.app=app;this.accessLevel=null;this.resetScroll=!0;this.viewState={};this.requestData=null;this.navBar=new NavBar({title:null,leftAction:null,rightAction:null})}var ko=require("knockout"),NavAction=require("../viewmodels/NavAction"),NavBar=require("../viewmodels/NavBar");require("../utils/Function.prototype._inherits");module.exports=Activity;Activity.prototype.show=function show(options){if(!this.__bindingDone){ko.applyBindings(this.viewModel||{},this.$activity.get(0));this.__bindingDone=!0}options=options||{};this.requestData=options;if(this._handlers&&this._handlersAreConnected!==!0){this._handlers.forEach(function(settings){if(!settings.event&&settings.target.subscribe){var subscription=settings.target.subscribe(settings.handler);settings._subscription=subscription;settings._latestSubscribedValue!==settings.target()&&settings.handler.call(settings.target,settings.target())}else settings.selector?settings.target.on(settings.event,settings.selector,settings.handler):settings.target.on?settings.target.on(settings.event,settings.handler):console.error("Activity.show: Bad registered handler",settings)});this._handlersAreConnected=!0}this.resetScroll&&this.$activity.scrollTop(0)};Activity.prototype.hide=function hide(){if(this._handlers){this._handlers.forEach(function(settings){if(settings._subscription){settings._subscription.dispose();settings._latestSubscribedValue=settings.target()}else settings.target.off?settings.selector?settings.target.off(settings.event,settings.selector,settings.handler):settings.target.off(settings.event,settings.handler):settings.target.removeListener?settings.target.removeListener(settings.event,settings.handler):console.error("Activity.hide: Bad registered handler",settings)});this._handlersAreConnected=!1}};Activity.prototype.registerHandler=function registerHandler(settings){if(!settings)throw new Error("Register require a settings object");if(!settings.target||!settings.target.on&&!settings.target.subscribe)throw new Error("Target is null or not a jQuery, EventEmmiter or Observable object");if("function"!=typeof settings.handler)throw new Error("Handler must be a function.");if(!settings.event&&!settings.target.subscribe)throw new Error("Event is null; it's required for non observable objects");this._handlers=this._handlers||[];this._handlers.push(settings)};Activity.NavBar=NavBar;Activity.NavAction=NavAction;Activity.createSectionNavBar=function createSectionNavBar(title){return new NavBar({title:title,leftAction:NavAction.menuIn,rightAction:NavAction.menuNewItem})};Activity.createSubsectionNavBar=function createSubsectionNavBar(title,options){options=options||{};var goBackOptions={text:title,isTitle:!0};if(options.backLink){goBackOptions.link=options.backLink;goBackOptions.isShell=!1}var helpLink=options.helpLink;if(helpLink){var del=helpLink.indexOf("?")>-1?"&":"?";helpLink+=del+"mustReturn=true&returnText="+encodeURIComponent(title)}var rightOptions=helpLink?NavAction.goHelpIndex.model.clone({link:helpLink,text:"Help"}):NavAction.goHelpIndex;return new NavBar({title:"",leftAction:NavAction.goBack.model.clone(goBackOptions),rightAction:rightOptions})};Activity.prototype.createCancelAction=function createCancelAction(cancelLink,state){var app=this.app,action=new NavAction({link:cancelLink,text:"Cancel",handler:function(event){var link=this.link(),eoptions=event&&event.options||{},goLink=function(){link?app.shell.go(link,state):app.shell.goBack(state)};eoptions.silentMode?goLink():app.modals.confirm({title:"Cancel",message:"Are you sure?",yes:"Yes",no:"No"}).then(function(){goLink()})}});return action};Activity.prototype.convertToCancelAction=function convertToCancelAction(actionModel,cancelLink){var cancel=this.createCancelAction(cancelLink);actionModel.model.updateWith(cancel);actionModel.handler(cancel.handler())};var singletonInstances={},createSingleton=function createSingleton(ActivityClass,$activity,app,name){var key=ActivityClass.name+"::"+(name||"");if(singletonInstances[key]instanceof ActivityClass)return singletonInstances[key];var s=new ActivityClass($activity,app);singletonInstances[key]=s;return s};Activity.extend=function extendsActivity(ClassFn){ClassFn._inherits(Activity);ClassFn.init=createSingleton.bind(null,ClassFn);return ClassFn}},{"../utils/Function.prototype._inherits":113,"../viewmodels/NavAction":149,"../viewmodels/NavBar":150,knockout:!1}],43:[function(require,module,exports){var $=require("jquery"),classes={component:"DatePicker",months:"DatePicker-months",days:"DatePicker-days",monthDay:"day",month:"month",year:"year",years:"DatePicker-years",weekDays:"DatePicker-weekDays",active:"active"},events={dayRendered:"dayRendered",dateChanged:"dateChanged",show:"show",hide:"hide",dateSet:"dateSet",viewDateChanged:"viewDateChanged"},DPGlobal={modes:[{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10},{clsName:"day",navFnc:"Date",navStep:1}],dates:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","M","Tu","W","Th","F","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},isLeapYear:function(year){return year%4===0&&year%100!==0||year%400===0},getDaysInMonth:function(year,month){return[31,DPGlobal.isLeapYear(year)?29:28,31,30,31,30,31,31,30,31,30,31][month]},parseFormat:function(format){var separator=format.match(/[.\/\-\s].*?/),parts=format.split(/\W+/);if(!separator||!parts||0===parts.length)throw new Error("Invalid date format.");return{separator:separator,parts:parts}},parseDate:function(date,format){var parts=date.split(format.separator),val;date=new Date;date.setHours(0);date.setMinutes(0);date.setSeconds(0);date.setMilliseconds(0);if(parts.length===format.parts.length){for(var year=date.getFullYear(),day=date.getDate(),month=date.getMonth(),i=0,cnt=format.parts.length;cnt>i;i++){val=parseInt(parts[i],10)||1;switch(format.parts[i]){case"dd":case"d":day=val;date.setDate(val);break;case"mm":case"m":month=val-1;date.setMonth(val-1);break;case"yy":year=2e3+val;date.setFullYear(2e3+val);break;case"yyyy":year=val;date.setFullYear(val)}}date=new Date(year,month,day,0,0,0)}return date},formatDate:function(date,format){var val={d:date.getDate(),m:date.getMonth()+1,yy:date.getFullYear().toString().substring(2),yyyy:date.getFullYear()};val.dd=(val.d<10?"0":"")+val.d;val.mm=(val.m<10?"0":"")+val.m;date=[];for(var i=0,cnt=format.parts.length;cnt>i;i++)date.push(val[format.parts[i]]);return date.join(format.separator)},headTemplate:'<thead><tr><th class="prev">&lsaquo;</th><th colspan="5" class="switch"></th><th class="next">&rsaquo;</th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>'};DPGlobal.template='<div class="'+classes.component+'"><div class="'+classes.days+'"><table class=" table-condensed">'+DPGlobal.headTemplate+'<tbody></tbody></table></div><div class="'+classes.months+'"><table class="table-condensed">'+DPGlobal.headTemplate+DPGlobal.contTemplate+'</table></div><div class="'+classes.years+'"><table class="table-condensed">'+DPGlobal.headTemplate+DPGlobal.contTemplate+"</table></div></div>";DPGlobal.modesSet={date:DPGlobal.modes[3],month:DPGlobal.modes[0],year:DPGlobal.modes[1],decade:DPGlobal.modes[2]};var DatePicker=function(element,options){this.element=$(element);this.format=DPGlobal.parseFormat(options.format||this.element.data("date-format")||"mm/dd/yyyy");this.isInput=this.element.is("input");this.component=this.element.is(".date")?this.element.find(".add-on"):!1;this.isPlaceholder=this.element.is(".calendar-placeholder");this.picker=$(DPGlobal.template).appendTo(this.isPlaceholder?this.element:"body").on("click",$.proxy(this.click,this));this.picker.addClass(this.isPlaceholder?"":"dropdown-menu");options.extraClasses&&this.picker.addClass(options.extraClasses);for(var html="",r=0;6>r;r++){html+="<tr>";for(var c=0;7>c;c++)html+='<td class="'+classes.monthDay+'"><span>&nbsp;</span></td>';html+="</tr>"}this.picker.find("."+classes.days+" tbody").append(html);html="";for(var yearCont=this.picker.find("."+classes.years+" td"),i=-1;11>i;i++)html+='<span class="'+classes.year+(-1===i||10===i?" old":"")+'"></span>';yearCont.html(html);if(this.isPlaceholder){this.picker.show();if("today"==this.element.data("date")){this.date=new Date;this.set()}this.element.trigger({type:events.show,date:this.date})}else this.isInput?this.element.on({focus:$.proxy(this.show,this),keyup:$.proxy(this.update,this)}):this.component?this.component.on("click",$.proxy(this.show,this)):this.element.on("click",$.proxy(this.show,this));this.element.on("swipeleft",function(e){e.preventDefault();this.moveDate("next")}.bind(this)).on("swiperight",function(e){e.preventDefault();this.moveDate("prev")}.bind(this));this.minViewMode=options.minViewMode||this.element.data("date-minviewmode")||0;if("string"==typeof this.minViewMode)switch(this.minViewMode){case"months":this.minViewMode=1;break;case"years":this.minViewMode=2;break;default:this.minViewMode=0}this.viewMode=options.viewMode||this.element.data("date-viewmode")||0;if("string"==typeof this.viewMode)switch(this.viewMode){case"months":this.viewMode=1;break;case"years":this.viewMode=2;break;default:this.viewMode=0}this.startViewMode=this.viewMode;this.weekStart=options.weekStart||this.element.data("date-weekstart")||0;this.weekEnd=0===this.weekStart?6:this.weekStart-1;this.onRender=options.onRender;this.fillDow();this.fillMonths();this.update();this.showMode()};DatePicker.prototype={constructor:DatePicker,_triggerViewDateChange:function(){var viewModeName=DPGlobal.modes[this.viewMode].clsName;this.element.trigger(events.viewDateChanged,[{viewDate:this.viewDate,viewMode:viewModeName}])},show:function(e){this.picker.show();this.height=this.component?this.component.outerHeight():this.element.outerHeight();this.place();$(window).off("resize.datepicker").on("resize.datepicker",$.proxy(this.place,this));if(e){e.stopPropagation();e.preventDefault()}!this.isInput;var that=this;$(document).off("mousedown.datepicker").on("mousedown.datepicker",function(ev){0===$(ev.target).closest("."+classes.component).length&&that.hide()});this.element.trigger({type:events.show,date:this.date})},hide:function(){this.picker.hide();$(window).off("resize.datepicker",this.place);this.viewMode=this.startViewMode;this.showMode();this.isInput||$(document).off("mousedown.datepicker",this.hide);this.element.trigger({type:events.hide,date:this.date})},set:function(){var formated=DPGlobal.formatDate(this.date,this.format);if(this.isInput)this.element.prop("value",formated);else{this.component&&this.element.find("input").prop("value",formated);this.element.data("date",formated)}this.element.trigger(events.dateSet,[this.date,formated])},setValue:function(newDate,dontNotify){"string"==typeof newDate?this.date=DPGlobal.parseDate(newDate,this.format):this.date=new Date(newDate);this.set();this.viewDate=new Date(this.date.getFullYear(),this.date.getMonth(),1,0,0,0,0);this.fill();this._triggerViewDateChange();dontNotify!==!0&&this.element.trigger({type:events.dateChanged,date:this.date,viewMode:DPGlobal.modes[this.viewMode].clsName})},getValue:function(){return this.date},getViewDate:function(){return this.viewDate},moveValue:function(dir,mode){if(-1!=["prev","next"].indexOf(dir&&dir.toLowerCase())){mode=mode?DPGlobal.modesSet[mode]:DPGlobal.modes[this.viewMode];this.date["set"+mode.navFnc].call(this.date,this.date["get"+mode.navFnc].call(this.date)+mode.navStep*("prev"===dir?-1:1));this.setValue(this.date);return this.date}},place:function(){var offset=this.component?this.component.offset():this.element.offset();this.picker.css({top:offset.top+this.height,left:offset.left})},update:function(newDate){this.date=DPGlobal.parseDate("string"==typeof newDate?newDate:this.isInput?this.element.prop("value"):this.element.data("date"),this.format);this.viewDate=new Date(this.date.getFullYear(),this.date.getMonth(),1,0,0,0,0);this.fill();this._triggerViewDateChange()},getDaysElements:function(){return this.picker.find("."+classes.days+" ."+classes.monthDay)},fillDow:function(){for(var dowCnt=this.weekStart,html='<tr class="'+classes.weekDays+'">';dowCnt<this.weekStart+7;)html+='<th class="dow">'+DPGlobal.dates.daysMin[dowCnt++%7]+"</th>";html+="</tr>";this.picker.find("."+classes.days+" thead").append(html)},fillMonths:function(){for(var html="",i=0;12>i;)html+='<span class="'+classes.month+'">'+DPGlobal.dates.monthsShort[i++]+"</span>";this.picker.find("."+classes.months+" td").append(html)},fill:function(){var d=new Date(this.viewDate),year=d.getFullYear(),month=d.getMonth(),currentDate=this.date.valueOf(),prevMonth=new Date(year,month-1,28,0,0,0,0),lastDayPrevMonth=DPGlobal.getDaysInMonth(prevMonth.getFullYear(),prevMonth.getMonth());prevMonth.setDate(lastDayPrevMonth);prevMonth.setDate(lastDayPrevMonth-(prevMonth.getDay()-this.weekStart+7)%7);if(this._prevDate&&this._prevDate.getMonth()===this.viewDate.getMonth()){var tbody=this.picker.find("."+classes.days+" tbody");tbody.find("."+classes.monthDay+"."+classes.active).removeClass(classes.active);var diff=lastDayPrevMonth-prevMonth.getDate(),index=diff+this.date.getDate(),irow=index/7|0,icol=index%7;tbody.find("tr:eq("+irow+") td:eq("+icol+")").addClass(classes.active);this._prevDate=new Date(this.viewDate)}else{this._prevDate=new Date(this.viewDate);this.picker.find("."+classes.days+" th:eq(1)").html(DPGlobal.dates.months[month]+" "+year);var nextMonth=new Date(prevMonth);nextMonth.setDate(nextMonth.getDate()+42);nextMonth=nextMonth.valueOf();for(var clsName,prevY,prevM,weekTr=this.picker.find("."+classes.days+" tbody tr:first-child()"),dayTd=null;prevMonth.valueOf()<nextMonth;){var currentWeekDayIndex=prevMonth.getDay()-this.weekStart;clsName=this.onRender(prevMonth);prevY=prevMonth.getFullYear();prevM=prevMonth.getMonth();month>prevM&&prevY===year||year>prevY?clsName+=" old":(prevM>month&&prevY===year||prevY>year)&&(clsName+=" new");prevMonth.valueOf()===currentDate&&(clsName+=" "+classes.active);dayTd=weekTr.find("td:eq("+currentWeekDayIndex+")");dayTd.attr("class",classes.monthDay+" "+clsName).data("date-time",prevMonth.toISOString()).children("span").text(prevMonth.getDate());this.picker.trigger(events.dayRendered,[dayTd]);prevMonth.getDay()===this.weekEnd&&(weekTr=weekTr.next("tr"));prevMonth.setDate(prevMonth.getDate()+1)}}var currentYear=this.date.getFullYear(),months=this.picker.find("."+classes.months).find("th:eq(1)").html(year).end().find("span").removeClass(classes.active);currentYear===year&&months.eq(this.date.getMonth()).addClass(classes.active);year=10*parseInt(year/10,10);var yearCont=this.picker.find("."+classes.years).find("th:eq(1)").text(year+"-"+(year+9)).end().find("td");year-=1;var i,yearSpan=yearCont.find("span:first-child()");for(i=-1;11>i;i++){yearSpan.text(year).attr("class",classes.year+(-1===i||10===i?" old":"")+(currentYear===year?" "+classes.active:""));year+=1;yearSpan=yearSpan.next()}},moveDate:function(dir,mode){if(-1!=["prev","next"].indexOf(dir&&dir.toLowerCase())){mode=mode||this.viewMode;this.viewDate["set"+DPGlobal.modes[mode].navFnc].call(this.viewDate,this.viewDate["get"+DPGlobal.modes[mode].navFnc].call(this.viewDate)+DPGlobal.modes[mode].navStep*("prev"===dir?-1:1));this.fill();this._triggerViewDateChange();this.set()}},click:function(e){e.stopPropagation();e.preventDefault();var target=$(e.target).closest("span.month, span.year, td, th");if(1===target.length){var month,year,completeMonthYear=function completeMonthYear(){if(0!==this.viewMode){this.date=new Date(this.viewDate);this.element.trigger({type:events.dateChanged,date:this.date,viewMode:DPGlobal.modes[this.viewMode].clsName})}this.showMode(-1);this.fill();this.set()}.bind(this);if(target.hasClass("switch"))this.showMode(1);else if(target.hasClass("prev")||target.hasClass("next"))this.moveDate(target[0].className);else if(target.hasClass(classes.month)){month=target.parent().find("span").index(target);this.viewDate.setMonth(month);completeMonthYear();this._triggerViewDateChange()}else if(target.hasClass(classes.year)){year=parseInt(target.text(),10)||0;this.viewDate.setFullYear(year);completeMonthYear();this._triggerViewDateChange()}else if(target.hasClass(classes.monthDay)&&!target.is(".disabled")){var day=parseInt(target.text(),10)||1;month=this.viewDate.getMonth();month+=target.hasClass("old")?-1:target.hasClass("new")?1:0;year=this.viewDate.getFullYear();this.date=new Date(year,month,day,0,0,0,0);this.viewDate=new Date(year,month,Math.min(28,day),0,0,0,0);this.fill();this._triggerViewDateChange();this.set();this.element.trigger({type:events.dateChanged,date:this.date,viewMode:DPGlobal.modes[this.viewMode].clsName})}}},mousedown:function(e){e.stopPropagation();e.preventDefault()},showMode:function(dir){dir&&(this.viewMode=Math.max(this.minViewMode,Math.min(2,this.viewMode+dir)));this.picker.find(">div").hide().filter("."+classes.component+"-"+DPGlobal.modes[this.viewMode].clsName).show()}};$.fn.datepicker=function(option){var vals=Array.prototype.slice.call(arguments,1),returned;this.each(function(){var $this=$(this),data=$this.data("datepicker"),options="object"==typeof option&&option;data||$this.data("datepicker",data=new DatePicker(this,$.extend({},$.fn.datepicker.defaults,options)));if("string"==typeof option){returned=data[option].apply(data,vals);if("undefined"!=typeof returned)return!1}});return"undefined"!=typeof returned?returned:this};$.fn.datepicker.defaults={onRender:function(){return""}};$.fn.datepicker.Constructor=DatePicker;exports.DatePicker=DatePicker;exports.defaults=DPGlobal;exports.utils=DPGlobal},{}],44:[function(require,module,exports){"use strict";var $=require("jquery");require("./utils/jquery.multiline");var ko=require("knockout");ko.bindingHandlers.format=require("ko/formatBinding").formatBinding;ko.bindingHandlers.domElement=require("ko/domElementBinding").domElementBinding;var bootknock=require("./utils/bootknockBindingHelpers");require("./utils/Function.prototype._inherits");require("./utils/Function.prototype._delayed");require("./utils/Function.prototype.name-polyfill");require("es6-promise").polyfill();var layoutUpdateEvent=require("layoutUpdateEvent"),AppModel=require("./appmodel/AppModel");require("./locales/en-US-LC");var attachFastClick=require("fastclick").attach,app={model:new AppModel,modals:require("./app.modals")};require("./app-components").registerAll(app);var appInit=function appInit(){attachFastClick(document.body);layoutUpdateEvent.layoutUpdateEvent+=" orientationchange";layoutUpdateEvent.on();require("bootstrap");require("bootstrap-carousel");bootknock.plugIn(ko);var scrollToElement=require("./utils/scrollToElement"),fragmentNavigationHandler=function(href){if("#"===href)console.warn('Navigation to an empty fragment, this may be not wanted. For root links, use "/"; on script handled links, call event.preventDefault; A touch event was listened on a link, but not the click event.');else{var target=$(href);if(target.length){var opts={animation:{duration:300}},act=target.closest("[data-activity]"),isHome="home"===act.data("activity");isHome&&(opts.topOffset=act.children("header").outerHeight());scrollToElement(target,opts)}}};$(document).on("click","[href^=#]",fragmentNavigationHandler);var alertError=function(err){app.modals.showError({title:"There was an error loading",error:err})};app.model.on("error",alertError);app.model.init().then(function(){$("html").addClass("is-ready");var $act=$("#landingPage");require("./activities/landingPage").init($act,app).show({route:{}})},alertError);window.app=app};$(appInit)},{"./activities/landingPage":1,"./app-components":2,"./app.modals":3,"./appmodel/AppModel":21,"./locales/en-US-LC":45,"./utils/Function.prototype._delayed":112,"./utils/Function.prototype._inherits":113,"./utils/Function.prototype.name-polyfill":114,"./utils/bootknockBindingHelpers":126,"./utils/jquery.multiline":136,"./utils/scrollToElement":140,"bootstrap-carousel":"cQpvfs","es6-promise":!1,knockout:!1}],45:[function(require,module,exports){"use strict";var moment=require("moment"),current=moment.locale();moment.locale("en-US-LC",{calendar:{lastDay:"[Yesterday]",sameDay:"[Today]",nextDay:"[Tomorrow]",lastWeek:"[last] dddd",nextWeek:"dddd",sameElse:"M/D"},longDateFormat:{LT:"h:mma",LTS:"h:mm:ssa",L:"MM/DD/YYYY",l:"M/D/YYYY",LL:"MMMM Do YYYY",ll:"MMM D YYYY",LLL:"MMMM Do YYYY LT",
lll:"MMM D YYYY LT",LLLL:"dddd, MMMM Do YYYY LT",llll:"ddd, MMM D YYYY LT"}});moment.locale(current)},{moment:!1}],46:[function(require,module,exports){"use strict";var $=require("jquery");exports.show=function showAnnouncementModal(options){var modal=$("#announcementModal"),primaryBtn=modal.find("#announcementModal-primaryBtn"),secondaryBtn=modal.find("#announcementModal-secondaryBtn"),body=modal.find("#announcementModal-body");options=options||{};var msg=options.message||body.data("default-text");body.multiline(msg);primaryBtn.text(options.primaryButtonText||primaryBtn.data("default-text"));primaryBtn.attr("href",options.primaryButtonLink||"#");secondaryBtn.toggle(!!options.secondaryButtonText);secondaryBtn.text(options.secondaryButtonText);secondaryBtn.attr("href",options.secondaryButtonLink||"#");return new Promise(function(resolve){modal.off("hide.bs.modal").one("hide.bs.modal",function(){resolve()});modal.modal("show")})}},{}],47:[function(require,module,exports){"use strict";function TextEditorModel(){this.title=ko.observable("");this.text=ko.observable("")}var ko=require("knockout"),$=require("jquery");exports.show=function showTextEditor(options){var modal=$("#textEditorModal"),vm=modal.data("viewmodel");if(!vm){vm=new TextEditorModel;ko.applyBindings(vm,modal.get(0));modal.data("viewmodel",vm)}options=options||{};vm.title(options.title||"");vm.text(options.text||"");return new Promise(function(resolve,reject){var save=function(){resolve(vm.text());modal.modal("hide")};modal.off("hide.bs.modal");modal.on("hide.bs.modal",reject.bind(null,null));modal.off("click","#textEditorModal-save");modal.on("click","#textEditorModal-save",save);modal.one("shown.bs.modal",function(){setTimeout(function(){var $text=modal.find("textarea");$text.focus();$text.click();window.scrollTo(0,0)},100)});modal.modal("show")})}},{knockout:!1}],48:[function(require,module,exports){"use strict";function twoDigits(n){return Math.floor(n/10)+""+n%10}function TimePickerModel(){var vm={title:ko.observable(""),pickedHour:ko.observable(null),pickedMinute:ko.observable(null),pickedAmpm:ko.observable(null),stepInMinutes:ko.observable(5),unsetLabel:ko.observable("Remove"),selectLabel:ko.observable("Select")};vm.locale=ko.observable({lang:"en",region:"US"});vm.hourValues=ko.computed(function(){var region=this.locale().region,step=this.stepInMinutes()/60|0;0>=step&&(step=1);var values=[],i;if("US"===region){values.push({value:0,label:12});for(i=1;12>i;i+=step)values.push({value:i,label:i})}else for(i=0;24>i;i+=step)values.push({value:i,label:i});return values},vm);vm.minuteValues=ko.computed(function(){var step=0|this.stepInMinutes();0>=step&&(step=1);if(step>=60)return[];for(var values=[],i=0;60>i;i+=step)values.push({value:i,label:twoDigits(i)});return values},vm);vm.ampmValues=ko.computed(function(){var region=this.locale().region,values=[];if("US"===region){values.push({value:0,label:"AM"});values.push({value:12,label:"PM"})}return values},vm);vm.selectedTime=ko.computed({read:function(){return{hours:this.pickedHour()+this.pickedAmpm(),minutes:this.pickedMinute(),seconds:0}},write:function(v){if("object"!=typeof v)throw new Error("Invalid input for the time picker. Value:",v);v=v||{};var region=this.locale().region;if("US"===region){this.pickedHour(v.hours/12|0);this.pickedMinute(0|v.minutes);this.pickedAmpm(v.hours%12|0)}else{this.pickedHour(0|v.hours);this.pickedMinute(0|v.minutes);this.pickedAmpm(0)}},owner:vm});vm.selectedTimeString=ko.computed({read:function(){var t=this.selectedTime();return twoDigits(t.hours)+":"+twoDigits(t.minutes)+":"+twoDigits(t.seconds)},write:function(v){v=v||"";var parts=v.split(":");this.selectedTime({hours:0|parts[0],minutes:0|parts[1],seconds:0|parts[2]})},owner:vm});return vm}var ko=require("knockout"),$=require("jquery");exports.show=function showTimePicker(options){var modal=$("#timePickerModal"),vm=modal.data("viewmodel");if(!vm){vm=new TimePickerModel;ko.applyBindings(vm,modal.get(0));modal.data("viewmodel",vm)}options=options||{};vm.title(options.title||"Select time");vm.stepInMinutes(options.stepInMinutes||5);"string"==typeof options.selectedTime?vm.selectedTimeString(options.selectedTime):vm.selectedTime(options.selectedTime||{});vm.unsetLabel(options.unsetLabel||"Remove");vm.selectLabel(options.selectLabel||"Select");return new Promise(function(resolve,reject){var unset=function(){resolve(null);modal.modal("hide")},select=function(){resolve({time:vm.selectedTime(),timeString:vm.selectedTimeString()});modal.modal("hide")};modal.off("hide.bs.modal");modal.on("hide.bs.modal",reject);modal.off("click",".timePickerModal-unset");modal.on("click",".timePickerModal-unset",unset);modal.off("click",".timePickerModal-select");modal.on("click",".timePickerModal-select",select);modal.modal("show")})}},{knockout:!1}],49:[function(require,module,exports){"use strict";function Address(values){Model(this);this.model.defProperties({addressID:0,addressName:"",jobTitleID:0,userID:0,addressLine1:null,addressLine2:null,postalCode:null,city:null,stateProvinceCode:null,stateProvinceName:null,countryCode:null,latitude:null,longitude:null,specialInstructions:null,isServiceArea:!1,isServiceLocation:!1,serviceRadius:0,createdDate:null,updatedDate:null,kind:""},values);this.singleLine=ko.computed(function(){var list=[this.addressLine1(),this.city(),this.postalCode(),this.stateProvinceCode()];return list.filter(function(v){return!!v}).join(", ")},this);this.singleLineDetailed=ko.pureComputed(function(){var r=this.addressLine1()||"";r&&(r+=" ");r+=this.addressLine2()||"";r&&(r+=" - ");r+=this.city()||"";r&&(r+=" ");this.stateProvinceCode()&&(r+="("+this.stateProvinceCode()+") ");r+=this.postalCode()||"";r+=this.specialInstructions()?" ("+this.specialInstructions()+")":"";return r},this);this.addressLine=ko.computed(function(){var list=[this.addressLine1(),this.addressLine2()];return list.filter(function(v){return!!v}).join(", ")},this);this.cityStateLine=ko.computed(function(){var list=[this.city(),this.stateProvinceCode(),this.postalCode()];return list.filter(function(v){return!!v}).join(", ")},this);var countries={US:"United States",ES:"Spain"};this.countryName=ko.computed(function(){return countries[this.countryCode()]||"unknow"},this);this.latlng=ko.computed(function(){return{lat:this.latitude(),lng:this.longitude()}},this)}var ko=require("knockout"),Model=require("./Model");module.exports=Address;Address.kind={home:"home",billing:"billing",service:"service"}},{"./Model":75,knockout:!1}],50:[function(require,module,exports){"use strict";function Appointment(values){Model(this);this.model.defProperties({id:null,startTime:null,endTime:null,summary:"New booking",description:null,isAllDay:!1,price:0,clientUserID:null,pricing:{Model:PricingSummaryDetail,isArray:!0},address:new Address,preNotesToClient:null,postNotesToClient:null,preNotesToSelf:null,postNotesToSelf:null,jobTitleID:0,readOnly:!1,sourceEvent:{Model:CalendarEvent,defaultValue:null},sourceBooking:{Model:Booking,defaultValue:null}},values);this.address.subscribe(function(val){val||this.address(new Address)}.bind(this));this.displayedDate=ko.pureComputed(function(){return moment(this.startTime()).locale("en-US-LC").calendar()},this);this.displayedStartTime=ko.pureComputed(function(){return moment(this.startTime()).locale("en-US-LC").format("LT")},this);this.displayedEndTime=ko.pureComputed(function(){return moment(this.endTime()).locale("en-US-LC").format("LT")},this);this.displayedTimeRange=ko.pureComputed(function(){return this.displayedStartTime()+"-"+this.displayedEndTime()},this);this.itStarted=ko.pureComputed(function(){return this.startTime()&&new Date>=this.startTime()},this);this.itEnded=ko.pureComputed(function(){return this.endTime()&&new Date>=this.endTime()},this);this.isNew=ko.pureComputed(function(){return!this.id()},this);this.stateHeader=ko.pureComputed(function(){var text="";this.id()>0&&this.sourceEvent()&&(text=this.sourceBooking()?this.sourceBooking().bookingStatusID()===Booking.status.request?"Accept/Decline booking request":this.sourceBooking().bookingStatusID()===Booking.status.denied?"Denied":this.sourceBooking().bookingStatusID()===Booking.status.cancelled?"Cancelled":this.itStarted()?this.itEnded()?"Completed":"Now":"Upcoming":"Calendar block");return text},this)}var ko=require("knockout"),Model=require("./Model"),moment=require("moment"),PricingSummaryDetail=require("./PricingSummaryDetail"),CalendarEvent=require("./CalendarEvent"),Booking=require("./Booking"),Address=require("./Address");module.exports=Appointment;Appointment.fromCalendarEvent=function fromCalendarEvent(event){var apt=new Appointment;apt.id(event.calendarEventID());apt.startTime(event.startTime());apt.endTime(event.endTime());apt.summary(event.summary());apt.description(event.description());apt.isAllDay(event.isAllDay());apt.readOnly(event.readOnly());apt.sourceEvent(event);return apt};Appointment.fromBooking=function fromBooking(booking,event){event||(event=new CalendarEvent({calendarEventID:booking.serviceDateID(),startTime:booking.serviceDate().startTime(),endTime:booking.serviceDate().endTime(),readOnly:!0}));var apt=Appointment.fromCalendarEvent(event);apt.clientUserID(booking.clientUserID());apt.address().addressID(booking.serviceAddressID());booking.serviceAddress()?apt.address().model.updateWith(booking.serviceAddress(),!0):apt.address(null);apt.jobTitleID(booking.jobTitleID());apt.pricing(booking.pricingSummary()&&booking.pricingSummary().details());apt.preNotesToClient(booking.preNotesToClient());apt.postNotesToClient(booking.postNotesToClient());apt.preNotesToSelf(booking.preNotesToSelf());apt.postNotesToSelf(booking.postNotesToSelf());apt.readOnly(!1);var prices=booking.pricingSummary();prices&&apt.price(prices.totalPrice());apt.sourceBooking(booking);return apt};Appointment.listFromCalendarEventsBookings=function listFromCalendarEventsBookings(events,bookings){return events.map(function(event){var booking=null;bookings.some(function(searchBooking){var found=searchBooking.serviceDateID()===event.calendarEventID()||searchBooking.alternativeDate1ID()===event.calendarEventID()||searchBooking.alternativeDate2ID()===event.calendarEventID();if(found){booking=searchBooking;return!0}});return booking?Appointment.fromBooking(booking,event):Appointment.fromCalendarEvent(event)})};Appointment.specialIds={loading:0,emptyDate:-1,free:-2,newEvent:-3,newBooking:-4,unavailable:-5,preparationTime:-6};var Time=require("../utils/Time");Appointment.newFreeSlot=function newFreeSlot(options){var start=options.start||new Time(options.date,0,0,0),end=options.end||new Time(options.date,0,0,0);return new Appointment({id:Appointment.specialIds.free,startTime:start,endTime:end,summary:options.text||"Free",description:null})};Appointment.newUnavailableSlot=function newUnavailableSlot(options){var start=options.start||new Time(options.date,0,0,0),end=options.end||new Time(options.date,0,0,0);return new Appointment({id:Appointment.specialIds.unavailable,startTime:start,endTime:end,summary:options.text||"Unavailable",description:null})};Appointment.newPreparationTimeSlot=function newPreparationTimeSlot(options){var start=options.start||new Time(options.date,0,0,0),end=options.end||new Time(options.date,0,0,0);return new Appointment({id:Appointment.specialIds.preparationTime,startTime:start,endTime:end,summary:options.text||"Preparation time",description:null})}},{"../utils/Time":124,"./Address":49,"./Booking":51,"./CalendarEvent":52,"./Model":75,"./PricingSummaryDetail":78,knockout:!1,moment:!1}],51:[function(require,module,exports){"use strict";function Booking(values){Model(this);this.model.defProperties({bookingID:0,clientUserID:0,serviceProfessionalUserID:0,jobTitleID:0,languageID:0,countryID:0,bookingStatusID:0,bookingTypeID:0,cancellationPolicyID:0,parentBookingID:null,serviceAddressID:null,serviceDateID:null,alternativeDate1ID:null,alternativeDate2ID:null,pricingSummaryID:0,pricingSummaryRevision:0,paymentLastFourCardNumberDigits:null,totalPricePaidByClient:null,totalServiceFeesPaidByClient:null,totalPaidToServiceProfessional:null,totalServiceFeesPaidByServiceProfessional:null,instantBooking:!1,firstTimeBooking:!1,sendReminder:!1,sendPromotional:!1,recurrent:!1,multiSession:!1,pricingAdjustmentApplied:!1,paymentEnabled:!1,paymentCollected:!1,paymentAuthorized:!1,awaitingResponseFromUserID:null,pricingAdjustmentRequested:!1,updatedDate:null,specialRequests:null,preNotesToClient:null,postNotesToClient:null,preNotesToSelf:null,postNotesToSelf:null,reviewedByServiceProfessional:!1,reviewedByClient:!1,pricingSummary:new PricingSummary,serviceAddress:{Model:Address},serviceDate:{Model:EventDates},alternativeDate1:{Model:EventDates},alternativeDate2:{Model:EventDates},userJobTitle:{Model:PublicUserJobTitle}},values);this.canBeCancelledByServiceProfessional=ko.pureComputed(function(){return this.bookingStatusID()===Booking.status.confirmed&&this.bookingTypeID()===Booking.type.serviceProfessionalBooking},this);this.canBeCancelledByClient=ko.pureComputed(function(){return(this.bookingStatusID()===Booking.status.confirmed||this.bookingStatusID()===Booking.status.request)&&this.bookingTypeID()!==Booking.type.serviceProfessionalBooking},this);this.canBeDeclinedByClient=ko.pureComputed(function(){return(this.bookingStatusID()===Booking.status.confirmed||this.bookingStatusID()===Booking.status.request)&&this.bookingTypeID()===Booking.type.serviceProfessionalBooking},this);this.canBeDeclinedByServiceProfessional=ko.pureComputed(function(){return this.bookingStatusID()===Booking.status.request&&this.bookingTypeID()!==Booking.type.serviceProfessionalBooking},this);this.isRequest=ko.pureComputed(function(){return this.bookingStatusID()===Booking.status.request},this);this.isConfirmed=ko.pureComputed(function(){return this.bookingStatusID()===Booking.status.confirmed},this);this.isCompleted=ko.pureComputed(function(){return this.bookingStatusID()===Booking.status.completed},this);this.isIncomplete=ko.pureComputed(function(){return this.bookingStatusID()===Booking.status.incomplete},this);this.isPerformed=ko.pureComputed(function(){return this.bookingStatusID()===Booking.status.servicePerformed},this);this.isDispute=ko.pureComputed(function(){return this.bookingStatusID()===Booking.status.dispute},this);this.isCancelled=ko.pureComputed(function(){return this.bookingStatusID()===Booking.status.cancelled},this);this.isDenied=ko.pureComputed(function(){return this.bookingStatusID()===Booking.status.denied},this);this.isExpired=ko.pureComputed(function(){return this.bookingStatusID()===Booking.status.requestExpired},this);var finalStatuses=[Booking.status.cancelled,Booking.status.denied,Booking.status.requestExpired,Booking.status.completed];this.isClosed=ko.pureComputed(function(){return finalStatuses.indexOf(this.bookingStatusID())>-1},this);this.isServiceProfessionalBooking=ko.pureComputed(function(){return this.bookingTypeID()===Booking.type.serviceProfessionalBooking},this);this.displayedDate=ko.pureComputed(function(){return moment(this.serviceDate().startTime()).locale("en-US-LC").calendar()},this);this.displayedStartTime=ko.pureComputed(function(){return moment(this.serviceDate().startTime()).locale("en-US-LC").format("LT")},this);this.displayedEndTime=ko.pureComputed(function(){return moment(this.serviceDate().endTime()).locale("en-US-LC").format("LT")},this);this.servicesSummary=ko.pureComputed(function(){return this.pricingSummary().servicesSummary()},this);this.displayPaymentAuthorizedLabel=ko.pureComputed(function(){return this.paymentAuthorized()&&!this.isCompleted()},this);this.displayPaymentCollectedLabel=ko.pureComputed(function(){return this.paymentCollected()&&!this.paymentAuthorized()},this);this.displayPaymentPaidLabel=ko.pureComputed(function(){return this.paymentEnabled()&&this.isCompleted()},this);this.bookingStatusLabel=ko.pureComputed(function(){var n=Enum.name(Booking.status,this.bookingStatusID());return statusLabels[n]||""},this)}var ko=require("knockout"),Model=require("./Model"),PricingSummary=require("./PricingSummary"),PublicUserJobTitle=require("./PublicUserJobTitle"),Address=require("./Address"),moment=require("moment"),EventDates=require("./EventDates"),statusLabels={incomplete:"This booking was never completed",request:"Booking request not yet confirmed",cancelled:"This booking has been cancelled",denied:"This booking has been cancelled",requestExpired:"This booking request expired",confirmed:"This booking is confirmed",servicePerformed:"Services have been performed",completed:"This booking has been completed",dispute:"We'll be in touch shortly"},Enum=require("../utils/Enum");module.exports=Booking;Booking.from=function from(data){return Array.isArray(data)?data.map(Booking.from):new Booking(data)};Booking.status={incomplete:1,request:2,cancelled:3,denied:4,requestExpired:5,confirmed:6,servicePerformed:7,completed:8,dispute:9};Booking.type={marketplaceBooking:1,bookNowBooking:2,serviceProfessionalBooking:3,exchangeBooking:4,partnerBooking:5}},{"../utils/Enum":111,"./Address":49,"./EventDates":58,"./Model":75,"./PricingSummary":77,"./PublicUserJobTitle":83,knockout:!1,moment:!1}],52:[function(require,module,exports){"use strict";function RecurrenceRule(values){Model(this);this.model.defProperties({frequencyTypeID:0,interval:1,until:null,count:null,ending:null,selectedWeekDays:[],monthlyWeekDay:!1,incompatible:!1,tooMany:!1},values)}function RecurrenceOccurrence(values){Model(this);this.model.defProperties({startTime:null,endTime:null},values)}function CalendarEvent(values){Model(this);if(values){values.startTime=values.startTime&&new Date(Date.parse(values.startTime))||null;values.endTime=values.endTime&&new Date(Date.parse(values.endTime))||null}this.model.defProperties({calendarEventID:0,userID:0,eventTypeID:3,summary:"",availabilityTypeID:0,startTime:null,endTime:null,kind:0,isAllDay:!1,timeZone:"Z",location:null,updatedDate:null,createdDate:null,description:"",readOnly:!1,recurrenceRule:{Model:RecurrenceRule},recurrenceOccurrences:{isArray:!0,Model:RecurrenceOccurrence}},values)}var Model=require("./Model");module.exports=CalendarEvent;CalendarEvent.RecurrenceRule=RecurrenceRule;CalendarEvent.RecurrenceOccurrence=RecurrenceOccurrence},{"./Model":75}],53:[function(require,module,exports){"use strict";function CalendarSyncing(values){Model(this);this.model.defProperties({icalExportUrl:"",icalImportUrl:""},values)}var Model=require("./Model");module.exports=CalendarSyncing},{"./Model":75}],54:[function(require,module,exports){"use strict";function CancellationPolicy(values){Model(this);this.model.defProperties({cancellationPolicyID:0,name:"",description:"",hoursRequired:0,cancellationFeeBefore:0,cancellationFeeAfter:0},values);this.cancellationFeeBeforeDisplay=ko.pureComputed(function(){return this.cancellationFeeBefore()>0?"be charged a "+Math.floor(100*this.cancellationFeeBefore())+"% cancellation fee":"not be charged any cancellation fee"},this);this.cancellationFeeAfterDisplay=ko.pureComputed(function(){return Math.floor(100*this.cancellationFeeAfter())+"%"},this);this.refundLimitDate=ko.computed(function(){var d=moment(observableTime()).clone();d.add(7,"days").subtract(this.hoursRequired(),"hours");return d.toDate()},this)}var Model=require("../models/Model"),ko=require("knockout"),moment=require("moment"),observableTime=ko.observable(new Date);setInterval(function(){observableTime(new Date)},6e4);module.exports=CancellationPolicy},{"../models/Model":75,knockout:!1,moment:!1}],55:[function(require,module,exports){"use strict";function CategorySearchResult(values){Model(this);this.model.defProperties({categoryID:0,categoryName:"",searchDescription:"",averageRating:"",totalRatings:"",averageResponseTimeMinutes:0,averageHourlyRate:0,serviceProfessionalsCount:0},values)}var Model=require("./Model");module.exports=CategorySearchResult},{"./Model":75}],56:[function(require,module,exports){"use strict";function Client(values){Model(this);this.model.defProperties({clientUserID:0,firstName:"",lastName:"",secondLastName:"",email:"",phone:null,canReceiveSms:!1,birthMonthDay:null,birthMonth:null,notesAboutClient:null,createdDate:null,updatedDate:null,editable:!1,deleted:!1},values);this.fullName=ko.pureComputed(function(){return(this.firstName()||"")+" "+(this.lastName()||"")},this);this.birthDay=ko.pureComputed(function(){return this.birthMonthDay()&&this.birthMonth()?this.birthMonth()+"/"+this.birthMonthDay():null},this)}var ko=require("knockout"),Model=require("./Model");module.exports=Client},{"./Model":75,knockout:!1}],57:[function(require,module,exports){"use strict";function DateAvailability(values){Model(this);this.model.defProperties({date:null,weeklySchedule:{Model:WeeklySchedule},appointmentsList:{isArray:!0,Model:Appointment},schedulingPreferences:{Model:SchedulingPreferences}},values);this.freeScheduleSlots=ko.pureComputed(function(){var d=this.date(),w=this.weeklySchedule();return availabilityCalculation.createFreeScheduleSlots(d,w)},this).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}});this.list=ko.pureComputed(function(){return availabilityCalculation.fillDayAvailability(this.date(),this.appointmentsList(),this.freeScheduleSlots(),this.schedulingPreferences())},this);this.workDayMinutes=ko.pureComputed(function(){var free=this.freeScheduleSlots();return free.reduce(function(v,next){return v+moment(next.end).diff(next.start,"minutes")},0)},this);this.availableMinutes=ko.pureComputed(function(){return this.list().reduce(function(minutes,apt){if(apt.id()===Appointment.specialIds.free){var et=moment(apt.endTime()),st=moment(apt.startTime());minutes+=et.diff(st,"minutes")}return minutes},0)},this);this.availablePercent=ko.pureComputed(function(){return Math.round(this.availableMinutes()/this.workDayMinutes()*100)},this);this.availableTag=ko.pureComputed(function(){var perc=this.availablePercent(),date=this.date(),today=getDateWithoutTime();return today>date?"past":perc>=100?"full":perc>=50?"medium":perc>0?"low":"none"},this);var createTimeSlots=require("../utils/createTimeSlots");this.getFreeTimeSlots=function getFreeTimeSlots(duration,slotSizeMinutes){slotSizeMinutes=slotSizeMinutes||this.schedulingPreferences().incrementsSizeInMinutes();duration||(duration=slotSizeMinutes);var date=this.date(),today=getDateWithoutTime();return today>date||this.availableMinutes()<=0?[]:createTimeSlots.forList(this.getFreeAvailableSlots(),slotSizeMinutes,duration,!0)};this.getFreeAvailableSlots=function getFreeAvailableSlots(){var date=this.date(),today=getDateWithoutTime();if(today>date||this.availableMinutes()<=0)return[];var slots=[];this.list().forEach(function(apt){apt.id()===Appointment.specialIds.free&&slots.push({availability:"free",startTime:apt.startTime(),endTime:apt.endTime()})});return slots}}var Model=require("../models/Model"),Appointment=require("../models/Appointment"),WeeklySchedule=require("../models/WeeklySchedule"),SchedulingPreferences=require("../models/SchedulingPreferences"),moment=require("moment"),ko=require("knockout"),availabilityCalculation=require("../utils/availabilityCalculation"),getDateWithoutTime=require("../utils/getDateWithoutTime");module.exports=DateAvailability},{"../models/Appointment":50,"../models/Model":75,"../models/SchedulingPreferences":90,"../models/WeeklySchedule":107,"../utils/availabilityCalculation":125,"../utils/createTimeSlots":127,"../utils/getDateWithoutTime":131,knockout:!1,moment:!1}],58:[function(require,module,exports){"use strict";var Model=require("./Model"),ko=require("knockout"),moment=require("moment");module.exports=function EventDates(values){Model(this);this.model.defProperties({startTime:null,endTime:null,timeZone:""},values);this.duration=ko.computed({read:function(){var s=this.startTime(),e=this.endTime();return s&&e?moment.duration(e-s):null},write:function(value){var s=this.startTime();if((value||0===value)&&s){var newEnd=moment(s).clone().add(value);this.endTime(newEnd.toDate())}else this.endTime(null)},owner:this});this.displayedDate=ko.pureComputed(function(){return moment(this.startTime()).locale("en-US-LC").calendar()},this);this.displayedStartTime=ko.pureComputed(function(){return moment(this.startTime()).locale("en-US-LC").format("LT")},this);this.displayedEndTime=ko.pureComputed(function(){return moment(this.endTime()).locale("en-US-LC").format("LT")},this);this.displayedTimeRange=ko.pureComputed(function(){return this.displayedStartTime()+"-"+this.displayedEndTime()},this)}},{"./Model":75,knockout:!1,moment:!1}],59:[function(require,module,exports){"use strict";function ExperienceLevel(values){Model(this);this.model.defProperties({experienceLevelID:0,name:"",description:null,updatedDate:null},values)}var Model=require("./Model");module.exports=ExperienceLevel},{"./Model":75}],60:[function(require,module,exports){"use strict";function HelpArticle(values){Model(this);this.model.defProperties({id:0,section_id:0,title:"",body:""},values);this.description=this.body;this.tail=ko.pureComputed(function(){return this.id()+"-"+slug(this.title())},this);this.urlPath=ko.pureComputed(function(){return"/help/articles/"+this.tail()},this)}var Model=require("./Model"),ko=require("knockout"),slug=require("../utils/slug");module.exports=HelpArticle},{"../utils/slug":141,"./Model":75,knockout:!1}],61:[function(require,module,exports){"use strict";function HelpCategory(values){Model(this);this.model.defProperties({id:0,name:"",description:""},values);this.tail=ko.pureComputed(function(){return this.id()+"-"+slug(this.name())},this);this.urlPath=ko.pureComputed(function(){return"/help/categories/"+this.tail()},this)}var Model=require("./Model"),ko=require("knockout"),slug=require("../utils/slug");module.exports=HelpCategory},{"../utils/slug":141,"./Model":75,knockout:!1}],62:[function(require,module,exports){"use strict";function HelpSection(values){Model(this);this.model.defProperties({id:0,category_id:0,name:"",description:""},values);this.tail=ko.pureComputed(function(){return this.id()+"-"+slug(this.name())},this);this.urlPath=ko.pureComputed(function(){return"/help/sections/"+this.tail()},this)}var Model=require("./Model"),ko=require("knockout"),slug=require("../utils/slug");module.exports=HelpSection},{"../utils/slug":141,"./Model":75,knockout:!1}],63:[function(require,module,exports){"use strict";function JobTitle(values){Model(this);this.model.defProperties({jobTitleID:0,singularName:"",pluralName:"",aliases:"",description:null,searchDescription:null,createdDate:null,updatedDate:null},values);this.model.defID(["jobTitleID"]);this.pricingTypes=ko.observableArray([]);values&&values.pricingTypes&&values.pricingTypes.forEach(function(jobpricing){this.pricingTypes.push(new JobTitlePricingType(jobpricing))}.bind(this))}var ko=require("knockout"),Model=require("./Model"),JobTitlePricingType=require("./JobTitlePricingType");module.exports=JobTitle},{"./JobTitlePricingType":68,"./Model":75,knockout:!1}],64:[function(require,module,exports){"use strict";function JobTitleCountryLicense(values){Model(this);this.model.defProperties({jobTitleID:0,licenseCertificationID:0,required:0,countryID:0,countryName:"",languageID:0,submitted:0,optionGroup:"",licenseCertification:new LicenseCertification},values)}var Model=require("./Model"),LicenseCertification=require("./LicenseCertification");module.exports=JobTitleCountryLicense},{"./LicenseCertification":72,"./Model":75}],65:[function(require,module,exports){"use strict";function JobTitleCountyLicense(values){Model(this);this.model.defProperties({jobTitleID:0,licenseCertificationID:0,required:0,countyID:0,countyName:"",languageID:0,submitted:0,optionGroup:"",licenseCertification:new LicenseCertification},values)}var Model=require("./Model"),LicenseCertification=require("./LicenseCertification");module.exports=JobTitleCountyLicense},{"./LicenseCertification":72,"./Model":75}],66:[function(require,module,exports){"use strict";function JobTitleLicenses(values){Model(this);this.model.defProperties({municipality:{isArray:!0,Model:JobTitleMunicipalLicense},county:{isArray:!0,Model:JobTitleCountyLicense},stateProvince:{isArray:!0,Model:JobTitleStateProvinceLicense},country:{isArray:!0,Model:JobTitleCountryLicense}},values)}var Model=require("./Model"),JobTitleMunicipalLicense=require("./JobTitleMunicipalLicense"),JobTitleCountyLicense=require("./JobTitleCountyLicense"),JobTitleStateProvinceLicense=require("./JobTitleStateProvinceLicense"),JobTitleCountryLicense=require("./JobTitleCountryLicense");module.exports=JobTitleLicenses},{"./JobTitleCountryLicense":64,"./JobTitleCountyLicense":65,"./JobTitleMunicipalLicense":67,"./JobTitleStateProvinceLicense":71,"./Model":75}],67:[function(require,module,exports){"use strict";function JobTitleMunicipalLicense(values){Model(this);this.model.defProperties({jobTitleID:0,licenseCertificationID:0,required:0,municipalityID:0,municipalityName:"",languageID:0,submitted:0,optionGroup:"",licenseCertification:new LicenseCertification},values)}var Model=require("./Model"),LicenseCertification=require("./LicenseCertification");module.exports=JobTitleMunicipalLicense},{"./LicenseCertification":72,"./Model":75}],68:[function(require,module,exports){"use strict";function JobTitlePricingType(values){Model(this);this.model.defProperties({pricingTypeID:0,clientTypeID:1,createdDate:null,updatedDate:null},values);this.model.defID(["pricingTypeID","clientTypeID"])}var Model=require("./Model");module.exports=JobTitlePricingType},{"./Model":75}],69:[function(require,module,exports){"use strict";function JobTitleSearchResult(values){Model(this);this.model.defProperties({jobTitleID:0,singularName:"",pluralName:"",description:"",searchDescription:"",averageRating:"",totalRatings:"",averageResponseTimeMinutes:0,averageHourlyRate:0,minServicePrice:0,minHourlyRate:0,minServiceValue:"",serviceProfessionalsCount:0},values)}var Model=require("./Model");module.exports=JobTitleSearchResult},{"./Model":75}],70:[function(require,module,exports){"use strict";function JobTitleServiceAttributes(values){Model(this);this.model.defProperties({jobTitleID:0,serviceAttributes:{isArray:!0,Model:ServiceAttributeCategory},experienceLevels:{isArray:!0,Model:ExperienceLevel},languageID:0,countryID:0},values)}var Model=require("./Model"),ServiceAttributeCategory=require("./ServiceAttributeCategory"),ExperienceLevel=require("./ExperienceLevel");module.exports=JobTitleServiceAttributes},{"./ExperienceLevel":59,"./Model":75,"./ServiceAttributeCategory":93}],71:[function(require,module,exports){"use strict";function JobTitleStateProvinceLicense(values){Model(this);this.model.defProperties({jobTitleID:0,licenseCertificationID:0,required:0,stateProvinceID:0,stateProvinceName:"",languageID:0,submitted:0,optionGroup:"",licenseCertification:new LicenseCertification},values)}var Model=require("./Model"),LicenseCertification=require("./LicenseCertification");module.exports=JobTitleStateProvinceLicense},{"./LicenseCertification":72,"./Model":75}],72:[function(require,module,exports){"use strict";function LicenseCertification(values){Model(this);this.model.defProperties({licenseCertificationID:0,name:"",description:"",authority:null,verificationWebsiteUrl:null,howToGetLicensedUrl:null,createdDate:null,updatedDate:null,languageID:0},values);this.model.defID(["licenseCertificationID","languageID"])}var Model=require("./Model");module.exports=LicenseCertification},{"./Model":75}],73:[function(require,module,exports){"use strict";function MarketplaceProfile(values){Model(this);this.model.defProperties({userID:0,publicBio:"",serviceProfessionalProfileUrlSlug:"",serviceProfessionalProfileUrl:"",serviceProfessionalWebsiteUrl:"",bookCode:"",photoUrl:"",createdDate:null,updatedDate:null},values)}var Model=require("./Model");module.exports=MarketplaceProfile},{"./Model":75}],74:[function(require,module,exports){"use strict";function Message(values){Model(this);this.model.defProperties({messageID:0,threadID:0,sentByUserID:null,typeID:null,auxT:null,auxID:null,bodyText:"",createdDate:null,
updatedDate:null},values);this.displayedDate=ko.pureComputed(function(){return moment(this.createdDate()).locale("en-US-LC").calendar()},this);this.displayedTime=ko.pureComputed(function(){return moment(this.createdDate()).locale("en-US-LC").format("LT")},this)}var ko=require("knockout"),Model=require("./Model"),moment=require("moment");module.exports=Message},{"./Model":75,knockout:!1,moment:!1}],75:[function(require,module,exports){"use strict";function Model(modelObject){if(!(this instanceof Model)){var model=new Model(modelObject);modelObject.model=model;return model}this.modelObject=modelObject;this.propertiesList=[];this.fieldsList=[];this.propertiesDefs={};this.fieldsDefs={};this.mappingOptions={};this.dataTimestamp=ko.observable(new Date).extend({rateLimit:0})}function prepareValueByDef(val,def){def.isArray&&!Array.isArray(val)&&(val=val?[val]:[]);if(def&&def.Model){var getModelInstance=function(item){if(item instanceof def.Model||null===item||"undefined"==typeof item)return item;if(def.initialValue&&def.initialValue.model){var m=new def.Model(def.initialValue.model.toPlainObject(!0));m.model.updateWith(item,!0);return m}return new def.Model(item)};val=Array.isArray(val)?val.map(getModelInstance):getModelInstance(val)}else if(def&&def.isDate){var getDate=function(v){return v instanceof Date?v:"string"==typeof v?new Date(v):"number"==typeof v?new Date(v):null};val=Array.isArray(val)?val.map(getDate):getDate(val)}return val}function createDef(givenVal,initialVal){var def,isModel=givenVal&&givenVal.model instanceof Model,isArray=Array.isArray(givenVal),isDate=givenVal instanceof Date,isObject="object"==typeof givenVal&&!isDate;if(null===givenVal||isModel||!isObject||isArray){def={defaultValue:givenVal,isArray:isArray};isModel?def.Model=givenVal.constructor:isDate&&(def.isDate=isDate)}else def=givenVal;initialVal="undefined"==typeof initialVal?def.defaultValue:initialVal;def.initialValue=prepareValueByDef(initialVal,def);return def}var ko=require("knockout");ko.mapping=require("knockout.mapping");var $=require("jquery"),clone=function(obj){return $.extend(!0,{},obj)},cloneValue=function(val,deepCopy){return"object"==typeof val?val instanceof Date?new Date(val):deepCopy===!0?val instanceof Array?val.map(function(item){return cloneValue(item,!0)}):null===val?null:val&&val.model instanceof Model?val.model.toPlainObject(deepCopy):clone(val):deepCopy===!1?val:void 0:val};module.exports=Model;Model.prototype.defProperties=function defProperties(properties,initialValues){initialValues=initialValues||{};var modelObject=this.modelObject,propertiesList=this.propertiesList,defs=this.propertiesDefs,dataTimestamp=this.dataTimestamp;Object.keys(properties).forEach(function(key){var def=createDef(properties[key],initialValues[key]);defs[key]=def;modelObject[key]=Array.isArray(def.initialValue)?ko.observableArray(def.initialValue):ko.observable(def.initialValue);modelObject[key]._defaultValue=def.defaultValue;modelObject[key]._initialValue=def.initialValue;modelObject[key].subscribe(function(){dataTimestamp(new Date)});propertiesList.push(key)});dataTimestamp(new Date)};Model.prototype.defFields=function defFields(fields,initialValues){initialValues=initialValues||{};var modelObject=this.modelObject,defs=this.fieldsDefs,fieldsList=this.fieldsList;Object.keys(fields).each(function(key){var def=createDef(fields[key],initialValues[key]);defs[key]=def;modelObject[key]=def.initialValue;fieldsList.push(key)})};Model.prototype.defID=function defID(fieldsNames){this.idFieldsNames=fieldsNames;if(1===fieldsNames.length){var field=fieldsNames[0];this.modelObject.id=ko.pureComputed(function(){return this[field]()},this.modelObject)}else this.modelObject.id=ko.pureComputed(function(){return fieldsNames.map(function(fieldName){return this[fieldName]()}.bind(this))},this.modelObject)};Model.prototype.regTimestamp=function regTimestampProperty(propertyName){var prop=this.modelObject[propertyName];if("function"!=typeof prop)throw new Error("There is no observable property with name ["+propertyName+"] to register as timestamp.");this.dataTimestamp.subscribe(function(timestamp){prop(timestamp)})};Model.prototype.toPlainObject=function toPlainObject(deepCopy){function setValue(property,val){var clonedValue=cloneValue(val,deepCopy);"undefined"!=typeof clonedValue&&(plain[property]=clonedValue)}var plain={},modelObj=this.modelObject;this.propertiesList.forEach(function(property){var val=modelObj[property]();setValue(property,val)});this.fieldsList.forEach(function(field){var val=modelObj[field];setValue(field,val)});return plain};Model.prototype.updateWith=function updateWith(data,deepCopy){var timestamp=null;if(data&&data.model instanceof Model){timestamp=data.model.dataTimestamp();data=data.model.toPlainObject(deepCopy)}var target=this.modelObject,defs=this.propertiesDefs;this.propertiesList.forEach(function(property){var val=data[property],def=defs[property];"undefined"!=typeof val&&target[property](prepareValueByDef(val,def))});defs=this.fieldsDefs;this.fieldsList.forEach(function(field){var val=data[field],def=defs[field];"undefined"!=typeof val&&(target[field]=prepareValueByDef(val,def))});timestamp&&this.modelObject.model.dataTimestamp(timestamp)};Model.prototype.mapData=function mapData(data,optionalMapping){ko.mapping.fromJS(data,optionalMapping||this.mappingOptions,this.modelObject)};Model.prototype.clone=function clone(data,deepCopy){var plain=this.toPlainObject(deepCopy),cloned=new this.modelObject.constructor(plain);data?cloned.model.updateWith(data):cloned.model.dataTimestamp(this.modelObject.model.dataTimestamp());return cloned};Model.prototype.touch=function touch(){this.dataTimestamp(new Date(Date()+1))};Model.prototype.reset=function reset(presets){var newInstance=new this.modelObject.constructor(presets);this.updateWith(newInstance,!0)}},{knockout:!1,"knockout.mapping":!1}],76:[function(require,module,exports){"use strict";function PaymentAccount(values){Model(this);this.model.defProperties({userID:"",firstName:"",lastName:"",phone:"",streetAddress:"",city:"",postalCode:"",routingNumber:"",accountNumber:"",ssn:"",stateProvinceCode:"",birthDate:"",isVenmo:!1,agree:!1,status:"",errors:{isArray:!0}},values)}var Model=require("./Model");module.exports=PaymentAccount},{"./Model":75}],77:[function(require,module,exports){"use strict";var Model=require("./Model"),ko=require("knockout"),PricingSummaryDetail=require("./PricingSummaryDetail");module.exports=function PricingSummary(values){Model(this);this.model.defProperties({pricingSummaryID:0,pricingSummaryRevision:0,serviceDurationMinutes:null,firstSessionDurationMinutes:null,subtotalPrice:null,clientServiceFeePrice:null,totalPrice:null,serviceFeeAmount:null,cancellationFeeCharged:null,cancellationDate:null,firstTimeServiceFeeFixed:null,firstTimeServiceFeePercentage:null,paymentProcessingFeePercentage:null,paymentProcessingFeeFixed:null,firstTimeServiceFeeMaximum:null,firstTimeServiceFeeMinimum:null,createdDate:null,updatedDate:null,details:{Model:PricingSummaryDetail,isArray:!0}},values);this.servicesSummary=ko.pureComputed(function(){return this.details().map(function(detail){return detail.serviceName()}).join(", ")},this).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}})}},{"./Model":75,"./PricingSummaryDetail":78,knockout:!1}],78:[function(require,module,exports){"use strict";function PricingSummaryDetail(values){Model(this);this.model.defProperties({pricingSummaryID:0,pricingSummaryRevision:0,serviceProfessionalServiceID:0,serviceProfessionalDataInput:null,clientDataInput:null,hourlyPrice:null,price:null,serviceDurationMinutes:null,firstSessionDurationMinutes:null,serviceName:"",serviceDescription:null,numberOfSessions:1,createdDate:null,updatedDate:null},values)}var Model=require("./Model");module.exports=PricingSummaryDetail;PricingSummaryDetail.fromServiceProfessionalService=function(service){var allSessionMinutes=service.numberOfSessions()>0?service.serviceDurationMinutes()*service.numberOfSessions():service.serviceDurationMinutes();return new PricingSummaryDetail({serviceName:service.name(),serviceDescription:service.description(),numberOfSessions:service.numberOfSessions(),serviceDurationMinutes:allSessionMinutes,firstSessionDurationMinutes:service.serviceDurationMinutes(),price:service.price(),serviceProfessionalServiceID:service.serviceProfessionalServiceID(),hourlyPrice:"HOUR"===(service.priceRateUnit()||"").toUpperCase()?service.priceRate():null})}},{"./Model":75}],79:[function(require,module,exports){"use strict";function PricingType(values){Model(this);this.model.defProperties({pricingTypeID:0,singularName:"",pluralName:"",slugName:"",addNewLabel:null,serviceProfessionalDescription:null,priceCalculation:null,isAddon:!1,namePlaceHolder:null,suggestedName:null,fixedName:null,durationLabel:null,priceLabel:null,priceNote:null,firstTimeClientsOnlyLabel:null,descriptionPlaceHolder:null,priceRateQuantityLabel:null,priceRateUnitLabel:null,noPriceRateLabel:null,numberOfSessionsLabel:null,inPersonPhoneLabel:null,successOnDelete:null,errorOnDelete:null,successOnSave:null,errorOnSave:null,priceRateIsRequiredValidationError:null,priceRateUnitIsRequiredValidationError:null,learnMoreLabel:null,learnMoreText:null,priceRateLearnMoreLabel:null,priceRateLearnMoreText:null,noPriceRateLearnMoreLabel:null,noPriceRateLearnMoreText:null,requireDuration:!1,includeServiceAttributes:!1,includeSpecialPromotion:!1,summaryFormat:null,summaryFormatMultipleSessions:null,summaryFormatNoDuration:null,summaryFormatMultipleSessionsNoDuration:null,withoutServiceAttributesClientMessage:null,withoutServiceAttributesServiceProfessionalMessage:null,firstTimeClientsOnlyListText:null,priceRateQuantityListLabel:null,priceRateUnitListLabel:null,noPriceRateListMessage:null,nameAndSummaryFormat:null,nameAndSummaryFormatMultipleSessions:null,nameAndSummaryFormatNoDuration:null,nameAndSummaryFormatMultipleSessionsNoDuration:null,createdDate:null,updatedDate:null},values);this.model.defID(["pricingTypeID"])}var Model=require("./Model");module.exports=PricingType;var PriceCalculationType={FixedPrice:1,HourlyPrice:2};PricingType.PriceCalculationType=PriceCalculationType},{"./Model":75}],80:[function(require,module,exports){"use strict";function PrivacySettings(values){Model(this);this.model.defProperties({userID:0,smsBookingCommunication:!1,phoneBookingCommunication:!1,loconomicsCommunityCommunication:!1,loconomicsDbmCampaigns:!1,profileSeoPermission:!1,loconomicsMarketingCampaigns:!1,coBrandedPartnerPermissions:!1,createdDate:null,updatedDate:null},values);this.model.defID(["userID"])}var Model=require("./Model");module.exports=PrivacySettings},{"./Model":75}],81:[function(require,module,exports){"use strict";function PublicUser(values){Model(this);this.model.defProperties({profile:{Model:PublicUserProfile},rating:{Model:PublicUserRating},verificationsSummary:{Model:PublicUserVerificationsSummary},jobProfile:{Model:PublicUserJobTitle,isArray:!0},stats:{Model:PublicUserStats},education:{Model:UserEducation,isArray:!0},verifications:{Model:UserVerification,isArray:!0},backgroundCheckPassed:null,selectedJobTitleID:null,isClientFavorite:!1},values);this.selectedJobTitle=ko.pureComputed(function(){var jid=this.selectedJobTitleID(),jp=this.jobProfile();if(!jid||!jp)return null;var found=null;jp.some(function(jobTitle){if(jobTitle.jobTitleID()===jid){found=jobTitle;return!0}});return found},this);this.backgroundCheckLabel=ko.pureComputed(function(){var v=this.backgroundCheckPassed();return v===!0?"OK":v===!1?"FAILED":""},this);this.otherJobTitles=ko.pureComputed(function(){var jid=this.selectedJobTitleID(),jp=this.jobProfile();return jp.filter(function(jt){return jt.jobTitleID()!==jid})},this);this.otherJobTitleNames=ko.pureComputed(function(){return this.otherJobTitles().map(function(jd){return jd.jobTitleSingularName()}).join(", ")},this)}var Model=require("./Model"),PublicUserProfile=require("./PublicUserProfile"),PublicUserRating=require("./PublicUserRating"),PublicUserVerificationsSummary=require("./PublicUserVerificationsSummary"),PublicUserJobTitle=require("./PublicUserJobTitle"),PublicUserStats=require("./PublicUserStats"),UserEducation=require("./UserEducation"),UserVerification=require("./UserVerification"),ko=require("knockout");module.exports=PublicUser},{"./Model":75,"./PublicUserJobTitle":83,"./PublicUserProfile":85,"./PublicUserRating":86,"./PublicUserStats":87,"./PublicUserVerificationsSummary":89,"./UserEducation":100,"./UserVerification":104,knockout:!1}],82:[function(require,module,exports){"use strict";function PublicUserJobStats(values){Model(this);this.model.defProperties({userID:0,jobTitleID:0,servicesCount:0,minServicePrice:0,minUnitRate:0,priceRateUnit:"",minServiceValue:""},values)}var Model=require("./Model");module.exports=PublicUserJobStats},{"./Model":75}],83:[function(require,module,exports){"use strict";function PublicUserJobTitle(values){Model(this);this.model.defProperties({userID:0,jobTitleID:0,intro:null,cancellationPolicyID:0,instantBooking:!1,jobTitleSingularName:"",jobTitlePluralName:"",rating:{Model:PublicUserRating},verificationsSummary:{Model:PublicUserVerificationsSummary},serviceAddresses:{Model:Address,isArray:!0},services:{Model:ServiceProfessionalService,isArray:!0},serviceAttributes:{Model:PublicUserJobTitleServiceAttributes},workPhotos:{Model:WorkPhoto,isArray:!0},verifications:{Model:UserVerification,isArray:!0},licensesCertifications:{Model:UserLicenseCertification,isArray:!0}},values);this.model.defID(["userID","jobTitleID"]);var findMinValue=function(services){var s=services,maxValue={price:Number.MAX_VALUE};if(0===s.length)return null;var minValue=s.reduce(function(last,serv){return null!==serv.priceRate()&&serv.priceRate()<last.price?{price:serv.priceRate(),unit:serv.priceRateUnit()}:null!==serv.price()&&serv.price()<last.price?{price:serv.price(),unit:null}:last},maxValue);return minValue===maxValue?null:minValue};this.minServiceValue=ko.pureComputed(function(){var price=findMinValue(this.services());return price?price.unit?numeral(price.price).format("$0")+"/"+price.unit:numeral(price.price).format("$0.00"):""},this);this.clientSpecificServices=function(){return this.services().filter(function(service){return service.isClientSpecific()})};this.publicServices=function(){return this.services().filter(function(service){return!service.isClientSpecific()})}}var ko=require("knockout"),numeral=require("numeral"),Model=require("./Model"),PublicUserRating=require("./PublicUserRating"),PublicUserVerificationsSummary=require("./PublicUserVerificationsSummary"),Address=require("./Address"),WorkPhoto=require("./WorkPhoto"),PublicUserJobTitleServiceAttributes=require("./PublicUserJobTitleServiceAttributes"),ServiceProfessionalService=require("./ServiceProfessionalService"),UserVerification=require("./UserVerification"),UserLicenseCertification=require("./UserLicenseCertification");module.exports=PublicUserJobTitle},{"./Address":49,"./Model":75,"./PublicUserJobTitleServiceAttributes":84,"./PublicUserRating":86,"./PublicUserVerificationsSummary":89,"./ServiceProfessionalService":95,"./UserLicenseCertification":103,"./UserVerification":104,"./WorkPhoto":108,knockout:!1,numeral:!1}],84:[function(require,module,exports){"use strict";function PublicUserJobTitleServiceAttributes(values){Model(this);this.model.defProperties({userID:0,jobTitleID:0,serviceAttributes:{isArray:!0,Model:ServiceAttributeCategory},experienceLevel:{Model:ExperienceLevel},languageID:0,countryID:0},values)}var Model=require("./Model"),ServiceAttributeCategory=require("./ServiceAttributeCategory"),ExperienceLevel=require("./ExperienceLevel");module.exports=PublicUserJobTitleServiceAttributes},{"./ExperienceLevel":59,"./Model":75,"./ServiceAttributeCategory":93}],85:[function(require,module,exports){"use strict";function PublicUserProfile(values){Model(this);this.model.defProperties({userID:0,firstName:0,lastName:0,secondLastName:0,businessName:0,publicBio:0,serviceProfessionalProfileUrlSlug:null,serviceProfessionalWebsiteUrl:null,serviceProfessionalProfileUrl:null,photoUrl:null,email:null,phone:null,isServiceProfessional:!1,isClient:!1,timeZone:null,updatedDate:null},values);this.fullName=ko.pureComputed(function(){var nameParts=[this.firstName()];this.lastName()&&nameParts.push(this.lastName());this.secondLastName()&&nameParts.push(this.secondLastName);return nameParts.join(" ")},this);this.publicName=ko.pureComputed(function(){var b=this.businessName();return b?b:this.fullName()},this)}var Model=require("./Model"),ko=require("knockout");module.exports=PublicUserProfile},{"./Model":75,knockout:!1}],86:[function(require,module,exports){"use strict";function PublicUserRating(values){Model(this);this.model.defProperties({rating1:0,rating2:0,rating3:0,ratingAverage:0,totalRatings:0,serviceHours:0,lastRatingDate:null},values)}var Model=require("./Model");module.exports=PublicUserRating},{"./Model":75}],87:[function(require,module,exports){"use strict";function PublicUserStats(values){Model(this);this.model.defProperties({userID:0,responseTimeMinutes:0},values);this.responseTimeText=ko.pureComputed(function(){var min=this.responseTimeMinutes();return 1>min?"immediate":duration2Language({minutes:min})},this)}var Model=require("./Model"),duration2Language=require("../utils/duration2Language"),ko=require("knockout");module.exports=PublicUserStats},{"../utils/duration2Language":129,"./Model":75,knockout:!1}],88:[function(require,module,exports){"use strict";function PublicUserVerificationsGroup(values){Model(this);this.model.defProperties({verificationsCount:0,groupName:"",groupID:""},values)}var Model=require("./Model");module.exports=PublicUserVerificationsGroup},{"./Model":75}],89:[function(require,module,exports){"use strict";function PublicUserVerificationsSummary(values){Model(this);this.model.defProperties({total:0,groups:PublicUserVerificationsGroup},values)}var Model=require("./Model"),PublicUserVerificationsGroup=require("./PublicUserVerificationsGroup");module.exports=PublicUserVerificationsSummary},{"./Model":75,"./PublicUserVerificationsGroup":88}],90:[function(require,module,exports){"use strict";function SchedulingPreferences(values){Model(this);this.model.defProperties({advanceTime:24,betweenTime:0,incrementsSizeInMinutes:15},values)}var Model=require("./Model");module.exports=SchedulingPreferences},{"./Model":75}],91:[function(require,module,exports){"use strict";function SearchResults(values){Model(this);this.model.defProperties({jobTitles:{isArray:!0,Model:JobTitleSearchResult},serviceProfessionals:{isArray:!0,Model:ServiceProfessionalSearchResult},categories:{isArray:!0,Model:CategorySearchResult}},values)}var Model=require("./Model"),JobTitleSearchResult=require("./JobTitleSearchResult"),ServiceProfessionalSearchResult=require("./ServiceProfessionalSearchResult"),CategorySearchResult=require("./CategorySearchResult");module.exports=SearchResults},{"./CategorySearchResult":55,"./JobTitleSearchResult":69,"./Model":75,"./ServiceProfessionalSearchResult":94}],92:[function(require,module,exports){"use strict";function ServiceAttribute(values){Model(this);this.model.defProperties({serviceAttributeID:0,name:"",description:null},values)}var Model=require("./Model");module.exports=ServiceAttribute},{"./Model":75}],93:[function(require,module,exports){"use strict";function ServiceAttributeCategory(values){Model(this);this.model.defProperties({serviceAttributeCategoryID:0,name:"",description:null,requiredInput:!1,eligibleForPackages:!1,serviceAttributes:{isArray:!0,Model:ServiceAttribute}},values)}var Model=require("./Model"),ServiceAttribute=require("./ServiceAttribute");module.exports=ServiceAttributeCategory},{"./Model":75,"./ServiceAttribute":92}],94:[function(require,module,exports){"use strict";function ServiceProfessionalSearchResult(values){Model(this);this.model.defProperties({userID:0,jobTitleID:0,firstName:"",lastName:"",lastInitial:"",publicBio:"",businessName:"",instantBooking:"",jobTitleNameSingular:"",otherJobTitles:"",allJobTitles:"",distance:0,rating:{Model:PublicUserRating},verificationsSummary:{Model:PublicUserVerificationsSummary},stats:{Model:PublicUserStats},jobStats:{Model:PublicUserJobStats},photoUrl:""},values)}var Model=require("./Model"),PublicUserRating=require("./PublicUserRating"),PublicUserVerificationsSummary=require("./PublicUserVerificationsSummary"),PublicUserStats=require("./PublicUserStats"),PublicUserJobStats=require("./PublicUserJobStats");module.exports=ServiceProfessionalSearchResult},{"./Model":75,"./PublicUserJobStats":82,"./PublicUserRating":86,"./PublicUserStats":87,"./PublicUserVerificationsSummary":89}],95:[function(require,module,exports){"use strict";function ServiceProfessionalService(values){Model(this);this.model.defProperties({serviceProfessionalServiceID:0,serviceProfessionalUserID:0,jobTitleID:0,pricingTypeID:0,name:"",description:null,price:null,serviceDurationMinutes:null,firstTimeClientsOnly:!1,numberOfSessions:1,priceRate:null,priceRateUnit:"hour",noPriceRate:!1,isPhone:!1,serviceAttributes:[],createdDate:null,updatedDate:null,visibleToClientID:0},values);this.model.defID(["serviceProfessionalServiceID"]);this.noPriceRate.subscribe(function(enabled){enabled===!0&&this.priceRate(null)},this);this.refreshNoPriceRate=function refreshNoPriceRate(){if(this.serviceProfessionalServiceID()&&(0|this.priceRate())<=0){var ts=this.model.dataTimestamp();this.noPriceRate(!0);this.model.dataTimestamp(ts)}};var is=require("is_js");this.durationHoursPart=ko.pureComputed({read:function(){var fullMinutes=this.serviceDurationMinutes();return is.not.number(fullMinutes)?null:(0|fullMinutes)/60|0},write:function(hours){var minutes=0|this.durationMinutesPart();hours=parseInt(hours,10);is.not.number(hours)?this.serviceDurationMinutes(null):this.serviceDurationMinutes(60*(0|hours)+minutes)},owner:this});this.durationMinutesPart=ko.pureComputed({read:function(){var fullMinutes=this.serviceDurationMinutes();return is.not.number(fullMinutes)?null:(0|fullMinutes)%60},write:function(minutes){var hours=0|this.durationHoursPart();minutes=parseInt(minutes,10);is.not.number(minutes)?this.serviceDurationMinutes(null):this.serviceDurationMinutes(60*hours+(0|minutes))},owner:this});this.durationText=ko.pureComputed(function(){var minutes=this.serviceDurationMinutes()||0;return minutes?numeral(minutes).format("0,0")+" minutes":""},this);this.sessionsAndDuration=ko.pureComputed(function(){var sessions=this.numberOfSessions(),dur=this.durationText();return sessions>1?sessions+" sessions, "+dur:dur},this);this.displayedPrice=ko.pureComputed(function(){var price=this.price(),rate=this.priceRate(),unit=this.priceRateUnit(),result;result=price?numeral(price).format("$0,0.00"):numeral(rate).format("$0");!price&&rate&&unit&&(result+="/"+unit);return result},this);this.displayedDurationAndPrice=ko.pureComputed(function(){var dur=this.sessionsAndDuration(),pr=this.displayedPrice();return dur&&pr?dur+", "+pr:dur||pr},this);this.clientID=function(){return this.visibleToClientID()>0?this.visibleToClientID():null};this.isClientSpecific=function(){return this.visibleToClientID()>0}.bind(this)}var Model=require("./Model"),ko=require("knockout"),numeral=require("numeral");module.exports=ServiceProfessionalService},{"./Model":75,is_js:!1,knockout:!1,numeral:!1}],96:[function(require,module,exports){"use strict";function StateProvince(values){Model(this);this.model.defProperties({code:"",name:""},values)}var Model=require("./Model");module.exports=StateProvince},{"./Model":75}],97:[function(require,module,exports){"use strict";function Thread(values){Model(this);this.model.defProperties({threadID:0,clientUserID:null,serviceProfessionalUserID:null,jobTitleID:null,statusID:null,subject:null,messages:{isArray:!0,Model:Message},createdDate:null,updatedDate:null},values)}var Model=require("./Model"),Message=require("./Message");module.exports=Thread},{"./Message":74,"./Model":75}],98:[function(require,module,exports){"use strict";function TimeRange(values){Model(this);this.model.defProperties({start:"00:00:00",end:"00:00:00"},values);this.fromMinute=ko.computed({read:function(){return timeStringToMinutes(this.start())},write:function(minutes){this.start(minutesToTimeString(0|minutes))},owner:this});this.toMinute=ko.computed({read:function(){return timeStringToMinutes(this.end())},write:function(minutes){this.end(minutesToTimeString(0|minutes))},owner:this})}function twoDigits(n){return Math.floor(n/10)+""+n%10}function minutesToTimeString(minutes){var d=moment.duration(minutes,"minutes"),h=d.hours(),m=d.minutes(),s=d.seconds();return twoDigits(h)+":"+twoDigits(m)+":"+twoDigits(s)}function timeStringToMinutes(time){return 0|moment.duration(time).asMinutes()}var Model=require("./Model"),moment=require("moment"),ko=require("knockout");module.exports=TimeRange},{"./Model":75,knockout:!1,moment:!1}],99:[function(require,module,exports){"use strict";function User(values){Model(this);this.model.defProperties({userID:0,email:"",firstName:"",lastName:"",secondLastName:"",businessName:"",alternativeEmail:"",phone:"",canReceiveSms:"",birthMonthDay:null,birthMonth:null,isServiceProfessional:!1,isClient:!1,isAdmin:!1,isCollaborator:!1,photoUrl:null,onboardingStep:null,accountStatusID:0,createdDate:null,updatedDate:null},values);this.fullName=ko.pureComputed(function(){var nameParts=[this.firstName()];this.lastName()&&nameParts.push(this.lastName());this.secondLastName()&&nameParts.push(this.secondLastName);return nameParts.join(" ")},this);this.birthDay=ko.pureComputed(function(){return this.birthMonthDay()&&this.birthMonth()?this.birthMonth()+"/"+this.birthMonthDay():null},this);this.userType=ko.pureComputed({read:function(){var c=this.isClient(),p=this.isServiceProfessional(),a=this.isAdmin(),userType=0;this.isAnonymous()&&(userType|=UserType.anonymous);c&&(userType|=UserType.client);p&&(userType|=UserType.serviceProfessional);a&&(userType|=UserType.admin);return userType},owner:this});this.isAnonymous=ko.pureComputed(function(){return this.userID()<1},this);this.isUserType=function isUserType(type){return this.userType()&type}.bind(this)}var ko=require("knockout"),Model=require("./Model"),UserType={none:0,anonymous:1,client:2,serviceProfessional:4,member:12,admin:16,loggedUser:30,user:31,system:32};module.exports=User;User.UserType=UserType;User.newAnonymous=function newAnonymous(){return new User({userID:0,email:"",firstName:"",onboardingStep:null})}},{"./Model":75,knockout:!1}],100:[function(require,module,exports){"use strict";function UserEducation(values){Model(this);this.model.defProperties({educationID:0,userID:0,institutionName:"",degreeCertificate:"",fieldOfStudy:"",fromYearAttended:null,toYearAttended:null},values)}var Model=require("./Model");module.exports=UserEducation},{"./Model":75}],101:[function(require,module,exports){"use strict";function UserJobTitle(values){Model(this);this.model.defProperties({userID:0,jobTitleID:0,intro:null,statusID:0,cancellationPolicyID:0,instantBooking:!1,bookMeButtonReady:!1,collectPaymentAtBookMeButton:!1,createdDate:null,updatedDate:null},values);this.model.defID(["userID","jobTitleID"])}var Model=require("./Model");module.exports=UserJobTitle;UserJobTitle.status={on:1,incomplete:2,off:3}},{"./Model":75}],102:[function(require,module,exports){"use strict";function extendValuesByCategory(obs){obs.notifyChanges=obs.valueHasMutated;obs.serviceAttributeCategoriesIDs=ko.pureComputed(function(){return Object.keys(obs()||{}).filter(function(key){return 0===(0|key)})});var catsObs={};obs.getServiceCategoryAttributes=function(catID){var catObs=catsObs[catID]=catsObs[catID]||ko.observable({});return ko.computed(function(){var base=obs.peek();catObs();return base&&base[catID]||[]})};var prevValue=obs();obs.subscribe(function(v){if(v!==prevValue){prevValue=v;Object.keys(catsObs).forEach(function(a){a.valueHasMutated&&a.valueHasMutated()})}});obs.push=function(catID,attID){var v=obs();if(v){var cat=v[catID]||(v[catID]=[]);if(-1===cat.indexOf(attID)){cat.push(attID);obs.notifyChanges();catsObs[catID]&&catsObs[catID].valueHasMutated()}}else{v={};v[catID]=[attID];obs(v);catsObs[catID]&&catsObs[catID].valueHasMutated()}};obs.remove=function(catID,attID){var v=obs(),cat=v&&v[catID];if(cat){var i=cat.indexOf(attID);if(i>-1){cat.splice(i,1);obs.notifyChanges();catsObs[catID]&&catsObs[catID].valueHasMutated()}}}}function UserJobTitleServiceAttributes(values){Model(this);this.model.defProperties({userID:0,jobTitleID:0,serviceAttributes:{},proposedServiceAttributes:{},experienceLevelID:!1,languageID:0,countryID:0},values);extendValuesByCategory(this.serviceAttributes);extendValuesByCategory(this.proposedServiceAttributes)}var Model=require("./Model"),ko=require("knockout");module.exports=UserJobTitleServiceAttributes},{"./Model":75,knockout:!1}],103:[function(require,module,exports){"use strict";function UserLicenseCertification(values){Model(this);this.model.defProperties({userLicenseCertificationID:0,userID:0,jobTitleID:0,licenseCertificationID:0,statusID:0,licenseCertificationNumber:"",licenseCertificationUrl:"",expirationDate:null,issueDate:null,firstName:null,lastName:null,middleInitial:null,secondLastName:null,businessName:null,comments:null,verifiedBy:null,lastVerifiedDate:null,submitDate:null,submittedBy:null,submittedImageLocalURL:null,status:null,statusDescription:null,licenseCertification:new LicenseCertification,localTempFilePath:null,localTempPhotoPreviewUrl:null,localTempFileData:null,localTempPhotoPreview:null,localTempFileName:null},values);this.model.defID(["userLicenseCertificationID"])}var Model=require("./Model"),LicenseCertification=require("./LicenseCertification");module.exports=UserLicenseCertification},{"./LicenseCertification":72,"./Model":75}],104:[function(require,module,exports){"use strict";function UserVerification(values){Model(this);this.model.defProperties({userID:0,verificationID:0,jobTitleID:0,lastVerifiedDate:null,statusID:0,verification:{Model:Verification}},values);var statusTextsenUS={"verification.status.confirmed":"Confirmed","verification.status.pending":"Pending","verification.status.revoked":"Revoked","verification.status.obsolete":"Obsolete"};this.statusText=ko.pureComputed(function(){var statusName=Verification.getStatusName(this.statusID());return statusTextsenUS["verification.status."+statusName]},this);this.isStatus=function(statusName){var id=this.statusID();return Verification.status[statusName]===id}.bind(this)}var Model=require("./Model"),ko=require("knockout"),Verification=require("./Verification");module.exports=UserVerification},{"./Model":75,"./Verification":105,knockout:!1}],105:[function(require,module,exports){"use strict";function Verification(values){Model(this);this.model.defProperties({verificationID:0,name:"",description:null,icon:null,summaryGroup:null},values)}function enumGetName(value,enumList){var found=null;Object.keys(enumList).some(function(k){if(enumList[k]===value){found=k;return!0}});return found}var Model=require("./Model");Verification.status={confirmed:1,pending:2,revoked:3,obsolete:4};Verification.getStatusName=function getStatusName(value){return enumGetName(value,Verification.status)};module.exports=Verification},{"./Model":75}],106:[function(require,module,exports){"use strict";function WeekDaySchedule(obsArray){obsArray||(obsArray=ko.observableArray([]));obsArray.isEnabled=ko.computed({read:function(){var r=obsArray()&&obsArray()[0];return r&&r.fromMinute()<r.toMinute()||!1},write:function(val){obsArray.removeAll();val===!0&&obsArray.push(new TimeRange({start:"09:00:00",end:"17:00:00"}))}}).extend({rateLimit:0});obsArray.isAllDay=ko.computed({read:function(){var r=obsArray()&&obsArray()[0];return r?"00:00:00"===r.start()&&"24:00:00"===r.end():!1},write:function(val){if(val===!0){obsArray.removeAll();obsArray.push(new TimeRange({start:"00:00:00",end:"24:00:00"}))}}}).extend({rateLimit:0});obsArray.addTimeRange=function(){var arr=obsArray(),last=arr[arr.length-1],lastTime=last&&last.end()||"00:00:00",tr=new TimeRange({
start:lastTime}),nextHour=tr.fromMinute()+60;nextHour>=1439&&(nextHour=1410);tr.fromMinute(nextHour);nextHour+=60;nextHour>1439&&(nextHour=1439);tr.toMinute(nextHour);obsArray.push(tr)};obsArray.canAddMore=ko.computed(function(){var arr=obsArray(),last=arr[arr.length-1],lastMinute=last&&last.toMinute();return 1439>lastMinute});obsArray.removeTimeRange=function(timeRange){obsArray.remove(timeRange)};return obsArray}var ko=require("knockout"),TimeRange=require("./TimeRange");module.exports=WeekDaySchedule},{"./TimeRange":98,knockout:!1}],107:[function(require,module,exports){"use strict";function WeeklySchedule(values){Model(this);this.model.defProperties({sunday:{isArray:!0,Model:TimeRange},monday:{isArray:!0,Model:TimeRange},tuesday:{isArray:!0,Model:TimeRange},wednesday:{isArray:!0,Model:TimeRange},thursday:{isArray:!0,Model:TimeRange},friday:{isArray:!0,Model:TimeRange},saturday:{isArray:!0,Model:TimeRange},isAllTime:!1,timeZone:""},values);this.weekDays=[this.sunday,this.monday,this.tuesday,this.wednesday,this.thursday,this.friday,this.saturday];this.weekDays.forEach(WeekDaySchedule);this.displayedTimeZoneFormatter=function(tzid){var zone=moment.tz.zone(tzid),m=moment().startOf("year");return tzid?tzid+" ("+zone.abbr(m.valueOf())+")":""};this.timeZoneDisplayName=ko.computed(function(){var tzid=this.timeZone();return tzid?timeZoneList.timeZoneToDisplayFormat(this.timeZone()):""},this)}var ko=require("knockout"),moment=require("moment-timezone"),Model=require("./Model"),WeekDaySchedule=require("./WeekDaySchedule"),TimeRange=require("./TimeRange"),timeZoneList=require("../utils/timeZoneList");module.exports=WeeklySchedule},{"../utils/timeZoneList":142,"./Model":75,"./TimeRange":98,"./WeekDaySchedule":106,knockout:!1,"moment-timezone":!1}],108:[function(require,module,exports){"use strict";function WorkPhoto(values){Model(this);this.model.defProperties({workPhotoID:0,userID:0,jobTitleID:0,caption:"",fileName:"",url:"",rankPosition:0,updatedDate:null,rotationAngle:0,localTempFilePath:null,localTempFileData:null,localTempPhotoPreview:null},values);this.photoRotationStyle=ko.pureComputed(function(){var r=0|this.rotationAngle(),sr="rotate("+r+"deg)",s=1;(90===r||270===r)&&(s=FIXED_IMAGE_RATE);var ss="scale("+s+", "+s+")";return"transform: "+sr+" "+ss},this)}var Model=require("./Model"),ko=require("knockout"),FIXED_IMAGE_WIDTH=442,FIXED_IMAGE_HEIGHT=332,FIXED_IMAGE_RATE=FIXED_IMAGE_HEIGHT/FIXED_IMAGE_WIDTH;module.exports=WorkPhoto},{"./Model":75,knockout:!1}],109:[function(require,module,exports){"use strict";function CacheControl(options){options=options||{};this.ttl=moment.duration(options.ttl).asMilliseconds();this.latest=options.latest||null;this.mustRevalidate=function mustRevalidate(){var tdiff=this.latest&&new Date-this.latest||Number.POSITIVE_INFINITY;return tdiff>this.ttl};this.touch=function touch(){this.latest=new Date};this.reset=function reset(){this.latest=null};this.data=options.data||null}var moment=require("moment");module.exports=CacheControl},{moment:!1}],110:[function(require,module,exports){"use strict";var moment=require("moment"),CacheControl=require("./CacheControl");module.exports=function DateCache(settings){this.Model=settings&&settings.Model||null;this.ttl=settings&&settings.ttl||{minutes:1};this.byDate={};this.clear=function(){this.byDate={}};this.getSingle=function(date){var dateKey=date;date instanceof Date&&(dateKey=moment(date).format("YYYY-MM-DD"));return this.byDate.hasOwnProperty(dateKey)&&!this.byDate[dateKey].control.mustRevalidate()?this.byDate[dateKey].data:null};this.remove=function(date){var dateKey=date;date instanceof Date&&(dateKey=moment(date).format("YYYY-MM-DD"));delete this.byDate[dateKey]};this.get=function(start,end){for(var date=new Date(start),resultsPerDate={},holes=[],minRequest=null,maxRequest=null;end>=date;){var dateKey=moment(date).format("YYYY-MM-DD");this.byDate.hasOwnProperty(dateKey)&&!this.byDate[dateKey].control.mustRevalidate()?resultsPerDate[dateKey]=this.byDate[dateKey].data:holes.push(new Date(date));date.setDate(date.getDate()+1)}holes.sort(function(a,b){return a===b?0:b>a?-1:1});minRequest=holes.length?holes[0]:null;maxRequest=holes.length?holes[holes.length-1]:null;return{byDate:resultsPerDate,holes:holes,minHole:minRequest,maxHole:maxRequest}};this.set=function(date,data){var dateKey=date;date instanceof Date&&(dateKey=moment(date).format("YYYY-MM-DD"));var c=this.byDate[dateKey];if(c&&c.data)this.Model?c.data.model.updateWith(data):c.data=data;else{c={data:this.Model?new this.Model(data):data,control:new CacheControl({ttl:this.ttl})};this.byDate[dateKey]=c}c.control.touch();return c}}},{"./CacheControl":109,moment:!1}],111:[function(require,module,exports){var Enum={parse:function(enumType,str,caseSensitive){if(caseSensitive)return enumType[str]||null;str=str.toLowerCase();for(var e in enumType)if(e.toLowerCase&&e.toLowerCase()==str)return enumType[e];return null},name:function(enumType,value){for(var e in enumType)if(enumType[e]===value)return e}};module.exports=Enum},{}],112:[function(require,module,exports){Function.prototype._delayed=function delayed(milliseconds){var fn=this;return function(){var context=this,args=arguments;setTimeout(function(){fn.apply(context,args)},milliseconds)}}},{}],113:[function(require,module,exports){Function.prototype._inherits=function _inherits(superCtor){this.prototype=Object.create(superCtor.prototype,{constructor:{value:this,enumerable:!1,writable:!0,configurable:!0}})}},{}],114:[function(require,module,exports){"use strict";(function f(){}).name||Object.defineProperty(Function.prototype,"name",{get:function(){var name=this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1];Object.defineProperty(this,"name",{value:name});return name}})},{}],115:[function(require,module,exports){"use strict";function required(val,msg){if(null===val||"undefined"==typeof val)throw new Error(msg||"Required parameter");return val}function GroupListRemoteModel(settings){function notImplemented(){throw new Error("Not Implemented")}settings=settings||{};settings.listTtl=required(settings.listTtl,"listTtl is required");settings.groupIdField=required(settings.groupIdField,"groupIdField is required");settings.itemIdField=required(settings.itemIdField,"itemIdField is required");settings.Model=settings.Model||null;this.settings=settings;this.state={isLoading:ko.observable(!1),isSyncing:ko.observable(!1),isSaving:ko.observable(!1),isDeleting:ko.observable(!1)};var cache=new IndexedGroupListCache({listTtl:settings.listTtl,groupIdField:settings.groupIdField,itemIdField:settings.itemIdField});this.clearCache=cache.clearCache;this.state.isLocked=ko.pureComputed(function(){return this.isLoading()||this.isSaving()||this.isDeleting()},this.state);this.fetchGroupFromLocal=notImplemented;this.fetchGroupFromRemote=notImplemented;this.pushGroupToLocal=notImplemented;this.pushItemToRemote=notImplemented;this.removeItemFromRemote=notImplemented;var api=this;api.getList=function getList(groupID){var cacheEntry=cache.getGroupCache(groupID);if(cacheEntry.request)return cacheEntry.request;if(cacheEntry.control.mustRevalidate()){if(cacheEntry.list){api.state.isSyncing(!0);cacheEntry.request=this.fetchGroupFromRemote(groupID).then(function(data){data=data||[];cache.setGroupCache(groupID,data);this.pushGroupToLocal(groupID,data);api.state.isLoading(!1);api.state.isSyncing(!1);cacheEntry.request=null;return data}.bind(this))["catch"](function(err){api.state.isLoading(!1);api.state.isSyncing(!1);cacheEntry.request=null;throw err});return cacheEntry.request}api.state.isLoading(!0);cacheEntry.request=this.fetchGroupFromLocal(groupID).then(function(data){api.state.isSyncing(!0);var remotePromise=this.fetchGroupFromRemote(groupID).then(function(serverData){cache.setGroupCache(groupID,serverData);this.pushGroupToLocal(groupID,serverData);api.state.isSyncing(!1);return serverData}.bind(this));return data?data:remotePromise}.bind(this)).then(function(data){data=data||[];cache.setGroupCache(groupID,data);this.pushGroupToLocal(groupID,data);api.state.isLoading(!1);cacheEntry.request=null;return data}.bind(this))["catch"](function(err){api.state.isLoading(!1);api.state.isSyncing(!1);cacheEntry.request=null;throw err});return cacheEntry.request}return Promise.resolve(cacheEntry.list)};api.getItem=function getItem(groupID,itemID){return api.getList(groupID).then(function(){var cacheItem=cache.getItemCache(groupID,itemID);if(!cacheItem){console.warn("GroupListRemoteModel Not found",groupID,itemID,settings.Model);throw new Error("Not Found")}return cacheItem.item})};api._pushItemToCache=function(serverData){if(serverData){var groupID=serverData[settings.groupIdField];cache.setItemCache(groupID,serverData[settings.itemIdField],serverData);this.pushGroupToLocal(groupID,cache.getGroupCache(groupID).list)}};api.setItem=function setItem(data){api.state.isSaving(!0);return this.pushItemToRemote(data).then(function(serverData){serverData&&api._pushItemToCache(serverData);api.state.isSaving(!1);return serverData}.bind(this))["catch"](function(err){api.state.isSaving(!1);throw err})};api.delItem=function delItem(groupID,itemID){api.state.isDeleting(!0);return this.removeItemFromRemote(groupID,itemID).then(function(removedData){cache.delItemCache(groupID,itemID);this.pushGroupToLocal(groupID,cache.getGroupCache(groupID).list);api.state.isDeleting(!1);return removedData}.bind(this))["catch"](function(err){api.state.isDeleting(!1);throw err})};api.asModel=function asModel(object){var Model=this.settings.Model;return Array.isArray(object)?object.map(function(item){return new Model(item)}):new Model(object)};api.getItemModel=function getItemModel(groupID,itemID){return api.getItem(groupID,itemID).then(function(data){return data?api.asModel(data):null})};var ModelVersion=require("../utils/ModelVersion");api.getItemVersion=function getItemVersion(groupID,itemID){return api.getItemModel(groupID,itemID).then(function(model){return model?new ModelVersion(model):null})};api.newItemVersion=function newItemVersion(values){var version=new ModelVersion(new this.settings.Model(values));version.version.model.touch();return version}}var ko=require("knockout"),IndexedGroupListCache=require("./IndexedGroupListCache");module.exports=GroupListRemoteModel;GroupListRemoteModel.prototype.addLocalforageSupport=function addLocalforageSupport(baseName){var localforage=require("localforage");this.fetchGroupFromLocal=function fetchFromLocal(groupID){return localforage.getItem(baseName+groupID)};this.pushGroupToLocal=function pushToLocal(groupID,data){return localforage.setItem(baseName+groupID,data)};this.removeGroupFromLocalCache=function(groupID){return localforage.removeItem(baseName+groupID)}};GroupListRemoteModel.prototype.addRestSupport=function addRestSupport(restClient,baseUrl){this.fetchGroupFromRemote=function fetchFromRemote(groupID){return restClient.get(baseUrl+groupID)};this.pushItemToRemote=function pushToRemote(data){var groupID=data[this.settings.groupIdField],itemID=data[this.settings.itemIdField],method=itemID?"put":"post",url=baseUrl+groupID+(itemID?"/"+itemID:"");return restClient[method](url,data)};this.removeItemFromRemote=function removeItemFromRemote(groupID,itemID){return restClient["delete"](baseUrl+groupID+"/"+itemID)}}},{"../utils/ModelVersion":120,"./IndexedGroupListCache":117,knockout:!1,localforage:!1}],116:[function(require,module,exports){"use strict";function required(val,msg){if(null===val||"undefined"==typeof val)throw new Error(msg||"Required parameter");return val}function GroupRemoteModel(settings){function notImplemented(){throw new Error("Not Implemented")}settings=settings||{};settings.ttl=required(settings.ttl,"ttl is required");settings.itemIdField=required(settings.itemIdField,"itemIdField is required");settings.Model=required(settings.Model,"Model is required");this.settings=settings;this.state={isLoading:ko.observable(!1),isSyncing:ko.observable(!1),isSaving:ko.observable(!1),isDeleting:ko.observable(!1)};var cache={},getCacheItem=function(id){var c=cache[id];c||(c=cache[id]=new CacheControl({ttl:settings.ttl}));return c},setCacheItem=function(id,rawData){var c=getCacheItem(id);c.data?c.data.model.updateWith(rawData,!0):c.data=new settings.Model(rawData);c.touch();return c};this.clearCache=function(){cache={}};this.state.isLocked=ko.pureComputed(function(){return this.isLoading()||this.isSaving()||this.isDeleting()},this.state);this.fetchItemFromLocal=notImplemented;this.fetchItemFromRemote=notImplemented;this.pushItemToLocal=notImplemented;this.pushItemToRemote=notImplemented;this.removeItemFromLocal=notImplemented;this.removeItemFromRemote=notImplemented;var api=this;api.getItem=function getItem(itemID,forceRemoteLoad){var cacheEntry=getCacheItem(itemID);if(cacheEntry.request)return cacheEntry.request;if(forceRemoteLoad||cacheEntry.mustRevalidate()){if(cacheEntry.data){api.state.isSyncing(!0);cacheEntry.request=this.fetchItemFromRemote(itemID).then(function(data){var cached=setCacheItem(itemID,data);this.pushItemToLocal(itemID,data);api.state.isLoading(!1);api.state.isSyncing(!1);cacheEntry.request=null;return cached.data}.bind(this))["catch"](function(err){api.state.isLoading(!1);api.state.isSyncing(!1);cacheEntry.request=null;throw err});return cacheEntry.request}api.state.isLoading(!0);cacheEntry.request=this.fetchItemFromLocal(itemID).then(function(data){api.state.isSyncing(!0);var remotePromise=this.fetchItemFromRemote(itemID).then(function(serverData){var cached=setCacheItem(itemID,serverData);this.pushItemToLocal(itemID,serverData);api.state.isSyncing(!1);return cached.data}.bind(this));return data?data:remotePromise}.bind(this)).then(function(data){var cached=setCacheItem(itemID,data);api.state.isLoading(!1);cacheEntry.request=null;return cached.data}.bind(this))["catch"](function(err){api.state.isLoading(!1);api.state.isSyncing(!1);cacheEntry.request=null;throw err});return cacheEntry.request}return Promise.resolve(cacheEntry.data)};api.setItem=function setItem(data){data=data&&data.model&&data.model.toPlainObject(!0)||data;api.state.isSaving(!0);return this.pushItemToRemote(data[settings.itemIdField],data).then(function(serverData){var cached;if(serverData){var itemID=serverData[settings.itemIdField];cached=setCacheItem(serverData[settings.itemIdField],serverData);this.pushItemToLocal(itemID,cached.data.model.toPlainObject(!0))}api.state.isSaving(!1);return cached&&cached.data}.bind(this))["catch"](function(err){api.state.isSaving(!1);throw err})};api.delItem=function delItem(itemID){api.state.isDeleting(!0);return this.removeItemFromRemote(itemID).then(function(removedData){delete cache[itemID];this.removeItemFromLocal(itemID);api.state.isDeleting(!1);return removedData}.bind(this))["catch"](function(err){api.state.isDeleting(!1);throw err})};var ModelVersion=require("../utils/ModelVersion");api.getItemVersion=function getItemVersion(itemID){var cached=cache[itemID],initialModel=cached&&cached.data||new settings.Model,version=new ModelVersion(initialModel);version.state={isLoading:ko.observable(!1),isSyncing:ko.observable(!1),isSaving:ko.observable(!1),lastError:ko.observable(null)};if(itemID&&(!cached||cached.mustRevalidate())){version.state.isLoading(!0);api.getItem(itemID).then(function(model){version.state.lastError(null);version.state.isLoading(!1);version.original.model.updateWith(model,!0);version.version.model.updateWith(model,!0)})["catch"](function(err){version.state.lastError(err);version.state.isLoading(!1)})}version.load=function load(newItemID,forceRemoteLoad){version.state.isSyncing(!0);var oItemID=newItemID||version.original[settings.itemIdField]();return api.getItem(oItemID,forceRemoteLoad).then(function(model){version.state.lastError(null);version.state.isSyncing(!1);version.original.model.updateWith(model,!0);version.pull({evenIfNewer:!0});return model})["catch"](function(err){version.state.lastError(err);version.state.isSyncing(!1);throw err})};version.reset=function reset(){version.original.model.reset();version.version.model.reset()};version.save=function save(){version.state.isSaving(!0);return api.setItem(version.version).then(function(model){version.state.lastError(null);version.state.isSaving(!1);version.version.model.updateWith(model,!0);version.push({evenIfObsolete:!0});return model})["catch"](function(err){version.state.lastError(err);version.state.isSaving(!1);throw err})};return version};api.newItemVersion=function newItemVersion(values){var version=api.getItemVersion();values&&version.version.model.updateWith(values,!0);version.version.model.touch();return version}}var ko=require("knockout"),CacheControl=require("./CacheControl");module.exports=GroupRemoteModel;GroupRemoteModel.prototype.addLocalforageSupport=function addLocalforageSupport(baseName){var localforage=require("localforage");this.fetchItemFromLocal=function fetchFromLocal(itemID){return localforage.getItem(baseName+itemID)};this.pushItemToLocal=function pushToLocal(itemID,data){return localforage.setItem(baseName+itemID,data)};this.remoteItemFromLocal=function remoteFromLocal(itemID){return localforage.removeItem(baseName+itemID)}};GroupRemoteModel.prototype.addRestSupport=function addRestSupport(restClient,baseUrl,suffixUrl){suffixUrl=suffixUrl||"";this.fetchItemFromRemote=function fetchFromRemote(itemID){return restClient.get(baseUrl+itemID+suffixUrl)};this.pushItemToRemote=function pushToRemote(itemID,data){var method=itemID?"put":"post",url=baseUrl+(itemID?"/"+itemID:"")+suffixUrl;return restClient[method](url,data)};this.removeItemFromRemote=function removeItemFromRemote(itemID){return restClient["delete"](baseUrl+itemID+suffixUrl)}}},{"../utils/ModelVersion":120,"./CacheControl":109,knockout:!1,localforage:!1}],117:[function(require,module,exports){"use strict";function createIndex(list,byField){var index={};list.forEach(function(item,itemIndex){index[item[byField]]={index:itemIndex,item:item}});return index}function required(val,msg){if(null===val||"undefined"==typeof val)throw new Error(msg||"Required parameter");return val}function IndexedGroupListCache(settings){function newCacheEntry(list){return{control:new CacheControl({ttl:settings.listTtl}),list:list||null,index:list&&createIndex(list,settings.itemIdField)||{}}}function setGroupCache(groupID,list){var cacheEntry=cache[groupID];if(cacheEntry){cacheEntry.list=list||[];cacheEntry.index=createIndex(list||[],settings.itemIdField)}else cacheEntry=cache[groupID]=newCacheEntry(list);cacheEntry.control.latest=new Date}function getGroupCache(groupID){var cacheEntry=cache[groupID];return cacheEntry||newCacheEntry()}function getItemCache(groupID,itemID){var cacheEntry=cache[groupID];return cacheEntry?cacheEntry.index[itemID]||null:null}function setItemCache(groupID,itemID,item){var cacheEntry=cache[groupID]||newCacheEntry([]),itemEntry=cacheEntry.index[itemID];if(itemEntry){cacheEntry.list[itemEntry.index]=item;itemEntry.item=item}else{var itemIndex=cacheEntry.list.push(item)-1;cacheEntry.index[itemID]={index:itemIndex,item:item}}}function delItemCache(groupID,itemID){var groupEntry=cache[groupID]||null;if(groupEntry){var itemEntry=groupEntry.index[itemID];if(itemEntry){groupEntry.list.splice(itemEntry.index,1);delete groupEntry.index[itemID];Object.keys(groupEntry.index).forEach(function(key){groupEntry.index[key].index>itemEntry.index&&groupEntry.index[key].index--})}}}function delGroupCache(groupID){var groupEntry=cache[groupID]||null;groupEntry&&delete cache[groupID]}settings=settings||{};settings.ttl=settings.ttl||0;settings.listTtl=settings.listTtl||settings.ttl||0;settings.groupIdField=required(settings.groupIdField,"groupIdField is required");settings.itemIdField=required(settings.itemIdField,"itemIdField is required");var cache={};this.clearCache=function clearCache(){cache={}};this.setGroupCache=setGroupCache;this.getGroupCache=getGroupCache;this.getItemCache=getItemCache;this.setItemCache=setItemCache;this.delItemCache=delItemCache;this.delGroupCache=delGroupCache}var CacheControl=require("./CacheControl");module.exports=IndexedGroupListCache},{"./CacheControl":109}],118:[function(require,module,exports){"use strict";function createItemIndexEntry(list,itemIndex){return{index:itemIndex,get item(){return list[this.index]}}}function createIndex(list,byField){var index={};list.forEach(function(item,itemIndex){index[ko.unwrap(item[byField])]=createItemIndexEntry(list,itemIndex)});return index}function required(val,msg){if(null===val||"undefined"==typeof val)throw new Error(msg||"Required parameter");return val}function defaultItemAdapter(oldItem,newItem){return newItem}function IndexedListCache(settings){function getItemCache(itemID){return cache.index[itemID]||null}function adaptItem(newItem){var oldItem=getItemCache(ko.unwrap(newItem[settings.itemIdField]));return settings.itemAdapter(oldItem,newItem)}function adaptList(list){return(list||[]).map(adaptItem)}function setList(list){cache.list(adaptList(list));cache.index=createIndex(cache.list(),settings.itemIdField);cache.control.latest=new Date;unused=!1}function setItemCache(item){var itemID=ko.unwrap(item[settings.itemIdField]),itemEntry=cache.index[itemID];if(itemEntry)cache.list()[itemEntry.index]=adaptItem(item);else{var itemIndex=cache.list.push(adaptItem(item))-1;cache.index[itemID]=createItemIndexEntry(cache.list(),itemIndex)}}function delItemCache(itemID){var itemEntry=cache.index[itemID];if(itemEntry){cache.list.splice(itemEntry.index,1);delete cache.index[itemID];Object.keys(cache.index).forEach(function(key){cache.index[key].index>itemEntry.index&&cache.index[key].index--})}}settings=settings||{};settings.ttl=settings.ttl||0;settings.listTtl=settings.listTtl||settings.ttl||0;settings.itemIdField=required(settings.itemIdField,"itemIdField is required");settings.itemAdapter="function"==typeof settings.itemAdapter?settings.itemAdapter:defaultItemAdapter;var unused=!0,cache={control:new CacheControl({ttl:settings.listTtl}),list:ko.observableArray([]),index:{}};this.clearCache=function clearCache(){cache.control.latest=null;cache.list([]);cache.index={};unused=!0};this.getItemCache=getItemCache;jsPropertiesTools.defineGetter(this,"control",function(){return cache.control});jsPropertiesTools.defineGetter(this,"list",function(){return cache.list});jsPropertiesTools.defineSetter(this,"list",function(list){return setList(list)});jsPropertiesTools.defineGetter(this,"index",function(){return cache.index});jsPropertiesTools.defineGetter(this,"unused",function(){return unused});this.setItemCache=setItemCache;this.delItemCache=delItemCache}var CacheControl=require("./CacheControl"),jsPropertiesTools=require("./jsPropertiesTools"),ko=require("knockout");module.exports=IndexedListCache},{"./CacheControl":109,"./jsPropertiesTools":137,knockout:!1}],119:[function(require,module,exports){"use strict";function required(val,msg){if(null===val||"undefined"==typeof val)throw new Error(msg||"Required parameter");return val}function ListRemoteModel(settings){function itemAdapter(oldItem,newItem){if(settings.Model){if(oldItem&&oldItem instanceof settings.Model){oldItem.model.updateWith(newItem);return oldItem}return new settings.Model(newItem)}return newItem}function notImplemented(){throw new Error("Not Implemented")}function getPlainCachedList(){var arr=cache.list();return arr.map(function(item){return item&&settings.Model&&item instanceof settings.Model?item.model.toPlainObject():item})}settings=settings||{};settings.listTtl=required(settings.listTtl,"listTtl is required");settings.itemIdField=required(settings.itemIdField,"itemIdField is required");settings.Model=settings.Model||null;this.settings=settings;this.state={isLoading:ko.observable(!1),isSyncing:ko.observable(!1),isSaving:ko.observable(!1),isDeleting:ko.observable(!1)};var cache=new IndexedListCache({listTtl:settings.listTtl,itemIdField:settings.itemIdField,itemAdapter:itemAdapter});this.clearCache=cache.clearCache;this.state.isLocked=ko.pureComputed(function(){return this.isLoading()||this.isSaving()||this.isDeleting()},this.state);this.fetchListFromLocal=notImplemented;this.fetchListFromRemote=notImplemented;this.pushListToLocal=notImplemented;this.pushListToRemote=notImplemented;this.removeItemFromRemote=notImplemented;var api=this;api.list=cache.list;api.sync=function sync(){return api.getList()};api.getList=function getList(){if(cache.request)return cache.request;if(cache.control.mustRevalidate()){if(cache.unused){api.state.isLoading(!0);cache.request=this.fetchListFromLocal().then(function(data){api.state.isSyncing(!0);var remotePromise=this.fetchListFromRemote().then(function(serverData){cache.list=serverData;this.pushListToLocal(serverData);api.state.isSyncing(!1);return serverData}.bind(this))["catch"](function(err){if(!data)throw err;api.state.isSyncing(!1);console.error("ListRemoteModel: remote synchronization failed",err)});return data?data:remotePromise}.bind(this)).then(function(data){data=data||[];cache.list=data;this.pushListToLocal(data);api.state.isLoading(!1);cache.request=null;return cache.list}.bind(this))["catch"](function(err){api.state.isLoading(!1);api.state.isSyncing(!1);cache.request=null;throw err});return cache.request}api.state.isSyncing(!0);cache.request=this.fetchListFromRemote().then(function(data){data=data||[];cache.list=data;this.pushListToLocal(data);api.state.isLoading(!1);api.state.isSyncing(!1);cache.request=null;return cache.list}.bind(this))["catch"](function(err){api.state.isLoading(!1);api.state.isSyncing(!1);cache.request=null;throw err});return cache.request}return Promise.resolve(cache.list)};api.getItem=function getItem(itemID){return api.getList().then(function(){var cacheItem=cache.getItemCache(itemID);if(!cacheItem){console.warn("ListRemoteModel Not found",itemID,settings.Model);throw new Error("Not Found")}return cacheItem.item})};api.getObservableItem=function getObservableItem(itemID){var firstValue=cache.getItemCache(itemID);firstValue=firstValue&&firstValue.item||void 0;var obs=ko.observable(firstValue);obs.sync=function syncObservableItem(){return api.getItem(itemID).then(function(itemModel){obs(itemModel)})};firstValue||obs.sync();return obs};api.createWildcardItem=function createWildcardItem(){var hasID=function(id){return null!==id&&"undefined"!=typeof id},obs=ko.observable(void 0),lastID;obs.sync=function syncObservableItem(itemID){var idChanged=hasID(itemID)&&itemID!==lastID;lastID=hasID(itemID)?itemID:lastID;if(idChanged){var cachedItem=cache.getItemCache(lastID);cachedItem&&cachedItem.item&&obs(cachedItem.item)}return api.getItem(lastID).then(function(itemModel){obs(itemModel);return itemModel})};obs.newItem=function newItem(defaults){obs(settings.Model?new settings.Model(defaults):defaults||{})};return obs};api.setItem=function setItem(data){api.state.isSaving(!0);return this.pushListToRemote(data).then(function(serverData){if(serverData){cache.setItemCache(serverData);this.pushListToLocal(getPlainCachedList())}api.state.isSaving(!1);return serverData}.bind(this))["catch"](function(err){api.state.isSaving(!1);throw err})};api.delItem=function delItem(itemID){api.state.isDeleting(!0);return this.removeItemFromRemote(itemID).then(function(removedData){cache.delItemCache(itemID);this.pushListToLocal(getPlainCachedList());api.state.isDeleting(!1);return removedData}.bind(this))["catch"](function(err){api.state.isDeleting(!1);throw err})};var ModelVersion=require("../utils/ModelVersion");api.createItemVersion=function createItemVersion(itemID){return api.getItem(itemID).then(function(model){return model?new ModelVersion(model):null})};api.newItem=function newItem(values){var version=new ModelVersion(new settings.Model(values));version.version.model.touch();return version}}var ko=require("knockout"),IndexedListCache=require("./IndexedListCache");module.exports=ListRemoteModel;ListRemoteModel.prototype.addLocalforageSupport=function addLocalforageSupport(baseName){var localforage=require("localforage");this.fetchListFromLocal=function fetchListFromLocal(){return localforage.getItem(baseName)};this.pushListToLocal=function pushListToLocal(data){return localforage.setItem(baseName,data)}};ListRemoteModel.prototype.addRestSupport=function addRestSupport(restClient,baseUrl){this.fetchListFromRemote=function fetchListFromRemote(){return restClient.get(baseUrl)};this.pushListToRemote=function pushListToRemote(data){var itemID=data[this.settings.itemIdField],method=itemID?"put":"post",url=baseUrl+(itemID?"/"+itemID:"");return restClient[method](url,data)};this.removeItemFromRemote=function removeItemFromRemote(itemID){return restClient["delete"](baseUrl+"/"+itemID)}};ListRemoteModel.prototype.addMockedRemote=function addMockedRemote(dataList){this.fetchListFromRemote=function fetchListFromRemote(){return Promise.resolve(dataList)};this.pushListToRemote=function pushListToRemote(data){return Promise.resolve(data)};this.removeItemFromRemote=function removeItemFromRemote(itemID){return Promise.resolve(itemID)}}},{"../utils/ModelVersion":120,"./IndexedListCache":118,knockout:!1,localforage:!1}],120:[function(require,module,exports){"use strict";function ModelVersion(original){EventEmitter.call(this);this.original=original;this.version=original.model.clone(null,!0);this.areDifferent=ko.pureComputed(function areDifferent(){return this.original.model.dataTimestamp()!==this.version.model.dataTimestamp()},this).extend({rateLimit:0});this.isNewer=ko.pureComputed(function isNewer(){return this.original.model.dataTimestamp()<this.version.model.dataTimestamp()},this).extend({rateLimit:0});this.isObsolete=ko.pureComputed(function isComputed(){return this.original.model.dataTimestamp()>this.version.model.dataTimestamp()},this).extend({rateLimit:0})}function createRollbackFunction(modelInstance){var backedData=modelInstance.model.toPlainObject(!0),backedTimestamp=modelInstance.model.dataTimestamp();return function rollback(){modelInstance.model.updateWith(backedData,!0);modelInstance.model.dataTimestamp(backedTimestamp)}}var ko=require("knockout"),EventEmitter=require("events").EventEmitter;module.exports=ModelVersion;ModelVersion._inherits(EventEmitter);ModelVersion.prototype.getRollback=function getRollback(from){if("version"===from)return createRollbackFunction(this.version);if("original"===from)return createRollbackFunction(this.original);throw new Error("from value not valid")};ModelVersion.prototype.pull=function pull(options){options=options||{};var result=!1,rollback=null;if(options.evenIfNewer||!this.isNewer()){rollback=createRollbackFunction(this.version);this.version.model.updateWith(this.original,!0);result=!0}this.emit("pull",result,rollback);return result};ModelVersion.prototype.push=function push(options){options=options||{};var result=!1,rollback=null;if(options.evenIfObsolete||!this.isObsolete()){rollback=createRollbackFunction(this.original);this.original.model.updateWith(this.version,!0);result=!0}this.emit("push",result,rollback);return result};ModelVersion.prototype.sync=function sync(){return this.isNewer()?this.push():this.isObsolete()?this.pull():!1}},{events:!1,knockout:!1}],121:[function(require,module,exports){"use strict";function PasswordValidator(password){var test=function(value){this.correctLength=rLength.test(value);this.correctSymbol=rSymbol.test(value);this.correctNumber=rNumber.test(value);this.correctUpper=rUpper.test(value);this.correctLower=rLower.test(value);this.correctCharacterKindsCount=this.correctSymbol+this.correctNumber+this.correctUpper+this.correctLower;this.correctCharacterKinds=this.correctCharacterKindsCount>=MIN_REQUIREMENTS}.bind(this);test(password||"")}var rLength=/.{8,}/,rSymbol=/[^\w\s]|_/,rNumber=/[0-9]/,rUpper=/[A-Z]/,rLower=/[a-z]/,MIN_REQUIREMENTS=3;PasswordValidator.prototype.isCorrectLength=function(){return this.correctLength};PasswordValidator.prototype.isCorrectSymbol=function(){return this.correctSymbol};PasswordValidator.prototype.isCorrectNumber=function(){return this.correctNumber};PasswordValidator.prototype.isCorrectUpper=function(){return this.correctUpper};PasswordValidator.prototype.isCorrectLower=function(){
return this.correctLower};PasswordValidator.prototype.getCorrectCharacterKindsCount=function(){return this.correctCharacterKindsCount};PasswordValidator.prototype.isCorrectCharacterKinds=function(){return this.correctCharacterKinds};PasswordValidator.prototype.isValid=function(){return this.isCorrectLength()&&this.isCorrectCharacterKinds()};module.exports=PasswordValidator},{}],122:[function(require,module,exports){"use strict";function RemoteModel(options){EventEmitter.call(this);options=options||{};var firstTimeLoad=!0;this.isLoading=ko.observable(!1);this.isSaving=ko.observable(!1);this.isSyncing=ko.observable(!1);this.isLocked=ko.pureComputed(function(){return this.isLoading()||this.isSaving()},this);if(!options.data)throw new Error("RemoteModel data must be set on constructor and no changed later");this.data=options.data;this.cache=new CacheControl({ttl:options.ttl});this.clearCache=function clearCache(){this.cache.latest=null;this.data.model.reset();firstTimeLoad=!0};this.localStorageName=options.localStorageName||null;this.getData=function getData(){this.load();return this.data};this.newVersion=function newVersion(){var v=new ModelVersion(this.data);this.isLoading.subscribe(function(isIt){isIt||v.pull({evenIfNewer:!0})});v.pushSave=function pushSave(){var rollback=v.getRollback("original");v.push({evenIfObsolete:!0});return this.save().then(function(){v.pull({evenIfNewer:!0})})["catch"](function(error){rollback();throw error})}.bind(this);return v};this.fetch=options.fetch||function fetch(){throw new Error("Not implemented")};this.push=options.push||function push(){throw new Error("Not implementd")};this.loadFromLocal=function loadFromLocal(){var data=this.data;return localforage.getItem(this.localStorageName).then(function(localData){localData&&data.model.updateWith(localData,!0);return localData})};var loadFromRemote=function loadFromRemote(){return this.fetch().then(function(serverData){if(!serverData)throw new Error('Remote model did not returned data, response must be a "Not Found"');this.data.model.updateWith(serverData,!0);this.localStorageName&&localforage.setItem(this.localStorageName,serverData);this.isLoading()?this.emit("loaded",serverData):this.emit("synced",serverData);this.isLoading(!1);this.isSyncing(!1);this.cache.latest=new Date;return this.data}.bind(this))["catch"](function(err){var wasLoad=this.isLoading();this.isLoading(!1);this.isSyncing(!1);var errPkg={task:wasLoad?"load":"sync",error:err};EventEmitter.listenerCount(this,"error")>0?this.emit("error",errPkg):console.error("RemoteModel Error",errPkg);throw err}.bind(this))}.bind(this);this.load=function load(options){options=options||{};if(options.forceRemoteUpdate||this.cache.mustRevalidate()){firstTimeLoad?this.isLoading(!0):this.isSyncing(!0);var promise=null;promise=!options.forceRemoteUpdate&&firstTimeLoad&&this.localStorageName?this.loadFromLocal().then(function(localData){if(localData){this.isLoading(!1);this.isSyncing(!1);loadFromRemote()["catch"](function(){});return this.data}return loadFromRemote()}.bind(this)):loadFromRemote();if(firstTimeLoad){firstTimeLoad=!1;return promise}promise["catch"](function(){});return Promise.resolve(this.data)}return Promise.resolve(this.data)};this.saveLocal=function(){return this.localStorageName?localforage.setItem(this.localStorageName,this.data.model.toPlainObject(!0)):Promise.resolve(null)};this.save=function save(){this.isSaving(!0);var ts=this.data.model.dataTimestamp();return this.push().then(function(serverData){this.data.model.updateWith(serverData,!0);this.data.model.dataTimestamp(ts);this.localStorageName&&localforage.setItem(this.localStorageName,serverData);this.emit("saved",serverData);this.isSaving(!1);this.cache.latest=new Date;return this.data}.bind(this))["catch"](function(err){this.isSaving(!1);var errPkg={task:"save",error:err};EventEmitter.listenerCount(this,"error")>0?this.emit("error",errPkg):console.error("RemoteModel Error",errPkg);throw err}.bind(this))};this.sync=function sync(options){this.load(options)["catch"](function(){})}}var ModelVersion=require("../utils/ModelVersion"),CacheControl=require("../utils/CacheControl"),ko=require("knockout"),localforage=require("localforage"),EventEmitter=require("events").EventEmitter;module.exports=RemoteModel;RemoteModel._inherits(EventEmitter)},{"../utils/CacheControl":109,"../utils/ModelVersion":120,events:!1,knockout:!1,localforage:!1}],123:[function(require,module,exports){"use strict";function lowerFirstLetter(n){return n&&n[0]&&n[0].toLowerCase&&n[0].toLowerCase()+n.slice(1)||n}function lowerCamelizeObject(obj){if(!obj||"object"!=typeof obj)return obj;var ret=Array.isArray(obj)?[]:{};for(var k in obj)if(obj.hasOwnProperty(k)){var newk=lowerFirstLetter(k);ret[newk]="object"==typeof obj[k]?lowerCamelizeObject(obj[k]):obj[k]}return ret}function Rest(optionsOrUrl){var url="string"==typeof optionsOrUrl?optionsOrUrl:optionsOrUrl&&optionsOrUrl.url;this.baseUrl=url;this.extraHeaders=null}var $=require("jquery");require("jquery.ajaxQueue");Rest.prototype.get=function get(apiUrl,data){return this.request(apiUrl,"get",data)};Rest.prototype.put=function get(apiUrl,data){return this.request(apiUrl,"put",data)};Rest.prototype.post=function get(apiUrl,data){return this.request(apiUrl,"post",data)};Rest.prototype["delete"]=function get(apiUrl,data){return this.request(apiUrl,"delete",data)};Rest.prototype.putFile=function putFile(apiUrl,data){return this.request(apiUrl,"delete",data,"multipart/form-data")};Rest.prototype.request=function request(apiUrl,httpMethod,data,contentType){var thisRest=this,url=this.baseUrl+apiUrl,xhr=$.ajaxQueue({url:url,cache:!1,dataType:"json",method:httpMethod,headers:this.extraHeaders,data:data&&JSON.parse(JSON.stringify(data)),contentType:contentType||"application/x-www-form-urlencoded"}),promiseXhr=Promise.resolve(xhr).then(lowerCamelizeObject)["catch"](function(err){if(401===err.status){var retry=request.bind(this,apiUrl,httpMethod,data,contentType),retryPromise=thisRest.onAuthorizationRequired(retry);if(retryPromise)return Promise.resolve(retryPromise)["catch"](function(){throw err})}throw err});promiseXhr.xhr=xhr;return promiseXhr};Rest.prototype.onAuthorizationRequired=function onAuthorizationRequired(){};module.exports=Rest},{}],124:[function(require,module,exports){function Time(date,hour,minute,second){if(!(date instanceof Date)){second=minute;minute=hour;hour=date;date=new Date}return new Date(date.getFullYear(),date.getMonth(),date.getDate(),hour||0,minute||0,second||0)}module.exports=Time},{}],125:[function(require,module,exports){"use strict";var Appointment=require("../models/Appointment"),moment=require("moment-timezone");exports.sortAppointments=function(a,b){var as=a.startTime(),ae=a.endTime(),bs=b.startTime(),be=b.endTime();if(null===as)return-1;if(null===bs)return 1;var eq=as.toISOString()===bs.toISOString();return eq?null===ae?-1:null===be?1:ae-be:as-bs};exports.fillPreparationTimeSlots=function fillPreparationTimeSlots(date,slots,preparationHours){if(0!==preparationHours){var prevEnd=date;slots.forEach(function(slot,index){if(slot.id()>0&&slot.sourceBooking()){var end=slot.startTime(),start=moment(end).subtract(preparationHours,"hours").toDate();if(end>prevEnd){start=prevEnd>start?prevEnd:start;slots.splice(index,0,Appointment.newPreparationTimeSlot({start:start,end:end}))}}prevEnd=slot.endTime()})}};exports.fillDayAvailability=function fillDayAvailability(date,appointmentsList,freeScheduleSlots,schedulingPreferences){var slots=appointmentsList.slice(0);slots.sort(exports.sortAppointments);exports.fillPreparationTimeSlots(date,slots,schedulingPreferences.betweenTime());var filledSlots=[],zeroTime="00:00:00",last=zeroTime,lastDateTime=null,timeFormat="HH:mm:ss";if(0===slots.length){var fullStart=moment(date).startOf("day"),fullEnd=fullStart.clone().add(1,"days");filledSlots=exports.createScheduleSlots({start:fullStart.toDate(),end:fullEnd.toDate()},freeScheduleSlots)}else{slots.forEach(function(slot){var start=slot.startTime(),s=moment(start),end=slot.endTime(),e=moment(end);if(s.format(timeFormat)>last){null===lastDateTime&&(lastDateTime=new Date(start.getFullYear(),start.getMonth(),start.getDate(),0,0,0));filledSlots.push.apply(filledSlots,exports.createScheduleSlots({start:lastDateTime,end:start},freeScheduleSlots))}filledSlots.push(slot);lastDateTime=end;last=e.format(timeFormat)});var lastEnd=lastDateTime&&moment(lastDateTime).format(timeFormat);if(lastEnd!==zeroTime){var nextMidnight=new Date(lastDateTime.getFullYear(),lastDateTime.getMonth(),lastDateTime.getDate()+1,0,0,0);filledSlots.push.apply(filledSlots,exports.createScheduleSlots({start:lastDateTime,end:nextMidnight},freeScheduleSlots))}}return filledSlots};exports.createScheduleSlots=function createScheduleSlots(range,freeScheduleSlots){if(freeScheduleSlots.length){var lists=freeScheduleSlots.map(function(freeRange){return exports.createScheduleSlotsForRanges(range.start,range.end,freeRange.start,freeRange.end)}),l=lists.reduce(function(l,nl){return l.concat.apply(l,nl)},[]);return l}return exports.createScheduleSlotsForRanges(range.start,range.end,range.start,range.start)};exports.createScheduleSlotsForRanges=function createScheduleSlotsForRanges(start,end,from,to){var list=[],beforeSchedule=from>start&&from>=end,afterSchedule=end>to&&start>=to,insideSchedule=start>=from&&to>=end;if(beforeSchedule||afterSchedule)list.push(Appointment.newUnavailableSlot({start:start,end:end}));else if(insideSchedule)list.push(Appointment.newFreeSlot({start:start,end:end}));else{var crossStart=from>start&&end>from,crossEnd=to>start&&end>to;crossStart&&list.push(Appointment.newUnavailableSlot({start:start,end:from}));crossEnd&&list.push(Appointment.newUnavailableSlot({start:to,end:end}));crossStart&&crossEnd?list.push(Appointment.newFreeSlot({start:from,end:to})):crossStart?list.push(Appointment.newFreeSlot({start:from,end:end})):crossEnd&&list.push(Appointment.newFreeSlot({start:start,end:to}))}return list.sort(exports.sortAppointments)};var timeZoneList=require("./timeZoneList");exports.createFreeScheduleSlots=function(date,weeklySchedule){var scheduleTimeZone=weeklySchedule.timeZone();scheduleTimeZone||(scheduleTimeZone=timeZoneList.getLocalTimeZone());var localStart=moment(date).startOf("day"),localEnd=moment(date).endOf("day"),tzStart=localStart.clone().tz(scheduleTimeZone),tzEnd=localEnd.clone().tz(scheduleTimeZone),computeScheduleHoursAsLocal=function(weekDaySchedule,tzDateMoment){return weekDaySchedule.map(function(range){return{start:tzDateMoment.clone().startOf("day").add(moment.duration(range.start())).toDate(),end:tzDateMoment.clone().startOf("day").add(moment.duration(range.end())).toDate()}})},weekDayStart=tzStart.day(),schedule=weeklySchedule.weekDays[weekDayStart](),locals=computeScheduleHoursAsLocal(schedule,tzStart),weekDayEnd=tzEnd.day();if(weekDayStart!==weekDayEnd){schedule=weeklySchedule.weekDays[weekDayEnd]();locals=locals.concat(computeScheduleHoursAsLocal(schedule,tzEnd))}var f=[];locals.forEach(function(range){range.end<=localStart||range.start>=localEnd||f.push({start:new Date(Math.max(localStart,range.start)),end:new Date(Math.min(localEnd,range.end))})});return f}},{"../models/Appointment":50,"./timeZoneList":142,"moment-timezone":!1}],126:[function(require,module,exports){"use strict";function createHelpers(ko){var helpers={};helpers.popover={update:function(element,valueAccessor){var srcOptions=ko.unwrap(valueAccessor()),options=$.extend(!0,{},srcOptions);options.content=ko.unwrap(srcOptions.content);if(options.content){options.content=exports.i18n&&exports.i18n.t(options.content)||options.content;$(element).popover("destroy").popover(options);$(element).is(":focus")&&$(element).popover("show")}else $(element).popover("destroy")}};return helpers}function plugIn(ko,prefix){var name,helpers=createHelpers(ko);for(var h in helpers)if(!helpers.hasOwnProperty||helpers.hasOwnProperty(h)){name=prefix?prefix+h[0].toUpperCase()+h.slice(1):h;ko.bindingHandlers[name]=helpers[h]}}var $=require("jquery");exports.i18n=null;exports.plugIn=plugIn;exports.createBindingHelpers=createHelpers},{}],127:[function(require,module,exports){"use strict";var moment=require("moment");exports.forRange=function forRange(from,to,size,duration,roundUp,includeEndTime){from=new Date(from);to=new Date(to);if(!duration)throw new Error("forRange: Duration is required");var i=moment(from),d,slots=[],now=new Date,enought;if(roundUp){var r=moment(from),minutes=r.minutes(),rest=minutes%size;rest&&(minutes=minutes-rest+size);from=r.minutes(minutes).seconds(0).toDate();i=r}includeEndTime&&(to=moment(to).add(size,"minutes").toDate());if(from>=to)return slots;for(;i.toDate()<to;){d=i.clone().toDate();enought=i.clone().add(duration,"minutes").toDate();d>=now&&to>=enought&&slots.push(d);i.add(size,"minutes")}return slots};exports.forList=function forList(list,size,duration,roundUp,includeEndTime){var slots=[];list.forEach(function(item){"free"===item.availability&&slots.push.apply(slots,exports.forRange(item.startTime,item.endTime,size,duration,roundUp,includeEndTime))});return slots};exports.getTotalFreeMinutes=function getTotalFreeMinutes(list){return list.reduce(function(count,item){if("free"===item.availability){var s=moment(item.startTime),e=moment(item.endTime);return count+e.diff(s,"minutes")}return count},0)};exports.getAvailabilityTag=function(list){if(!list||0===list.length)return"none";var minutes=exports.getTotalFreeMinutes(list),perc=minutes/480*100,date=moment(list[0].startTime).startOf("day").toDate(),today=moment().startOf("day").toDate();return today>date?"past":perc>=100?"full":perc>=50?"medium":perc>0?"low":"none"};exports.filterListBy=function filterListBy(list,start,end){var nstart=new Date(start),nend=new Date(end),result=[];list.some(function(timeRange){var ts=new Date(timeRange.startTime),te=new Date(timeRange.endTime);if(ts>=nend)return!0;te>nstart&&(nstart>ts?result.push({startTime:nstart.toISOString(),endTime:(te>nend?nend:te).toISOString(),availability:timeRange.availability}):te>nend?result.push({startTime:ts.toISOString(),endTime:nend.toISOString(),availability:timeRange.availability}):result.push(timeRange));return void 0});return result};exports.splitListInLocalDates=function filterListBy(list){var isodateFormat="YYYY-MM-DD",lastIsodate,group,result={};list.forEach(function(timeRange){var start=moment(timeRange.startTime),isostart=start.format(isodateFormat);if(isostart!==lastIsodate){group=result[isostart]=[];lastIsodate=isostart}var end=moment(timeRange.endTime),endJustDate=end.startOf("day"),isoend=end.format(isodateFormat),nextDayStart=start.clone().startOf("day").add(1,"day");if(isostart!==isoend&&end.format()!==nextDayStart.format()){group.push({startTime:start.format(),endTime:nextDayStart.format(),availability:timeRange.availability});for(var idate=nextDayStart.clone();endJustDate>idate;){var idateIso=idate.format(isodateFormat),idatetimeIso=idate.format();idate.add(1,"day");result[idateIso]=[{startTime:idatetimeIso,endTime:idate.format(),availability:timeRange.availability}]}result[idate.format(isodateFormat)]=[{startTime:idate.format(),endTime:end.format(),availability:timeRange.availability}]}else group.push(timeRange)});return result}},{moment:!1}],128:[function(require,module,exports){"use strict";var $=require("jquery"),moment=require("moment"),createTimeSlots=require("./createTimeSlots");exports.create=function createDatepickerAvailability(app,$datepicker,isLoading){var daysElements=$datepicker.datepicker("getDaysElements"),prevMonth=null,prevUserID=null;app.model.availability.on("clearCache",function(){prevMonth=null});var tagAvailability=function tagAvailability(date,userID,refresh){var month=date.getMonth();if(userID&&(month!==prevMonth||prevUserID!==userID||refresh)){prevMonth=month;prevUserID=userID;var start=moment(date).clone().startOf("month").startOf("week"),end=start.clone().add(6,"weeks");isLoading&&isLoading(!0);app.model.availability.times(userID,start,end).then(function(result){if(month===$datepicker.datepicker("getViewDate").getMonth()){var byDate=createTimeSlots.splitListInLocalDates(result.times);daysElements.each(function(){var $dateTd=$(this),id=$dateTd.data("date-time"),timeRangeList=byDate[moment(id).format("YYYY-MM-DD")];if(id&&timeRangeList){var cellClass=$dateTd.attr("class").replace(/(^|\s)tag-[^\s]+/,""),cls="";switch(createTimeSlots.getAvailabilityTag(timeRangeList)){case"past":cls="tag-muted";break;case"full":cls="tag-blank";break;case"medium":cls="tag-dark";break;case"low":cls="tag-warning";break;case"none":cls="tag-danger"}$dateTd.attr("class",cellClass+" "+cls)}})}})["catch"](function(err){app.modals.showError({title:"Error loading availability",error:err})}.bind(this)).then(function(){isLoading&&isLoading(!1)}.bind(this))}};$datepicker.on("viewDateChanged",function(e,d){"days"===d.viewMode&&tagAvailability(d.viewDate,prevUserID)});return tagAvailability}},{"./createTimeSlots":127,moment:!1}],129:[function(require,module,exports){"use strict";var moment=require("moment");module.exports=function duration2Language(duration){duration=moment.duration(duration);var y=duration.years(),d=duration.days(),h=duration.hours(),m=duration.minutes(),s=duration.seconds(),l=duration.milliseconds(),parts=[];1===y?parts.push("a year"):y&&parts.push(y+" years");1===d?parts.push("a day"):d&&parts.push(d+" days");1===h?parts.push("an hour"):h&&parts.push(h+" hours");1===m?parts.push("a minute"):m&&parts.push(m+" minutes");1===s?parts.push("a second"):s&&parts.push(s+" seconds");1===l?parts.push("a millisecond"):l&&parts.push(l+" milliseconds");return parts.join(", ")}},{moment:!1}],130:[function(require,module,exports){"use strict";var loader=require("./loader"),$=require("jquery"),ko=require("knockout"),settings={language:"en-US",appId:null},apiStatus={ready:ko.observable(!!window.FB),loading:!1,stack:[]};exports.load=function(){if(!apiStatus.loading){apiStatus.loading=!0;settings.language=$("[data-facebook-language]").data("facebook-language");settings.appId=$("[data-facebook-appid]").data("facebook-appid");loader.load({scripts:["//connect.facebook.net/"+settings.language+"/all.js"],completeVerification:function(){return!!window.FB},complete:function(){window.FB.init({appId:settings.appId,status:!0,cookie:!0,xfbml:!1,version:"v2.8"});apiStatus.ready(!0);apiStatus.loading=!1;for(var i=0;i<apiStatus.stack.length;i++)try{apiStatus.stack[i](window.FB)}catch(e){console&&console.error&&console.error(e)}}})}};exports.isReady=ko.pureComputed(function(){return apiStatus.ready()});exports.ready=function facebookReady(readyCallback){if(apiStatus.ready())"function"==typeof readyCallback&&readyCallback(window.FB);else{apiStatus.stack.push(readyCallback);exports.load()}};exports.login=function facebookLogin(options){return new Promise(function(success,error){exports.ready(function(FB){FB.login(function(response){response.authResponse?success({authResponse:response.authResponse,FB:FB,response:response}):error({response:response,FB:FB})},options)})})}},{"./loader":138,knockout:!1}],131:[function(require,module,exports){"use strict";module.exports=function getDateWithoutTime(date){date?date instanceof Date||(date=new Date(date)):date=new Date;return new Date(date.getFullYear(),date.getMonth(),date.getDate(),0,0,0)}},{}],132:[function(require,module,exports){"use strict";var ko=require("knockout");module.exports=function getObservable(obsOrValue){return"function"==typeof obsOrValue?obsOrValue:ko.observable(obsOrValue)}},{knockout:!1}],133:[function(require,module,exports){"user strict";module.exports=function getUrlQuery(url){url=url||window.location.href;var vars=[],hash,queryIndex=url.indexOf("?");if(queryIndex>-1)for(var hashes=url.slice(queryIndex+1).split("&"),i=0;i<hashes.length;i++){hash=hashes[i].split("=");vars.push(hash[0]);vars[hash[0]]=decodeURIComponent(hash[1])}return vars}},{}],134:[function(require,module,exports){var loader=require("./loader"),stack=[],googleMapReady=module.exports=function googleMapReady(ready){stack.push(ready);if(googleMapReady.isReady)ready(google);else if(!googleMapReady.isLoading){googleMapReady.isLoading=!0;loader.load({scripts:["https://www.google.com/jsapi"],completeVerification:function(){return!!window.google},complete:function(){google.load("maps","3.23",{other_params:"libraries=places",callback:function(){googleMapReady.isReady=!0;googleMapReady.isLoading=!1;for(var i=0;i<stack.length;i++)try{stack[i](google)}catch(e){}}})}})}};googleMapReady.refreshMap=function refreshMaps(map){googleMapReady(function(){var center=map.getCenter();google.maps.event.addListenerOnce(map,"resize",function(){center&&map.setCenter(center)});google.maps.event.trigger(map,"resize")})}},{"./loader":138}],135:[function(require,module,exports){var i18n={};i18n.distanceUnits={ES:"km",US:"miles"};i18n.numericMilesSeparator={"es-ES":".","es-US":".","en-US":",","en-ES":","};i18n.numericDecimalSeparator={"es-ES":",","es-US":",","en-US":".","en-ES":"."};i18n.moneySymbolPrefix={ES:"",US:"$"};i18n.moneySymbolSufix={ES:"",US:""};i18n.getCurrentCulture=function getCurrentCulture(){var c=document.documentElement.getAttribute("data-culture"),s=c.split("-");return{culture:c,language:s[0],country:s[1]}};i18n.convertMilesKm=function convertMilesKm(q,unit){var MILES_TO_KM=1.609;if("miles"==unit)return MILES_TO_KM*q;if("km"==unit)return q/MILES_TO_KM;console&&console.log&&console.log("convertMilesKm: Unrecognized unit "+unit);return 0};"undefined"!=typeof module&&module.exports&&(module.exports=i18n)},{}],136:[function(require,module,exports){"use strict";var $=require("jquery");$.fn.multiline=function(text){this.text(text);this.html(this.html().replace(/\n/g,"<br/>"));return this}},{}],137:[function(require,module,exports){"use strict";function accessorDescriptor(field,fun){var desc={enumerable:!0,configurable:!0};desc[field]=fun;return desc}function defineGetter(obj,prop,get){if(Object.defineProperty)return Object.defineProperty(obj,prop,accessorDescriptor("get",get));if(Object.prototype.__defineGetter__)return obj.__defineGetter__(prop,get);throw new Error("browser does not support getters")}function defineSetter(obj,prop,set){if(Object.defineProperty)return Object.defineProperty(obj,prop,accessorDescriptor("set",set));if(Object.prototype.__defineSetter__)return obj.__defineSetter__(prop,set);throw new Error("browser does not support setters")}module.exports={defineGetter:defineGetter,defineSetter:defineSetter}},{}],138:[function(require,module,exports){"use strict";function promiseTimeout(milliseconds){return new Promise(function(resolve){setTimeout(function(){resolve()},milliseconds)})}var $=require("jquery");exports.load=function(opts){function performComplete(){if("function"!=typeof opts.completeVerification||opts.completeVerification()){opts.complete();return Promise.resolve()}console&&console.warn&&console.warn("LC.load.completeVerification failed for "+opts.scripts[0]+" retrying it in "+opts.trialsInterval+"ms");return promiseTimeout(opts.trialsInterval).then(performComplete)}function load(){return Promise.all(opts.scripts.map(function(sc){return $.getScript(sc)})).then(opts.complete?performComplete:null)}opts=$.extend(!0,{scripts:[],complete:null,completeVerification:null,loadDelay:0,trialsInterval:500},opts);return opts.scripts.length?opts.loadDelay?promiseTimeout(opts.loadDelay).then(load):load():Promise.resolve()}},{}],139:[function(require,module,exports){"use strict";function takePhotoSupported(){return navigator.camera&&navigator.camera.getPicture}function getPreviewPhotoUrl(url){if(!url)return null;var iFile=url.indexOf("file://");if(userAgentFlags.isWkWebview&&0===window.location.protocol.indexOf("http")&&0===iFile){var m=/\/Application\/[^\/]+(.+)$/.exec(url);return m&&2===m.length?m[1]:url.substr(iFile)}return url}function cameraGetPicture(settings){return new Promise(function(resolve,reject){navigator.camera.getPicture(resolve,reject,extend(!0,{},defaultPhotoSettings,settings))})}function moveLocalPhoto(uri,destFolder,destName){return new Promise(function(resolve,reject){var onTempEntry=function(entry){var d=new Date,n=d.getTime(),newFileName=(destName||n)+".jpg";window.requestFileSystem(window.LocalFileSystem.PERSISTENT,0,function(fileSys){fileSys.root.getDirectory(destFolder,{create:!0},function(directory){entry.moveTo(directory,newFileName,function(new_entry){var path=new_entry.fullPath,url=new_entry.toURL();resolve({path:path,url:url})},reject)},reject)},reject)};window.resolveLocalFileSystemURI(uri,onTempEntry,reject)})}function uploadLocalFile(localFileUri,remoteUri,options){return new Promise(function(resolve,reject){remoteUri=encodeURI(remoteUri);var fuopts=new FileUploadOptions;Object.keys(options).forEach(function(option){fuopts[option]=options[option]});fuopts.fileKey||(fuopts.fileKey="file");fuopts.fileName||(fuopts.fileName=localFileUri.substr(localFileUri.lastIndexOf("/")+1));fuopts.mimeType||(fuopts.mimeType="image/jpeg");fuopts.headers=fuopts.headers||{};fuopts.headers.Connection="close";var ft=new FileTransfer;ft.upload(localFileUri,remoteUri,resolve,reject,fuopts)})}var extend=require("jquery").extend,userAgentFlags=require("./userAgentFlags")(),defaultPhotoSettings={destinationType:window.Camera&&window.Camera.DestinationType.FILE_URI,quality:78,mediaType:window.Camera&&window.Camera.MediaType.PICTURE,saveToPhotoAlbum:!1};exports.defaultPhotoSettings=defaultPhotoSettings;exports.takePhotoSupported=takePhotoSupported;exports.getPreviewPhotoUrl=getPreviewPhotoUrl;exports.cameraGetPicture=cameraGetPicture;exports.moveLocalPhoto=moveLocalPhoto;exports.uploadLocalFile=uploadLocalFile;exports.uploadLocalFileJson=function(localFileUri,remoteUri,options){return uploadLocalFile(localFileUri,remoteUri,options).then(function(data){if(data&&data.response&&"string"==typeof data.response)try{return JSON.parse(data.response)}catch(ex){}return null})}},{"./userAgentFlags":143}],140:[function(require,module,exports){"use strict";var $=require("jquery");module.exports=function scrollToElement(el,options){el=el instanceof $?el:$(el);var parent=$(el).parent(),topOffset=options&&options.topOffset||0,animation=options&&options.animation,atRoot=!1;do{if(!parent||!parent.length)return;atRoot=parent.is("html,body");var relativeTop=el.offset().top,elementTop=relativeTop-topOffset;if(atRoot)animation?$("html,body").stop().animate({scrollTop:elementTop},animation):window.scroll(0,elementTop);else{var scrollingTop=elementTop+parent.scrollTop()-parent.offset().top;animation?parent.stop().animate({scrollTop:scrollingTop},animation):parent.scrollTop(scrollingTop)}parent=parent.parent()}while(!atRoot)}},{}],141:[function(require,module,exports){"use strict";module.exports=function slug(str){str=str.replace(/^\s+|\s+$/g,"");str=str.toLowerCase();for(var from="/_,:;'",to="aaaaaeeeeeiiiiooooouuuunc-------",i=0,l=from.length;l>i;i++)str=str.replace(new RegExp(from.charAt(i),"g"),to.charAt(i));str=str.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-");return str}},{}],142:[function(require,module,exports){"use strict";function displayTimeZone(tzid,zone,instantMoment,ts){return"UTC"+instantMoment.tz(tzid).format("Z")+" "+tzid+" ("+zone.abbr(ts)+")"}var moment=require("moment-timezone");exports.getLocalTimeZone=function(){return moment.tz.guess()};exports.timeZoneToDisplayFormat=function(tzid,instant){instant=instant?moment(instant).clone():moment().startOf("year");var zone=moment.tz.zone(tzid),ts=instant.valueOf();return displayTimeZone(tzid,zone,instant,ts)};var createDisplayList=function(tzList,m,ts){return tzList.map(function(tzid){var z=moment.tz.zone(tzid);return{id:tzid,offset:z.offset(ts),label:displayTimeZone(tzid,z,m,ts)}}).sort(function(a,b){return a.offset!==b.offset?a.offset>b.offset?-1:1:a.id>b.id?1:-1})};exports.getFullList=function(){var m=moment().startOf("year"),ts=m.valueOf(),list=moment.tz.names();return createDisplayList(list,m,ts)};exports.getUserList=function getUserList(){var m=moment().startOf("year"),ts=m.valueOf(),list=moment.tz.names().filter(function(z){return-1!==z.indexOf("/")&&moment.tz.zone(z).population});return createDisplayList(list,m,ts)};exports.getUsZones=function getUsZones(){var m=moment().startOf("year"),ts=m.valueOf(),list=moment.tz.names().filter(function(z){return 0===z.indexOf("US/")});return createDisplayList(list,m,ts)};exports.getTopUsZones=function getTopUsZones(){return[{id:"US/Hawaii",label:"UTC-10:00 Hawaii Time (HST)"},{id:"US/Alaska",label:"UTC-09:00 Alaska Time (AKST)"},{id:"US/Pacific",label:"UTC-08:00 Pacific Time (PST)"},{id:"US/Arizona",label:"UTC-07:00 Arizona Time (MST)"},{id:"US/Mountain",label:"UTC-07:00 Mountain Time (MST)"},{id:"US/Central",label:"UTC-06:00 Central Time (CST)"},{id:"US/East-Indiana",label:"UTC-05:00 Indiana (East) Time (EST)"},{id:"US/Eastern",label:"UTC-05:00 Eastern Time (EST)"}]};var usAliasesInverted={"America/New_York":"US/Eastern","America/Detroit":"US/Michigan","America/Kentucky/Louisville":"US/Eastern","America/Kentucky/Monticello":"US/Eastern","America/Indiana/Indianapolis":"US/East-Indiana","America/Indiana/Vincennes":"US/East-Indiana","America/Indiana/Winamac":"US/East-Indiana","America/Indiana/Marengo":"US/East-Indiana","America/Indiana/Petersburg":"US/East-Indiana","America/Indiana/Vevay":"US/East-Indiana","America/Chicago":"US/Central","America/Indiana/Tell_City":"US/Indiana-Starke","America/Indiana/Knox":"US/Indiana-Starke","America/Menominee":"US/Central","America/North_Dakota/Center":"US/Central","America/North_Dakota/New_Salem":"US/Central","America/North_Dakota/Beulah":"US/Central","America/Denver":"US/Mountain","America/Boise":"US/Mountain","America/Phoenix":"US/Arizona","America/Los_Angeles":"US/Pacific","America/Anchorage":"US/Alaska","America/Juneau":"US/Alaska","America/Sitka":"US/Alaska","America/Metlakatla":"US/Alaska","America/Yakutat":"US/Alaska","America/Nome":"US/Alaska","America/Adak":"US/Aleutian","Pacific/Honolulu":"US/Hawaii","Pacific/Pago_Pago":"US/Samoa"};exports.getUsAliasWhenPossible=function(tzid){return usAliasesInverted.hasOwnProperty(tzid)?usAliasesInverted[tzid]:tzid}},{"moment-timezone":!1}],143:[function(require,module,exports){"use strict";module.exports=function getFlags(){if(window.navigator&&window.navigator.userAgent){var ua=window.navigator.userAgent,iOsWebview=/iOS|iPad|iPhone|iPod/.test(ua),iOsVersion=/OS ((\d+_?){2,3})\s/.exec(ua);if(iOsVersion&&iOsVersion.length>1){iOsVersion={full:iOsVersion[1]||""};iOsVersion.parts=iOsVersion.full.split("_");iOsVersion.major=0|iOsVersion.parts[0];iOsVersion.minor=0|iOsVersion.parts[1];iOsVersion.revision=0|iOsVersion.parts[2]}var isWkWebview=!!(iOsWebview&&window.cordova&&window.indexedDB),isAndroid=/Android/.test(ua),isChrome=/Chrome\//.test(ua),isMobile=iOsWebview||isAndroid;return{isIos:iOsWebview,iOsVersion:iOsVersion,isWkWebview:isWkWebview,isAndroid:isAndroid,isChrome:isChrome,isMobile:isMobile}}return{}}},{}],144:[function(require,module,exports){function AppointmentCardViewModel(params){EventEmitter.call(this);this.sourceItem=getObservable(params.sourceItem);var app=this.app=ko.unwrap(params.app);this.editMode=getObservable(params.editMode);this.editedVersion=ko.observable(null);this.isSaving=ko.observable(!1);this.isLoading=getObservable(params.isLoading);this.item=ko.observable(AppointmentView(this.sourceItem(),app));this.allowBookUnavailableTime=ko.observable(!1);this.specialAppointmentIds=Appointment.specialIds;this.currentID=ko.pureComputed(function(){var it=this.item();return it&&it.id()||0},this);this.currentDatetime=ko.pureComputed(function(){return this.item()&&this.item().startTime()||new Date},this);this.currentDate=ko.pureComputed(function(){return getDateWithoutTime(this.item()&&this.item().startTime())},this);this.isNew=ko.pureComputed(function(){var id=this.currentID();return id===Appointment.specialIds.newBooking||id===Appointment.specialIds.newEvent},this);this.isBooking=ko.pureComputed(function(){return this.item()&&this.item().sourceBooking();
},this);this.isEvent=ko.pureComputed(function(){return this.item()&&this.item().sourceEvent()&&!this.item().sourceBooking()},this);this.isReadOnlyEvent=ko.pureComputed(function(){return this.isEvent()?this.item().sourceEvent().readOnly():!1},this);this.isLocked=ko.pureComputed(function(){return this.isReadOnlyEvent()||this.isSaving()||this.isLoading()},this);this.headerClass=ko.pureComputed(function(){return this.isBooking()?this.editMode()?"Card-title--warning":"Card-title--primary":this.isEvent()?"Card-title--danger":""},this);this.newAppointmentVisible=ko.pureComputed(function(){var id=this.currentID();return id===Appointment.specialIds.free||id===Appointment.specialIds.emptyDate||id===Appointment.specialIds.unavailable},this);this.editScheduleVisible=ko.pureComputed(function(){return this.currentID()===Appointment.specialIds.unavailable},this);this.submitText=ko.pureComputed(function(){var v=this.editedVersion();return this.isLoading()?"Loading...":this.isSaving()?"Saving changes":v&&v.areDifferent()?this.isNew()&&this.isBooking()?"Book":"Save changes":"Saved"},this);this.sourceItem.subscribe(function(sourceItem){this.item(AppointmentView(sourceItem,app));this.editedVersion(null);this.editMode(!1);this.isNew()&&this.editMode(!0)},this);this.editMode.subscribe(function(isEdit){if(!(this.currentID()<=0)||this.isNew())if(isEdit){var version=new ModelVersion(this.sourceItem());version.version.sourceEvent(this.sourceItem().sourceEvent());version.version.sourceBooking(this.sourceItem().sourceBooking());this.editedVersion(version);this.item(AppointmentView(version.version,app));if(this.isNew()&&this.isEvent()){this.item().sourceEvent().availabilityTypeID(0);this.item().isAllDay(!1);this.item().sourceEvent().eventTypeID(3);this.item().summary("")}}else this.item(AppointmentView(this.sourceItem(),app))},this);this.edit=function edit(){this.isLocked()||this.editMode(!0)}.bind(this);var afterSave=function afterSave(savedApt){var version=this.editedVersion();version.original.model.updateWith(savedApt,!0);version.pull({evenIfNewer:!0});this.editMode(!1);if(this.isBooking()&&this.item().client()){var msg=this.item().client().firstName()+" will receive an e-mail confirmation.";app.modals.showNotification({title:"Confirmed!",message:msg})}}.bind(this);this.save=function save(){if(!this.isLocked()){var version=this.editedVersion();if(version&&version.areDifferent()){this.isSaving(!0);app.model.calendar.setAppointment(version.version,this.allowBookUnavailableTime()).then(afterSave)["catch"](function(err){app.modals.showError({title:"There was an error saving the data.",error:err})}).then(function(){this.isSaving(!1)}.bind(this))}}}.bind(this);this.cancel=function cancel(){if(!this.isLocked()){this.editedVersion()&&this.editedVersion().pull({evenIfNewer:!0});this.editMode(!1)}}.bind(this);this.confirmCancel=function confirmCancel(){var v=this.editedVersion();v&&v.areDifferent()?this.app.modals.confirm({title:"Cancel",message:"Are you sure?",yes:"Yes",no:"No"}).then(function(){this.cancel()}.bind(this)):this.cancel()}.bind(this);this.deleteEvent=function(){};this.bookingID=ko.pureComputed(function(){return this.item()&&this.item().sourceBooking()&&this.item().sourceBooking().bookingID()},this);this.bookingCanBeCancelledByServiceProfessional=ko.computed(function(){var b=this.item()&&this.item().sourceBooking();return b?b.canBeCancelledByServiceProfessional():!1},this);this.bookingCanBeDeclinedByServiceProfessional=ko.computed(function(){var b=this.item()&&this.item().sourceBooking();return b?b.canBeDeclinedByServiceProfessional():!1},this);this.isBookingRequest=ko.pureComputed(function(){var b=this.item()&&this.item().sourceBooking();return b?b.isRequest():!1},this);this.isServiceProfessionalBooking=ko.pureComputed(function(){var b=this.item()&&this.item().sourceBooking();return b?b.isServiceProfessionalBooking():!1},this);this.canChangePricing=ko.pureComputed(function(){if(this.isNew())return!0;var b=this.item()&&this.item().sourceBooking();if(b){var bt=b.bookingTypeID();return bt===Booking.type.serviceProfessionalBooking||bt===Booking.type.bookNowBooking&&!b.paymentCollected}return!1},this);var afterSaveBooking=function(booking,saveEvent){var version=this.editedVersion();if(version){version.original.sourceBooking(booking);version.pull({evenIfNewer:!0});this.editMode(!1)}else this.sourceItem().sourceBooking(booking);var msg=this.item().client().firstName()+" will receive an e-mail confirmation.";app.modals.showNotification({title:"Done!",message:msg}).then(function(){this.emit(saveEvent,this.sourceItem())}.bind(this))}.bind(this);this.cancelBookingByServiceProfessional=function(){if(this.bookingCanBeCancelledByServiceProfessional()){this.isSaving(!0);app.model.bookings.cancelBookingByServiceProfessional(this.bookingID()).then(function(booking){afterSaveBooking(booking,events.cancelled)})["catch"](function(err){app.modals.showError({title:"There was an error saving the data.",error:err})}).then(function(){this.isSaving(!1)}.bind(this))}};this.declineBookingByServiceProfessional=function(){if(this.isBookingRequest()){this.isSaving(!0);app.model.bookings.declineBookingByServiceProfessional(this.bookingID()).then(function(booking){afterSaveBooking(booking,events.declined)})["catch"](function(err){app.modals.showError({title:"There was an error saving the data.",error:err})}).then(function(){this.isSaving(!1)}.bind(this))}};this.confirmBookingRequest=function(dateType){if(this.isBookingRequest()){this.isSaving(!0);app.model.bookings.confirmBookingRequest(this.bookingID(),dateType).then(function(booking){afterSaveBooking(booking,events.confirmed)})["catch"](function(err){app.modals.showError({title:"There was an error saving the data.",error:err})}).then(function(){this.isSaving(!1)}.bind(this))}};this.confirmCancelBookingByServiceProfessional=function(){this.app.modals.confirm({title:"Cancel booking",message:"Are you sure?",yes:"Yes",no:"No"}).then(function(){this.cancelBookingByServiceProfessional()}.bind(this))}.bind(this);this.selectedRequestDateType=ko.observable();this.observerSelected=function(dateType){return ko.pureComputed(function(){return this.selectedRequestDateType()===ko.unwrap(dateType)},this)}.bind(this);this.setSelectedRequestDateType=function(dateType){this.selectedRequestDateType(dateType)}.bind(this);this.performSelectedBookingRequestAnswer=function(){var option=this.selectedRequestDateType();return"deny"===option?this.declineBookingByServiceProfessional():this.confirmBookingRequest(option)}.bind(this);var editFieldOn=function editFieldOn(activity,data){data.appointment=this.item().model.toPlainObject(!0);data.cancelLink=this.cancelLink;if(this.progress&&!this.progress.ended){data.progress=this.progress;var step=data.progress.step||1,total=data.progress.total||1;data.title=step+" of "+total;data.navTitle=null}else{data.progress=this.progress;data.title=null;data.navTitle=this.isBooking()?"Booking":"Event"}app.shell.go(activity,data)}.bind(this);this.pickDateTime=function pickDateTime(){if(!this.isLocked()){var item=this.item();item.getServiceDurationMinutes().then(function(minutes){editFieldOn("datetimePicker",{selectedDatetime:item.startTime(),datetimeField:"startTime",headerText:"Select the start time",requiredDuration:minutes})})}}.bind(this);this.pickEndDateTime=function pickEndDateTime(){this.isLocked()||editFieldOn("datetimePicker",{selectedDatetime:this.item().endTime(),datetimeField:"endTime",headerText:"Select the end time",includeEndTime:!0})}.bind(this);this.pickClient=function pickClient(){this.isLocked()||editFieldOn("clients",{selectClient:!0,selectedClientID:this.item().sourceBooking().clientUserID()})}.bind(this);this.pickService=function pickService(){if(!this.isLocked()){var activity="serviceProfessionalService/"+this.item().jobTitleID()+"/client/"+this.item().clientUserID();editFieldOn(activity,{selectPricing:!0,selectedServices:this.item().pricing().map(function(pricing){return{serviceProfessionalServiceID:ko.unwrap(pricing.serviceProfessionalServiceID),price:ko.unwrap(pricing.price)}})})}}.bind(this);this.changePrice=function changePrice(){this.isLocked()}.bind(this);this.pickLocation=function pickLocation(){this.isLocked()||editFieldOn("serviceAddresses/"+this.item().jobTitleID(),{selectAddress:!0,selectedAddressID:this.item().address()?this.item().address().addressID():0,clientUserID:this.item().clientUserID()})}.bind(this);var textFieldsHeaders={preNotesToClient:"Notes to client",postNotesToClient:"Notes to client (afterwards)",preNotesToSelf:"Notes to self",postNotesToSelf:"Booking summary",summary:"What?"};this.editTextField=function editTextField(field){this.isLocked()||app.modals.showTextEditor({title:textFieldsHeaders[field],text:this.item()[field]()}).then(function(text){this.item()[field](text)}.bind(this))["catch"](function(err){err&&app.modals.showError({error:err})})}.bind(this);"function"==typeof params.api&&params.api(this);ko.computed(function calculateEndTime(){var duration=this.item().serviceDurationMinutes(),start=moment(this.item().startTime()),end;if(this.isBooking()&&start.isValid()){end=start.add(duration,"minutes").toDate();this.item().endTime(end)}},this).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}})}var ko=require("knockout"),moment=require("moment"),getObservable=require("../utils/getObservable"),Appointment=require("../models/Appointment"),AppointmentView=require("../viewmodels/AppointmentView"),ModelVersion=require("../utils/ModelVersion"),getDateWithoutTime=require("../utils/getDateWithoutTime"),PricingSummaryDetail=require("../models/PricingSummaryDetail"),EventEmitter=require("events").EventEmitter,Booking=require("../models/Booking"),Address=require("../models/Address"),events={confirmed:"confirmed",declined:"declined",cancelled:"cancelled"};AppointmentCardViewModel._inherits(EventEmitter);AppointmentCardViewModel.prototype.passIn=function passIn(requestData){if(requestData.appointment){this.editMode(!0);this.item().model.updateWith(requestData.appointment)}else this.isNew()||this.cancel();this.selectedRequestDateType("");requestData.selectClient===!0&&this.item().clientUserID(requestData.selectedClientID);if("undefined"!=typeof requestData.selectedDatetime){var field=requestData.datetimeField;this.item()[field](requestData.selectedDatetime);this.allowBookUnavailableTime(requestData.allowBookUnavailableTime)}requestData.selectedJobTitleID&&this.item().jobTitleID(requestData.selectedJobTitleID);if(requestData.selectAddress===!0){this.item().address()||this.item().address(new Address);requestData.address?this.item().address().model.updateWith(requestData.address,!0):requestData.selectedAddressID&&this.item().address().addressID(requestData.selectedAddressID)}requestData.selectPricing===!0&&this.item().pricing(requestData.selectedServices.map(function(pricing){return new PricingSummaryDetail(pricing)}));if(this.isNew())if(requestData&&requestData.cancelLink)this.cancelLink=requestData.cancelLink;else{var referrerUrl=this.app.shell.referrerRoute;referrerUrl=referrerUrl&&referrerUrl.url||"calendar";this.cancelLink=referrerUrl}if(this.currentID()===Appointment.specialIds.newBooking)if(requestData.progress){if(requestData.progress){this.progress=requestData.progress;var step=this.progress.step||1;if(2>step){this.progress.step=2;this.pickService()}else if(3>step){requestData.progress.step=3;this.pickDateTime()}else if(4>step){requestData.progress.step=4;this.pickLocation()}else this.progress.ended=!0}}else{this.progress={step:1,total:4,ended:!1};this.pickClient()}else this.progress=null};AppointmentCardViewModel.events=events;module.exports=AppointmentCardViewModel},{"../models/Address":49,"../models/Appointment":50,"../models/Booking":51,"../models/PricingSummaryDetail":78,"../utils/ModelVersion":120,"../utils/getDateWithoutTime":131,"../utils/getObservable":132,"../viewmodels/AppointmentView":145,events:!1,knockout:!1,moment:!1}],145:[function(require,module,exports){"use strict";function pricingSummaryDetailView(pricingSummaryDetail,jobTitleID,app){var observable=ko.observable(app.model.serviceProfessionalServices.asModel()),serviceID=pricingSummaryDetail.serviceProfessionalServiceID();pricingSummaryDetail.serviceProfessionalService=observable;app.model.serviceProfessionalServices.getItem(jobTitleID,serviceID).then(function(service){var serviceModel=app.model.serviceProfessionalServices.asModel(service);observable(serviceModel)});return pricingSummaryDetail}var ko=require("knockout");module.exports=function AppointmentView(appointment,app){if(appointment._isAppointmentView)return appointment;appointment._isAppointmentView=!0;appointment.client=ko.computed(function(){var b=this.sourceBooking();if(!b)return null;var cid=this.clientUserID();return cid?app.model.clients.getObservableItem(cid,!0)():null},appointment).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}});ko.computed(function(){var add=this.address(),aid=add&&add.addressID(),jid=this.jobTitleID();aid&&jid&&app.model.serviceAddresses.getItem(jid,aid).then(function(serverAddress){serverAddress.addressID===aid&&add.model.updateWith(serverAddress,!0)})},appointment).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}});appointment.addressSummary=ko.computed(function(){var eventData=this.sourceEvent(),add=this.address();return add&&add.singleLineDetailed()||eventData&&eventData.location()||""},appointment).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}});appointment.pricingWithInfo=ko.computed(function(){var b=this.sourceBooking();if(!b)return[];var jid=this.jobTitleID(),details=this.pricing();return details.map(function(det){return pricingSummaryDetailView(det,jid,app)})},appointment).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:60}});appointment.servicesSummary=ko.computed(function(){return this.pricingWithInfo().map(function(service){return service.serviceProfessionalService().name()}).join(", ")},appointment).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}});appointment.getServiceDurationMinutes=function(){var jid=this.jobTitleID(),pricing=this.pricing();if(!pricing)return Promise.resolve(0);var tasks=pricing.map(function(service){var id=service.serviceProfessionalServiceID();return app.model.serviceProfessionalServices.getItem(jid,id)});return Promise.all(tasks).then(function(services){return services.reduce(function(prev,service){return prev+service.serviceDurationMinutes},0)})};appointment.serviceDurationMinutes=ko.computed(function(){var pricing=this.pricingWithInfo(),sum=pricing.reduce(function(prev,service){return prev+service.serviceProfessionalService().serviceDurationMinutes()},0);return sum},appointment).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}});ko.computed(function(){var pricing=appointment.pricing();if(0===pricing.length)this.price(0);else{var p=pricing[0].price();if(null===p||"undefined"==typeof p)return;this.price(pricing.reduce(function(prev,cur){return prev+cur.price()},0))}},appointment).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}});return appointment}},{knockout:!1}],146:[function(require,module,exports){"use strict";var countries=[[1,"United States"],[2,"Spain"],[3,"Afghanistan"],[4,"Albania"],[5,"Algeria"],[6,"American Samoa"],[7,"Andorra"],[8,"Angola"],[9,"Anguilla"],[10,"Antarctica"],[11,"Antigua and Barbuda"],[12,"Argentina"],[13,"Armenia"],[14,"Aruba"],[15,"Australia"],[16,"Austria"],[17,"Azerbaijan"],[18,"Bahamas"],[19,"Bahrain"],[20,"Bangladesh"],[21,"Barbados"],[22,"Belarus"],[23,"Belgium"],[24,"Belize"],[25,"Benin"],[26,"Bermuda"],[27,"Bhutan"],[28,"Bolivia"],[29,"Bosnia and Herzegovina"],[30,"Botswana"],[31,"Bouvet Island"],[32,"Brazil"],[33,"British Indian Ocean Territory"],[34,"Brunei Darussalam"],[35,"Bulgaria"],[36,"Burkina Faso"],[37,"Burundi"],[38,"Cambodia"],[39,"Cameroon"],[40,"Canada"],[41,"Cape Verde"],[42,"Cayman Islands"],[43,"Central African Republic"],[44,"Chad"],[45,"Chile"],[46,"China"],[47,"Christmas Island"],[48,"Cocos Keeling) Islands"],[49,"Colombia"],[50,"Comoros"],[51,"Congo"],[52,"Congo Democratic Republic"],[53,"Cook Islands"],[54,"Costa Rica"],[55,"Cote DIvoire"],[56,"Croatia"],[57,"Cuba"],[58,"Cyprus"],[59,"Czech Republic"],[60,"Denmark"],[61,"Djibouti"],[62,"Dominica"],[63,"Dominican Republic"],[64,"Ecuador"],[65,"Egypt"],[66,"El Salvador"],[67,"Equatorial Guinea"],[68,"Eritrea"],[69,"Estonia"],[70,"Ethiopia"],[71,"Falkland Islands Malvinas)"],[72,"Faroe Islands"],[73,"Fiji"],[74,"Finland"],[75,"France"],[76,"French Guiana"],[77,"French Polynesia"],[78,"French Southern Territories"],[79,"Gabon"],[80,"Gambia"],[81,"Georgia"],[82,"Germany"],[83,"Ghana"],[84,"Gibraltar"],[85,"Greece"],[86,"Greenland"],[87,"Grenada"],[88,"Guadeloupe"],[89,"Guam"],[90,"Guatemala"],[91,"Guinea"],[92,"Guinea-Bissau"],[93,"Guyana"],[94,"Haiti"],[95,"Heard and Mcdonald Islands"],[96,"Holy See Vatican City State"],[97,"Honduras"],[98,"Hong Kong"],[99,"Hungary"],[100,"Iceland"],[101,"India"],[102,"Indonesia"],[103,"Iran Islamic Republic of"],[104,"Iraq"],[105,"Ireland"],[106,"Israel"],[107,"Italy"],[108,"Jamaica"],[109,"Japan"],[110,"Jordan"],[111,"Kazakhstan"],[112,"Kenya"],[113,"Kiribati"],[114,"Korea South"],[115,"Korea North"],[116,"Kuwait"],[117,"Kyrgyzstan"],[118,"Laos"],[119,"Latvia"],[120,"Lebanon"],[121,"Lesotho"],[122,"Liberia"],[123,"Libyan Arab Jamahiriya"],[124,"Liechtenstein"],[125,"Lithuania"],[126,"Luxembourg"],[127,"Macao"],[128,"Macedonia"],[129,"Madagascar"],[130,"Malawi"],[131,"Malaysia"],[132,"Maldives"],[133,"Mali"],[134,"Malta"],[135,"Marshall Islands"],[136,"Martinique"],[137,"Mauritania"],[138,"Mauritius"],[139,"Mayotte"],[140,"Mexico"],[141,"Micronesia"],[142,"Moldova"],[143,"Monaco"],[144,"Mongolia"],[145,"Montserrat"],[146,"Morocco"],[147,"Mozambique"],[148,"Myanmar"],[149,"Namibia"],[150,"Nauru"],[151,"Nepal"],[152,"Netherlands"],[153,"Netherlands Antilles"],[154,"New Caledonia"],[155,"New Zealand"],[156,"Nicaragua"],[157,"Niger"],[158,"Nigeria"],[159,"Niue"],[160,"Norfolk Island"],[161,"Northern Mariana Islands"],[162,"Norway"],[163,"Oman"],[164,"Pakistan"],[165,"Palau"],[166,"Palestinian"],[167,"Panama"],[168,"Papua New Guinea"],[169,"Paraguay"],[170,"Peru"],[171,"Philippines"],[172,"Pitcairn"],[173,"Poland"],[174,"Portugal"],[175,"Puerto Rico"],[176,"Qatar"],[177,"Reunion"],[178,"Romania"],[179,"Russian Federation"],[180,"Rwanda"],[181,"Saint Helena"],[182,"Saint Kitts and Nevis"],[183,"Saint Lucia"],[184,"Saint Pierre and Miquelon"],[185,"Saint Vincent/ theGrenadines"],[186,"Samoa"],[187,"San Marino"],[188,"Sao Tome and Principe"],[189,"Saudi Arabia"],[190,"Senegal"],[191,"Serbia and Montenegro"],[192,"Seychelles"],[193,"Sierra Leone"],[194,"Singapore"],[195,"Slovakia"],[196,"Slovenia"],[197,"Solomon Islands"],[198,"Somalia"],[199,"South Africa"],[200,"South Georgia"],[201,"Sri Lanka"],[202,"Sudan"],[203,"Suriname"],[204,"Svalbard and Jan Mayen"],[205,"Swaziland"],[206,"Sweden"],[207,"Switzerland"],[208,"Syrian Arab Republic"],[209,"Taiwan"],[210,"Tajikistan"],[211,"Tanzania"],[212,"Thailand"],[213,"Timor-Leste"],[214,"Togo"],[215,"Tokelau"],[216,"Tonga"],[217,"Trinidad and Tobago"],[218,"Tunisia"],[219,"Turkey"],[220,"Turkmenistan"],[221,"Turks and Caicos Islands"],[222,"Tuvalu"],[223,"Uganda"],[224,"Ukraine"],[225,"United Arab Emirates"],[226,"United Kingdom"],[227,"US Minor Outlying Islands"],[228,"Uruguay"],[229,"Uzbekistan"],[230,"Vanuatu"],[231,"Venezuela"],[232,"Viet Nam"],[233,"Virgin Islands British"],[234,"Virgin Islands U.S."],[235,"Wallis and Futuna"],[236,"Western Sahara"],[237,"Yemen"],[238,"Zambia"],[239,"Zimbabwe"]],unitedStates=countries[0],option=function(country){return{id:country[0],name:country[1]}},countriesOptions=function(){return countries.map(option)};countriesOptions.unitedStates=option(unitedStates);module.exports=countriesOptions},{}],147:[function(require,module,exports){"use strict";function DatetimePickerVM(app,element){this.selectedDate=ko.observable(getDateWithoutTime());this.userID=ko.observable();this.isLoading=ko.observable(!1);this.requiredDurationMinutes=ko.observable(0);this.includeEndTime=ko.observable(!1);this.timeZone=ko.observable("");this.specialTimeZones=ko.observableArray([]);this.durationDisplay=ko.pureComputed(function(){var fullMinutes=this.requiredDurationMinutes();if(0>=fullMinutes)return"";var hours=Math.floor(fullMinutes/60),minutes=fullMinutes%60,text="";hours>0&&(text+=moment.duration({hours:hours}).humanize()+" ");minutes>0&&(text+=moment.duration({minutes:minutes}).humanize());return text},this);this.getDateAtTimeZone=function(date,timeZone){var s;s=timeZone?moment.tz(moment(date).format("Y-MM-DD"),timeZone):moment(date).startOf("day");return s};this.dateAvail=ko.observable();this.groupedSlots=ko.computed(function(){var requiredDurationMinutes=this.requiredDurationMinutes(),includeEndTime=this.includeEndTime(),tz=this.timeZone()||timeZoneList.getLocalTimeZone(),baseDate=this.getDateAtTimeZone(this.selectedDate()||new Date,tz),groups=[{group:"Morning",slots:[],starts:baseDate.clone().hour(0).minute(0).second(0),ends:baseDate.clone().hour(12).minute(0).second(0)},{group:"Afternoon",slots:[],starts:baseDate.clone().hour(12).minute(0).second(0),ends:baseDate.clone().hour(17).minute(0).second(0)},{group:"Evening",slots:[],starts:baseDate.clone().hour(17).minute(0).second(0),ends:baseDate.clone().hour(24).minute(0).second(0)}],slots=this.dateAvail()&&this.dateAvail().getFreeTimeSlots(requiredDurationMinutes,void 0,includeEndTime)||[];slots.forEach(function(slot){slot=moment(slot).tz(tz);groups.some(function(group){if(slot>=group.starts&&slot<group.ends){group.slots.push(slot);return!0}})});return groups},this);this.selectedDatetime=ko.observable(null);this.selectDatetime=function(selectedDatetime,event){event.preventDefault();event.stopImmediatePropagation();this.selectedDatetime(selectedDatetime)}.bind(this);this.pickedTime=ko.observable();this.allowBookUnavailableTime=ko.observable(!1);this.unavailableTimeBtnEnabled=ko.observable(!1);this.getPickedDatetime=function(){var t=this.pickedTime();if(!(t instanceof Date)){var timespan=moment.duration(t);t=moment(this.selectedDate()).startOf("day").add(timespan).toDate()}return t};this.setPickedAsSelected=function(){this.allowBookUnavailableTime(!0);this.selectedDatetime(this.getPickedDatetime())}.bind(this);this.showTimePicker=function(){app.modals.showTimePicker({title:"Book an unavailable time",selectedTime:null,unsetLabel:"Cancel"}).then(function(pickedValue){if(pickedValue.time){this.pickedTime(pickedValue.time);this.setPickedAsSelected()}}.bind(this))["catch"](function(){})}.bind(this);this.reset=function(){this.selectedDatetime(null);this.pickedTime(null);this.allowBookUnavailableTime(!1);this.timeZone("");this.specialTimeZones.removeAll();this.isTimeZonePickerOpen(!1)}.bind(this);this.bindDateData=function(date){if(date&&this.userID()){var tz=this.timeZone();this.isLoading(!0);var s=this.getDateAtTimeZone(date,tz),e=s.clone().add(1,"day");return app.model.availability.times(this.userID(),s,e).then(function(data){this.dateAvail(data)}.bind(this))["catch"](function(err){app.modals.showError({title:"Error loading availability",error:err})}.bind(this)).then(function(){this.isLoading(!1)}.bind(this))}}.bind(this);var $datePicker=$(element).find(".calendar-placeholder");$datePicker.show().datepicker({extraClasses:"DatePicker--tagged"});this.tagAvailability=datepickerAvailability.create(app,$datePicker,this.isLoading);$datePicker.on("dateChanged",function(e){"days"===e.viewMode&&this.selectedDate(e.date)}.bind(this));this.selectedDate.subscribe(function(date){this.bindDateData(date);var elDate=$datePicker.datepicker("getValue");elDate!==date&&$datePicker.datepicker("setValue",date,!0)}.bind(this));this.timeZone.subscribe(function(){this.bindDateData(this.selectedDate())}.bind(this));ko.computed(function(){this.dateAvail()&&this.userID()&&this.tagAvailability(this.selectedDate(),this.userID())},this).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:60}});$datePicker.datepicker("fill");var autoTz=timeZoneList.getUsAliasWhenPossible(timeZoneList.getLocalTimeZone()),autoLabel="Auto ("+timeZoneList.timeZoneToDisplayFormat(autoTz)+")";this.autoTimeZone=ko.observable({id:autoTz,label:autoLabel});this.timeZonesList=ko.observable(timeZoneList.getUserList());this.topUsTimeZones=ko.observable(timeZoneList.getTopUsZones());this.isTimeZonePickerOpen=ko.observable(!1);this.openTimeZonePicker=function(){this.isTimeZonePickerOpen(!0)}}var ko=require("knockout"),$=require("jquery"),getDateWithoutTime=require("../utils/getDateWithoutTime"),moment=require("moment-timezone");require("../components/DatePicker");var datepickerAvailability=require("../utils/datepickerAvailability"),timeZoneList=require("../utils/timeZoneList");module.exports=DatetimePickerVM},{"../components/DatePicker":43,"../utils/datepickerAvailability":128,"../utils/getDateWithoutTime":131,"../utils/timeZoneList":142,knockout:!1,"moment-timezone":!1}],148:[function(require,module,exports){"use strict";var ko=require("knockout"),Field=function(){var obs=ko.observable("");obs.error=ko.observable("");obs.subscribe(function(){obs.error("")});return obs};module.exports=Field},{knockout:!1}],149:[function(require,module,exports){function NavAction(values){Model(this);this.model.defProperties({link:"",icon:"",text:"",isTitle:!1,isModal:!1,isShell:!1,isMenu:!1,handler:null},values);this.runHandler=function runHandler(obj,event){var handler=this.handler();if(handler){event.stopImmediatePropagation();event.preventDefault();handler.call(this,event,obj)}}.bind(this)}var Model=require("../models/Model");module.exports=NavAction;NavAction.prototype.getHref=function getHref(){return this.handler()||this.isMenu()||this.isModal()||this.isShell()?"#":this.link()};NavAction.prototype.getModalTarget=function getModalTarget(){return this.handler()||this.isMenu()||!this.isModal()||this.isShell()?"":this.link()};NavAction.prototype.getShellCommand=function getShellCommand(){return this.handler()||this.isMenu()||!this.isShell()?"":this.link()};NavAction.prototype.getMenuID=function getMenuID(){return this.handler()||!this.isMenu()?"":this.link()};NavAction.prototype.getMenuLink=function getMenuLink(){return this.handler()||!this.isMenu()?"":"#"+this.link()};NavAction.goHome=new NavAction({link:"/",icon:"fa ion ion-stats-bars"});NavAction.goBack=new NavAction({link:"goBack",icon:"fa ion ion-ios-arrow-left",isShell:!0});NavAction.menuIn=new NavAction({link:"menuIn",icon:"menu",isMenu:!0});NavAction.menuNewItem=new NavAction({link:"menuNewItem",icon:"fa ion ion-ios-plus-empty",isMenu:!0});NavAction.goMarketplace=new NavAction({link:"/home",icon:"fa ion ion-ios-cart-outline"});NavAction.goHelpIndex=new NavAction({link:"/contactForm/general?mustReturn=true",text:"Contact us",isModal:!1});NavAction.goLogin=new NavAction({link:"/login",text:"Log in"});NavAction.goLogout=new NavAction({link:"/logout",text:"Log out"});NavAction.goSignup=new NavAction({link:"/signup",text:"Sign up"})},{"../models/Model":75}],150:[function(require,module,exports){function NavBar(values){Model(this);this.model.defProperties({title:"",leftAction:{Model:NavAction},rightAction:{Model:NavAction},hidden:!1,additionalNavClasses:""},values)}var Model=require("../models/Model"),NavAction=require("./NavAction");module.exports=NavBar},{"../models/Model":75,"./NavAction":149}],151:[function(require,module,exports){function OnboardingProgress(values){var stepNumberFinished=-1;Model(this);this.model.defProperties({stepNumber:stepNumberFinished,selectedJobTitleID:null},values);this.totalSteps=ko.pureComputed(function(){return this.stepNames.length-1},this);this.incrementStep=function(){var currentStep=this.stepNumber();this.isFinished()||(currentStep==this.stepNames.length-1?this.finish():this.stepNumber(currentStep+1))};this.stepAfter=function(stepName){var nextStep=new OnboardingProgress({selectedJobTitleID:this.selectedJobTitleID()});nextStep.setStepByName(stepName);nextStep.incrementStep();return nextStep};this.stepName=ko.pureComputed(function(){return this.stepNames[this.stepNumber()]||null},this);this.stepNames=OnboardingProgress.steps.names;this.stepUrl=ko.pureComputed(function(){var name=this.stepName();if(!name)return null;var url="/"+name,def=OnboardingProgress.steps.definitions[name],jobID=this.selectedJobTitleID();jobID&&def&&def.jobTitleSpecific&&(url+="/"+jobID);return url},this);this.progressText=ko.pureComputed(function(){return this.stepNumber()+" of "+this.totalSteps()},this);this.inProgress=ko.pureComputed(function(){return!this.isFinished()},this);this.finish=function(){this.stepNumber(stepNumberFinished)};this.isFinished=ko.pureComputed(function(){return this.stepNumber()===stepNumberFinished},this)}var Model=require("../models/Model"),ko=require("knockout");module.exports=OnboardingProgress;OnboardingProgress.prototype.setStepByName=function setStepByName(name){var stepIndex=this.stepNames.indexOf(name);if(stepIndex>-1){this.stepNumber(stepIndex);return!0}return!1};OnboardingProgress.steps={names:["welcome","addJobTitles","schedulingPreferences","servicesOverview","serviceProfessionalService","serviceAddresses","bookingPolicies","licensesCertifications","aboutMe","paymentAccount"],definitions:{welcome:{},addJobTitles:{},schedulingPreferences:{},servicesOverview:{jobTitleSpecific:!0},serviceProfessionalService:{jobTitleSpecific:!0},serviceAddresses:{jobTitleSpecific:!0},bookingPolicies:{jobTitleSpecific:!0},licensesCertifications:{jobTitleSpecific:!0},aboutMe:{},paymentAccount:{}}}},{"../models/Model":75,knockout:!1}],152:[function(require,module,exports){"use strict";module.exports=function OnboardingProgressBarVM(app){this.isInOnboarding=app.model.onboarding.inProgress}},{}],153:[function(require,module,exports){"use strict";var ko=require("knockout");module.exports=function OnboardingProgressMarkVM(app){var o=app.model.onboarding;this.progressText=o.progressText;var getClassNames=function(i){var n=o.stepNumber();return n>i?"ion-ios-checkmark text-success":i===n?"ion-ios-checkmark-outline text-success":"ion-ios-checkmark-outline"};this.marks=ko.pureComputed(function(){for(var t=o.totalSteps(),l=[],i=1;t>=i;i++)l.push({classNames:ko.pureComputed(getClassNames.bind(null,i))});return l},this)}},{knockout:!1}],154:[function(require,module,exports){"use strict";var SearchResults=require("../models/SearchResults"),ko=require("knockout"),DEFAULT_LOCATION={lat:"37.788479",lng:"-122.40297199999998",searchDistance:30,city:"San Francisco, CA USA"};module.exports=function SearchJobTitlesVM(app){this.isLoading=ko.observable(!1);this.searchTerm=ko.observable();this.lat=ko.observable(DEFAULT_LOCATION.lat);this.lng=ko.observable(DEFAULT_LOCATION.lng);this.city=ko.observable();this.searchDistance=ko.observable(DEFAULT_LOCATION.searchDistance);this.searchResults=new SearchResults;var latestRequest=null;this.loadData=function(searchTerm,lat,lng){latestRequest&&latestRequest.xhr.abort();this.isLoading(!0);latestRequest=app.model.rest.get("search",{searchTerm:searchTerm,origLat:lat||DEFAULT_LOCATION.lat,origLong:lng||DEFAULT_LOCATION.lng,searchDistance:DEFAULT_LOCATION.searchDistance});return latestRequest.then(function(searchResults){searchResults?this.searchResults.model.updateWith(searchResults,!0):this.searchResults.model.reset();this.isLoading(!1)}.bind(this))["catch"](function(err){this.isLoading(!1);return err&&"abort"===err.statusText?null:void 0}.bind(this))};this.search=function(){var s=this.searchTerm();s&&s.length>2?this.loadData(s,this.lat(),this.lng()):this.searchResults.model.reset()};ko.computed(function(){this.search()},this).extend({rateLimit:{method:"notifyAtFixedRate",timeout:300}});this.isInput=ko.pureComputed(function(){var s=this.searchTerm();return s&&s.length>2},this);this.onClickJobTitle=function(){};this.clickJobTitle=function(d,e){try{this.onClickJobTitle(d,e)}catch(ex){}this.searchTerm("")}.bind(this);this.onClickNoJobTitle=function(){};this.clickNoJobTitle=function(d,e){try{this.onClickNoJobTitle(this.searchTerm(),e);
}catch(ex){}this.searchTerm("")}.bind(this);this.jobTitleHref=ko.observable("");this.noJobTitleHref=ko.observable("");this.customResultsButtonText=ko.observable("");this.resultsButtonText=ko.pureComputed(function(){var t=this.customResultsButtonText();if(t)return t;var anon=app.model.userProfile.data.isAnonymous();return anon?"Sign up":"Add"},this);this.thereAreJobTitles=ko.pureComputed(function(){var jts=this.searchResults.jobTitles();return jts.length>0},this)}},{"../models/SearchResults":91,knockout:!1}],155:[function(require,module,exports){"use strict";function SignupVM(app){EventEmitter.call(this);fb.load();this.confirmationCode=ko.observable(null);this.firstName=new Field;this.lastName=new Field;this.phone=new Field;this.postalCode=new Field;this.countriesOptions=countriesOptions();this.country=new Field;this.country(countriesOptions.unitedStates);this.referralCode=new Field;this.device=new Field;this.facebookUserID=ko.observable();this.facebookAccessToken=ko.observable();this.jobTitleID=ko.observable();this.jobTitleName=ko.observable();this.email=new Field;this.validatedPassword=new ValidatedPasswordViewModel;this.isCountryVisible=ko.observable(!0);this.isEmailSignupDisplayed=ko.observable(!1);this.isFirstNameValid=ko.pureComputed(function(){var firstNameRegex=/^(\S{2,}\s*)+$/;return firstNameRegex.test(this.firstName())},this);this.isLastNameValid=ko.pureComputed(function(){var lastNameRegex=/^(\S{2,}\s*)+$/;return lastNameRegex.test(this.lastName())},this);this.isPostalCodeValid=ko.pureComputed(function(){var postalCodeRegex=/^\d{5}([\-]?\d{4})?$/;return postalCodeRegex.test(this.postalCode())},this);this.isPhoneValid=ko.pureComputed(function(){var phoneRegex=/^\([1-9]\d{2}\)\ \d{3}\-\d{4,8}$|^[1-9]\d{2}\-\d{3}\-\d{4,8}$|^[1-9]\d{2}\.\d{3}\.\d{4,8}$|^[1-9]\d{9,13}$/;return phoneRegex.test(this.phone())},this);this.isEmailValid=ko.pureComputed(function(){var emailRegex=/^(([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i;return emailRegex.test(this.email())},this);this.isReferralCodeValid=ko.pureComputed(function(){var referralCodeRegex=/^.{3,}$/;return referralCodeRegex.test(this.referralCode())},this);this.signupError=ko.observable("");this.isSigningUp=ko.observable(!1);this.isSigningUpWithFacebook=ko.observable(!1);this.enableFacebookButton=ko.pureComputed(function(){return!this.isSigningUpWithFacebook()&&fb.isReady()},this);this.profile=ko.observable("");this.emailIsLocked=ko.observable(!1);this.reset=function(){this.confirmationCode(null);this.firstName("");this.lastName("");this.phone("");this.postalCode("");this.country(countriesOptions.unitedStates);this.referralCode("");this.device("");this.facebookUserID("");this.facebookAccessToken("");this.email("");this.validatedPassword.reset();this.signupError("");this.isSigningUp(!1);this.isSigningUpWithFacebook(!1);this.profile("");this.emailIsLocked(!1);this.jobTitleID(null);this.jobTitleName(null);this.isEmailSignupDisplayed(!1)};this.submitText=ko.pureComputed(function(){return this.isSigningUp()?"Signing up...":"Sign up"},this);this.facebookSubmitText=ko.pureComputed(function(){return fb.isReady()?this.isSigningUpWithFacebook()?"Signing up with Facebook...":"Sign up with Facebook":"Loading Facebook..."},this);this.performSignup=function performSignup(){this.isSigningUp(!0);this.signupError("");var plainData={confirmationCode:this.confirmationCode(),email:this.email(),password:this.validatedPassword.password(),firstName:this.firstName(),lastName:this.lastName(),phone:this.phone(),postalCode:this.postalCode(),countryID:this.country().id,referralCode:this.referralCode(),device:this.device(),facebookUserID:this.facebookUserID(),facebookAccessToken:this.facebookAccessToken(),profileType:this.profile(),jobTitleID:this.jobTitleID(),jobTitleName:this.jobTitleName()};return app.model.signup(plainData).then(function(signupData){if(app.model.onboarding){app.model.onboarding.selectedJobTitleID(signupData.onboardingJobTitleID);app.model.onboarding.setStep(signupData.onboardingStep)}try{this.emit("signedup",signupData)||this.reset()}catch(ex){this.reset()}return signupData}.bind(this))["catch"](function(err){err=err&&err.responseJSON;var msg=err&&err.errorMessage;app.modals.showError({title:"There was an error signing-up",error:err});err&&"validation"===err.errorSource&&err.errors?Object.keys(err.errors).forEach(function(fieldKey){this[fieldKey]&&this[fieldKey].error&&this[fieldKey].error(err.errors[fieldKey])}.bind(this)):this.signupError(msg||err&&err.statusText||"Invalid username or password");this.isSigningUp(!1);throw err}.bind(this))}.bind(this);this.clickSignup=function(){this.performSignup()["catch"](function(err){this.emit("signuperror",err)}.bind(this))}.bind(this);this.forServiceProfessional=ko.pureComputed(function(){return this.profile()===profileType.serviceProfessional},this);this.forClient=ko.pureComputed(function(){return!this.forServiceProfessional()},this);this.facebook=function(){var vm=this;this.isSigningUpWithFacebook(!0);this.isEmailSignupDisplayed(!1);facebookLogin().then(function(result){var auth=result.authResponse;vm.facebookUserID(auth.userID);vm.facebookAccessToken(auth.accessToken);return facebookMe()}).then(function(user){vm.email(user.email);vm.firstName(user.first_name);vm.lastName(user.last_name)}).then(this.clickSignup).then(function(){this.isSigningUpWithFacebook(!1)}.bind(this))["catch"](function(err){this.emit("signuperror",err)}.bind(this))};this.showEmailSignup=function(){this.isEmailSignupDisplayed(!0)}}var ko=require("knockout"),EventEmitter=require("events").EventEmitter,ValidatedPasswordViewModel=require("./ValidatedPassword"),Field=require("./Field"),fb=require("../utils/facebookUtils"),countriesOptions=require("./CountriesOptions"),profileType={serviceProfessional:"service-professional",client:"client"},facebookLogin=function(){return window.facebookConnectPlugin?new Promise(function(s,e){window.facebookConnectPlugin.login(["email"],s,e)}):fb.login({scope:"email"})},facebookMe=function(){return window.facebookConnectPlugin?new Promise(function(s,e){window.facebookConnectPlugin.api("/me?fields=email,first_name,last_name",["email"],s,e)}):window.FB?new Promise(function(s,e){window.FB.api("/me",{fields:"email,first_name,last_name"},function(r){!r||r.error?e(r&&r.error):s(r)})}):void 0};SignupVM._inherits(EventEmitter);module.exports=SignupVM;SignupVM.profileType=profileType},{"../utils/facebookUtils":130,"./CountriesOptions":146,"./Field":148,"./ValidatedPassword":157,events:!1,knockout:!1}],156:[function(require,module,exports){"use strict";function TimeSlotViewModel(params){this.startTime=getObservable(params.startTime||null);this.endTime=getObservable(params.endTime||null);this.subject=getObservable(params.subject||null);this.description=getObservable(params.description||null);this.link=getObservable(params.link||null);this.actionIcon=getObservable(params.actionIcon||null);this.actionText=getObservable(params.actionText||null);this.classNames=getObservable(params.classNames||null)}var getObservable=require("../utils/getObservable");module.exports=TimeSlotViewModel;var numeral=require("numeral"),Appointment=require("../models/Appointment");TimeSlotViewModel.fromAppointment=function fromAppointment(apt){var link="#!appointment/"+apt.startTime().toISOString()+"/"+apt.id();apt.id()===Appointment.specialIds.preparationTime&&(link="#!schedulingPreferences?mustReturn=1");var classNames=null;if(Appointment.specialIds.free===apt.id())classNames="Tile--tag-gray-lighter ";else if(apt.id()>0&&apt.sourceBooking()){classNames=apt.sourceBooking().isRequest()?"Tile--tag-warning ":"Tile--tag-primary ";classNames+="ItemAddonTile--largerContent "}else classNames="Tile--tag-danger ";return new TimeSlotViewModel({startTime:apt.startTime,endTime:apt.endTime,subject:apt.summary,description:apt.description,link:link,actionIcon:apt.sourceBooking()?null:apt.sourceEvent()?"fa ion ion-ios-arrow-right":apt.id()?null:"fa ion ion-plus",actionText:apt.sourceBooking()&&apt.sourceBooking().pricingSummary()?numeral(apt.sourceBooking().pricingSummary().totalPrice()||0).format("$0.00"):null,classNames:classNames})}},{"../models/Appointment":50,"../utils/getObservable":132,numeral:!1}],157:[function(require,module,exports){"use strict";function ValidatedPassword(){var MINIMUM_HEIGHT_FOR_SCROLL=700,SCROLL_ANIMATION_DURATION=300,hasScrolledToField=!1,showRequirements=ko.observable(!1),showRequirementsLink=ko.observable(!0);this.password=new Field;this.reset=function(){showRequirements(!1);showRequirementsLink(!0);this.password("");hasScrolledToField=!1};this.requirementsLinkClick=function(){showRequirements(!0)}.bind(this);this.fieldFocus=function(viewModel,event){showRequirements()||showRequirementsLink(!1);showRequirements(!0);scrollToField(scrollTarget(event.target))}.bind(this);var scrollTarget=function(field){return $(field).parents(".ValidatedPassword").first()},scrollToField=function(target){if($(window).height()<MINIMUM_HEIGHT_FOR_SCROLL&&!hasScrolledToField){hasScrolledToField=!0;scrollToElement(target,{animation:{duration:SCROLL_ANIMATION_DURATION}})}};this.showRequirements=ko.pureComputed(function(){return showRequirements()},this);this.showRequirementsLink=ko.pureComputed(function(){return showRequirementsLink()},this);var validator=ko.pureComputed(function(){return new PasswordValidator(this.password())},this);this.isValid=ko.pureComputed(function(){return validator().isValid()},this);this.isLengthValid=ko.pureComputed(function(){return validator().isCorrectLength()},this);this.isCharacterKindsValid=ko.pureComputed(function(){return validator().isCorrectCharacterKinds()},this);this.usesSymbol=ko.pureComputed(function(){return validator().isCorrectSymbol()},this);this.usesUpper=ko.pureComputed(function(){return validator().isCorrectUpper()},this);this.usesLower=ko.pureComputed(function(){return validator().isCorrectLower()},this);this.usesNumber=ko.pureComputed(function(){return validator().isCorrectNumber()},this);this.characterKindsLabel=ko.pureComputed(function(){var count=validator().getCorrectCharacterKindsCount(),labels=["Includes at least 3 character types:","Includes at least 2 more character types:","Includes at least 1 more character type:","Includes at least 3 character types"];return labels[Math.min(count,labels.length-1)]},this)}var $=require("jquery"),ko=require("knockout"),PasswordValidator=require("../utils/PasswordValidator"),Field=require("./Field"),scrollToElement=require("../utils/scrollToElement");module.exports=ValidatedPassword},{"../utils/PasswordValidator":121,"../utils/scrollToElement":140,"./Field":148,knockout:!1}],"bootstrap-carousel":[function(require,module,exports){module.exports=require("cQpvfs")},{}],cQpvfs:[function(require,module,exports){(function(global){(function browserifyShim(module,define){global.jquery=require("jquery");+function($){"use strict";function Plugin(option){return this.each(function(){var $this=$(this),data=$this.data("bs.carousel"),options=$.extend({},Carousel.DEFAULTS,$this.data(),"object"==typeof option&&option),action="string"==typeof option?option:options.slide;data||$this.data("bs.carousel",data=new Carousel(this,options));"number"==typeof option?data.to(option):action?data[action]():options.interval&&data.pause().cycle()})}var Carousel=function(element,options){this.$element=$(element);this.$indicators=this.$element.find(".carousel-indicators");this.options=options;this.paused=null;this.sliding=null;this.interval=null;this.$active=null;this.$items=null;this.options.keyboard&&this.$element.on("keydown.bs.carousel",$.proxy(this.keydown,this));"hover"==this.options.pause&&!("ontouchstart"in document.documentElement)&&this.$element.on("mouseenter.bs.carousel",$.proxy(this.pause,this)).on("mouseleave.bs.carousel",$.proxy(this.cycle,this))};Carousel.VERSION="3.3.5";Carousel.TRANSITION_DURATION=600;Carousel.DEFAULTS={interval:5e3,pause:"hover",wrap:!0,keyboard:!0};Carousel.prototype.keydown=function(e){if(!/input|textarea/i.test(e.target.tagName)){switch(e.which){case 37:this.prev();break;case 39:this.next();break;default:return}e.preventDefault()}};Carousel.prototype.cycle=function(e){e||(this.paused=!1);this.interval&&clearInterval(this.interval);this.options.interval&&!this.paused&&(this.interval=setInterval($.proxy(this.next,this),this.options.interval));return this};Carousel.prototype.getItemIndex=function(item){this.$items=item.parent().children(".item");return this.$items.index(item||this.$active)};Carousel.prototype.getItemForDirection=function(direction,active){var activeIndex=this.getItemIndex(active),willWrap="prev"==direction&&0===activeIndex||"next"==direction&&activeIndex==this.$items.length-1;if(willWrap&&!this.options.wrap)return active;var delta="prev"==direction?-1:1,itemIndex=(activeIndex+delta)%this.$items.length;return this.$items.eq(itemIndex)};Carousel.prototype.to=function(pos){var that=this,activeIndex=this.getItemIndex(this.$active=this.$element.find(".item.active"));return pos>this.$items.length-1||0>pos?void 0:this.sliding?this.$element.one("slid.bs.carousel",function(){that.to(pos)}):activeIndex==pos?this.pause().cycle():this.slide(pos>activeIndex?"next":"prev",this.$items.eq(pos))};Carousel.prototype.pause=function(e){e||(this.paused=!0);if(this.$element.find(".next, .prev").length&&$.support.transition){this.$element.trigger($.support.transition.end);this.cycle(!0)}this.interval=clearInterval(this.interval);return this};Carousel.prototype.next=function(){return this.sliding?void 0:this.slide("next")};Carousel.prototype.prev=function(){return this.sliding?void 0:this.slide("prev")};Carousel.prototype.slide=function(type,next){var $active=this.$element.find(".item.active"),$next=next||this.getItemForDirection(type,$active),isCycling=this.interval,direction="next"==type?"left":"right",that=this;if($next.hasClass("active"))return this.sliding=!1;var relatedTarget=$next[0],slideEvent=$.Event("slide.bs.carousel",{relatedTarget:relatedTarget,direction:direction});this.$element.trigger(slideEvent);if(!slideEvent.isDefaultPrevented()){this.sliding=!0;isCycling&&this.pause();if(this.$indicators.length){this.$indicators.find(".active").removeClass("active");var $nextIndicator=$(this.$indicators.children()[this.getItemIndex($next)]);$nextIndicator&&$nextIndicator.addClass("active")}var slidEvent=$.Event("slid.bs.carousel",{relatedTarget:relatedTarget,direction:direction});if($.support.transition&&this.$element.hasClass("slide")){$next.addClass(type);$next[0].offsetWidth;$active.addClass(direction);$next.addClass(direction);$active.one("bsTransitionEnd",function(){$next.removeClass([type,direction].join(" ")).addClass("active");$active.removeClass(["active",direction].join(" "));that.sliding=!1;setTimeout(function(){that.$element.trigger(slidEvent)},0)}).emulateTransitionEnd(Carousel.TRANSITION_DURATION)}else{$active.removeClass("active");$next.addClass("active");this.sliding=!1;this.$element.trigger(slidEvent)}isCycling&&this.cycle();return this}};var old=$.fn.carousel;$.fn.carousel=Plugin;$.fn.carousel.Constructor=Carousel;$.fn.carousel.noConflict=function(){$.fn.carousel=old;return this};var clickHandler=function(e){var href,$this=$(this),$target=$($this.attr("data-target")||(href=$this.attr("href"))&&href.replace(/.*(?=#[^\s]+$)/,""));if($target.hasClass("carousel")){var options=$.extend({},$target.data(),$this.data()),slideIndex=$this.attr("data-slide-to");slideIndex&&(options.interval=!1);Plugin.call($target,options);slideIndex&&$target.data("bs.carousel").to(slideIndex);e.preventDefault()}};$(document).on("click.bs.carousel.data-api","[data-slide]",clickHandler).on("click.bs.carousel.data-api","[data-slide-to]",clickHandler);$(window).on("load",function(){$('[data-ride="carousel"]').each(function(){var $carousel=$(this);Plugin.call($carousel,$carousel.data())})})}(jQuery)}).call(global,module,void 0)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[44]);